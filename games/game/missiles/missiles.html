<!DOCTYPE html>
<html><!-- 
 single html processed by https://github.com/zTrix/webpage2html
 title: Missile Game | 3kh0
 url: https://bidoofery.github.io/renov8/projects/missiles/index.html
 date: Sat May  6 09:12:37 2023
-->
<head>
<meta charset="utf-8"/>
<title>Missile Game | 3kh0</title>
<meta content="3kh0 | 3kh0.github.io" name="author"/>
<meta content="A 3D game using SVG and javascript" name="description"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="https://3kh0.github.io/" property="og:url"/>
<meta content="" property="og:image"/>
<meta content="#000000" data-react-helmet="true" name="theme-color"/>
<meta content="Missile Game" name="title"/>
<meta content="Just a simple game about missiles, what could go wrong?" name="description"/>
<meta content="games, ad blocker, trolls, unblocked games, web games, online games, fun, tags" name="keywords"/>
<meta content="index, follow" name="robots"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="English" name="language"/>
<meta content="1 days" name="revisit-after"/>
<meta content="3kh0" name="author"/>
<link data-href="miss.png" href="data:image/png;base64,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" rel="icon" sizes="192x192"/>
<link data-href="miss.png" href="data:image/png;base64,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" rel="shortcut icon" type="image/x-icon"/>
<link data-href="miss.png" href="data:image/png;base64,UklGRjQZAABXRUJQVlA4WAoAAAAIAAAA5QAA5QAAVlA4IK4YAADwWQCdASrmAOYAPk0gjUQhoQjsdwAOAmJ6W78fJhpwAM7Ou79MP6B2df13+tfsz/X/Un8S+P/qn9e/ZL+7e3F/EeD/zP+H/4/oV/FPrj9w/u37af3/9xfe7+zeBP5D+q/378z/8P8gX4j/Iv7j+VH5d/TM9T5H/Tf8f1AvaT6B/ev7h+1X+C9CL+k9EvsH/nfcA/of9N/zX5Yfv/0DfqHsAfz3+u/6f/G/3P9kfpZ/f/+N/f/8b+0XtN/L/7r/vf8B/kf/P/pf/////0K/kn9K/0/97/yn/Z/yH///9P3EewL9rvZG/Wz/xmLuHRh6ze54pngUWl5TmBRcEaueJSVWstAPKvOiIJDezqtBIt/Qs5+xL/8zir5KjIp4j1Cc1eN8IaVs9l3k7ntpkYvz6uLvKUoqpcGG///zasrJq1s8o/8WL3P/gPtfDN8S0l1d++O0nfhan+/x3If9eC9MwtbvXtOD5YMeNxnJhTzP66cLV+gyf0RwkPk5kntZyzxvtYsUed8wWY/t9z4i5LINL9xQfUSWzUIDZO3tQwO7DGdzHWUVA6RFdf1yzVng8jyGGAHOFEbQRJeG9P9vFT8KSHFLZ1yrxfVdmyFYkx550uOdznSgDg7NAcqDRIhMrHJKQgWnTofMa8sOhA+6MZmK0ZTXvKIeVkvc1GnXSLuqB7YpjrnmgxFzgsN8K3ZVzWanIr7IR4w8TQim0zRIBAroynPPKq7lI1oeD6cTTVKJ67OleiHUxgPj5KdrYweD8k56Ms3UrvdiJzdjRAjI59s37jLDKJGJjI+dq+vYx6d5Py+LaKdtruPBAYrgcX099wM6fOXKNEHiVq9xQJDkWEsc8nRBrEcpqF7MwSOgcTv/lckCNQc16CcZS2A150Zu9AtdHSzaQeeD1tSSV5lXs+8dqki9HYBkZtGPaky/IGy5jFVcl0F3Jzanojx82zw5oYXrBV+yxKgKMHNqoAD++Q894OKu3pmveeJsRe1cSqzPimAWEpRkxYKrsZTi9Lb4HnPq+xU2AVU0UxS6Gjal75LE1RJr+FbXnd7UQCrSOvw7wMz8iEQC1GhTwmkvo3SzPQNeQiZ44YG3aF0Tf2k8okPjqNC2CQMWoOC4AvHn5veqQG+Pucx5pQPyRUzhM/UVfQPGbrgIf9ASsC6f9s8S8yTD522lLefOE75SFy4HZ+fqu3A9pvptXxc4iw1eVsMTG7YzfZQb2PxwPLQ/wIFIYF//XW88xAkf0Ed/1Pvcx/Ia+NJScEnhZKn+P92IFDSTEzzMvVWFxfBVY3jtp6RSOMjplk+XaJu4Si8mLy+W3Kcx29lhF0Z2Ba+xpIxJ/6p+gijXvQluUEtdokjFnCY3uxZaTsnboSj2HnU5M0ErmlWfC/fYAYzSVwXoDJRvRVJ6Yu7h/Ryz7MlpnJChjz/GYvUwTHfbRRailwVc4acbOMmTZh1nL9kyMdlo5k7s8EBLcHJCxUDJ+MUD7PZoHX9p5aF4EYcZG2yCy1RtKePN2I8TjwVB87lnYFqz97ivWnbGdtXlFz3Gwbfti87Hh3GH5F4oWICMWjazhW3ybuJGqgPr+jpGOfOM0AG4TeB+Hs3WP/gZwrC8Td3CTWouskqqQnaRgAzoIR6coaAUeGA8NjjeuWzK32MW9EYwhisgZNpr+zq78uorNonlucwwAIjOkg4Qj61QPZTwAbpdXYR5LBVPKCYq0jpbPMAN3eNs2IVkcb4gW/1LZe55LF8IcJgalkjQzYmZExKRUGaGScYLemKx0CZJBB/QdkCk0paz/buiB78F+1U/aDl3ztLP9z787yfS17EO3oX6Lyz6juCnKboWuogDc+NZwV5HOx+d/tPWGhsMAjqneCvz9LvXD16wbdcg4fVYJq01DAi9JfjVpmTLf3GJ8OcdEXXc1Ed5J87c6HHVDAWbTSbR8NxnR2/hD+zqIhFHo2j/QZxK/2G5udt/QG9+FSsonUivOGV9gvlXviCX/IlLaOO4ROGofYgmVhYnRa2I6wFRY9sUrXxXVa5mJBMI52Issy9cWCLoda/ie55n+Xj2sgi5Tu7HBZqjTdkhaA3PhWQVendV84pxcM2Hhjfw4990YkWW5qBvEE3WKrHRUwOm7Yr0PVaN34QW4bIROoeZVY2Jkp9aRNdWYwwBiHMizp1LmyC4kzTu+ETUoGmuUXG9hkYs4YOa1JoH0nRkTJFpoEqXpNzUxrXE7VD5zLQA5NQWMUerbRi7rhtCK0zUkF5lu+PR0I51Qha7+B//sJbVSKGlBWlBlTX3vHlGJxzLpupQ7o5yDbXZvyoAs8iKlA+RWNkFKHpa7yA7Dg9fT7zhgLfTIFw0KLSl5As1hn1cpDTGuE5r4/MqGp+BcQ2jfNehiJs1aMphMjFM1N1742Jn/+RdW4nzZLxrjGTbfwxM0DbOcGZ+jmUY6Aoz4oBVzPMTK9714uTz2sdSm8ac/QBWeefPxwg1oHT8ZhUyRgMmr9qH1NIZwF9sz8Tilh2gk/zqaBJoDv7Rd6R7Qk6w3KNRv+7+MtteztCHyt/fp25ysVwaJ8J7vxTYjz++RDkz9d4m/10DQhYkIoI1oOkuR5jetdzHQ5xad20+9qRD3fKdsVOvFDXL6Hsv0M/lKkCsR9ARs9rreuttwhW2KJNjz2ed5YPKXMoJZFz90+zYT52gbPJqPsB5aoJxsHp+DQFT6uM0He2iq23ap8ScPlLsWwLCq36deC2ut+f+1/z2CHaZzuLejchG1s1Vv5Au1xW2NHn5L9LrBUlRm8z48h071kSvPEK8q9NfwM0ai6z8HSOBMLSeygOFIkIHkFUTHnR41ESSyLoDEus9y0Y8WJ3nS68Z3apkfQTCLrF3N0wXNnMAyF1PIfSyJnHZqje+uzM11gyhL0DfJA1rmKh+uh5VFNL4hFGtwXiqpFLLoy0gZ77vqPMea99nOaPaVYXpnaIbpCVQhb9LG2SvRssSlvwYTxp5ukS3uvjYcHRg4Lq49HHcdmJZ1ZqSPvLvgZHeZVW1obq1599p9IdEyoyo4u+l0jkvMRgJGuPnJWh3jm8UQM9+wuzOYEwUvJ4mcsttRqNbXhKai1CjilTP2haNP3cftvXAnZ65OkgBZOOLDi4XElBSVD9uzNuc8hWb0pNBctUGr+mLIHdoibmayy2+KppiGLJuGUPo2XUwFvVUkjs0b89X5Z7zLZjd4ajTbog5heBPnLQKE7+DVB3MmCqQ/fYpYKvWQ4IRvRT9MSL76XatNaAptat//FR0Qcc4utj4mtRCeDNeVMrxKNw0Z5CeG6cZTqPH7Bb9ZzYQiApy5n/DCgsmmWJlp63OJ2lahqNby10nGN1nrcH6YB+kT7xkOhcW9GeMzWOgznlPVQM4LKHJBanwNY/5G6Jf2aNjjAmerM7311YK9RlGgYR07p/Er6NeE3qIAyJEAhwcU23GzYYRNnEDYqxQQXrpjoM5DUxuKwb1wgd4MsPvUy+ujlSW5b2fS8x+OKIm+4/5Vu3uGyW7THmi39mMDiV7Imox9I2r0DfrGk8qaNFo07y4FSvLX2OB58NHlUa8NcbPhx7NPsafC2nHtomt50s4udsAS3OS+941PRq7SteK9y8dWk+LNu5esqZ38+W9qV/fnLLSqnQJ5FGQzFCEh9X5fkwT/03N8eZzD4cLeBu+C+yT8jVcFjeSY3DLFo6vLEneO4BXw7qA8r9LDmXjUHqey0Xbex8vJ3Yjpfkj5LSB6zhivCTxm47ZFwTnH6u8PkeLjE2Wstip0dciecw140ZfgCxy2DYSQ45HORzaC931Cdo3H/iK66PM1R+5v4i4Uj7iO6D5B6xkPG+vC7JmRJDMTTaJ4LQqEWGIk1Vjz0yH3RGE7aVzfB16SupFPukEvgAGFNyFbS9kdMq2rkxRGVHVBRR5e9y+bi9sa7Ca2/196e2D+3vI3tby0V4pkznS9qhJIbySGahCsWzCDbtiWu/Zs3zXeFIP7dhNu3Jfwcz2af1fCpDeDLlBoOPJfErACtIh/b2PmGAvd8u6pxKvSJk9BrxF92bFfRaezX/53eSMYg5cH5K/htsJWfFaQsz2kfZtWPsfkELNgEePAOZG1IaIJqidNWBUL/V+o7VW3gSh5von56Y3teP8y+yiEir7cMuAArlCFzWUTRxP6nW/LtlYTvitVy83NGsfmaSKTjpsq2slxcNp1r5OZPLMtRj+QdP05U2wAE9I3DZ7Eo2gq5wdPByGHBfC56/1ir+spPgVIUg6Wa5E8ST+knNxiFMDXIIy0EsvLvkHP9mkIGQYabOf7MFpynmJnrtbF1bRJV9+TBRZ/scLnND1IXtVo2eE/NRLPoQjbWzEo3OeIDWdmpctC+MCkDKxjywLLmwrjLwsdq2ZJwhzDwXuC3Rur1D+nvYAGOjtrffmkR85ZjM2h7CSAnkBXheMiM21UseR8e8EjquLheKD1vnag6Ur0FUd/6sFkPyZJnfi8THYymZrPWsA/h/UzVrUIPqR0+qQeH6jGGynnuBUdSb9Hiupr/dooUZHvWwJRTmvfRgi5/oPTmLHgPu30FVE5vGjVzOR4XK58eC4lDAtWyfjF44CntQvNmOIylaKyKwqOC5ttuXypDAvv7Jf5jkiwkm/vnWIn4yvBLO78kRGPDdi2Jv4COkt4/fgdgDnCzwCq7zPMm4N+yd/Dgfb08h4OMCEC3chDUOHK0j4GvsJpIcjG+k0TURCql1cTJIpQ5s5T1s7Nj70cXSNx//aL7EaS9nVNxeR4COkCA0gPsYSNa3c9WE5BudCv4lKPEkCoagkm+P+UZX0i1L8PwGBjuuvVsfFb4bq2rFxDayRHmFOa49u/nzsntsVGqIFZm1Tara5kS/DfDm37+ka3zj/ZthIGX+yRIzkiaIwP3LYykJx24jGNpsX5eRY+jMs+HwOlN1f7TPNUtD8rbDdfIL+AyUTUDL+2GVnF7aZd+Zl6bYFxdod3nVP+vXxcZV+FyljysadeFwPnvSQMq67Gd3RxY2xBgwdHQvexF2WYfbh0Bo+dZborSvVgVSZMGuXO5jRN7MAiRv7UwpKBxyPQsZA0jSTNiWiUiLvY2udblYowEasUh7hJDGa1s2Ib+FNTF3eW+9r3abRpsshzJ11IpHlu970IcFfUzd8AnPsEoUztN06j5N/03slMzgeJ4CuOXEzHHfbNJiICGXVMCKwt3jIjEVafhdIBVe8wu1TaBP8dJ0WCVWZFi4YQgOt6ywQSLkhSJkH2iP9fJgLgHFRZ5omHD/FpBqX7CuwHel6knR2E8nqLTG9tL7E6ok7ZrAz4F2pLVLDk5TAs1HDQvRzTV4ZL1Sq2mFYc3UGv/7abvFVAD/sylmXShdM4xrx/SK1TIY8/K1G59SkUfEXkxum08Ni9xT8f/k1/OyqsUs9YCxvOLy0J+7LtC/TKyYjdXDnvKniplyOz+sx9zkKuTl8bcBp+GR5e+azea4GD0PMvAe//koQMFIaYaN5PQN9BIeW4Z9qRenmPV3hf+3m4wfKTzjqLX4Kh0UAdZHyO/XwVpTN3SqtAHHkUZz7m9GgLLCouTQrHkN51T6dwxKJGxX8LFxYZCYCcsl+zhfO39ScALdYmG6mtxgk3v/TI8BkVuXJf2AgYm3sUOXbwWFv7TUH2JtIzOscLlec/VEwQ86qyr+7dSHw97sYfYkGHPCu04iBIu6xwd9shJi3DSK3PfapNkk946WiIMpVTuCQbczdLPAS4otRTWIgMzHdc1Tj4ozmcwPqjzg9m57N4JO47nzQ10l8HwyOANDUHttoqv4clA/gfARk++tqzK7x2i5UuRZ3wIQzHFJyNKCEGIXQJp7b3MVhYjNlI/Y50JTzqN9gEeR81LqVRCBwoMdLPCyCPyaFCpVozpHa0+nR0fw2DfYKzGhZu0AtLAgGxBmp5qak88yB+6eZlA1AO0eCehhFAiJiF0C32A3wUGqZSDTvxWt3OrpqKQ9NjJt267dHT+c4sZFneDbspG1WJs8DxLqiBo3wIpa3bIcPmkIGnWArjRV6+qNTLyVZNn1X2iDI8mzYcsD18CFNAzcyYtBUWKJxyKXdy9965ax5v9u/Ywhaww+ojtuuKI+CuX6WJ5zwjYHRwaIowzkkEK5ZAMcm8YRSS1onR7guA915GoH6fWXuq0FXBu9kX3/8k4wirB7vvyL0fYtQ8M08eT4drE0AnA7o54zfhrepgdlYldg6E2kNjSALQMqA5HutOaK+bUHZiGofiNK5nJjgMIbScemzXsJcruiKSejpu8n5WXkNRCR8bj9FWMoTnIhZbhvWDyr/hQSGVDiIe3UedOJfZWaWbM4NwBW+wRFs2dNhUPmgS4BIc693L6ZUMSwrBX9y3LpGpUfGMcHDGj+kmocO/3MlEa+j+3PBVlnjYgEt1ox22akx2mYgXdVjPjJwpVuJK9QTNHRTsBlQXZh8qR+9ySksmWF+Pndrcfmzyh94PIGpRXXey3cH4Llz3X75Ld/qBb9zctmyGHozWAVpmgwpVttzRxV2P/3OAroWm+P+H8aU5aPIDBugmk9sFzQdSo4BYuesTlReeFD60GxT1wCW+rF0WiiZEopfe9ldOb68snjSVB/rJ5y25EQKDrSNUlyaDYh8HRl/I5iMi5iXWoqaCkNAyy462PlId6NqKcXFq/dIu8UlDledmlzdLUkCIqmdOFRZRSTdC4kDv3NJLqDiYI8a6OQlBo20o31lOdAVuqL3Ae+cXJItQAkttimxxV6+2zXYVBuVdlXiCPm8KkQdtnqxEV7Xzj7VCeO3tvrlHxMMV2ulgTJ3I4XKzQ1WM/w1NrwS/za0E5Fp1c0aoEW1g40SOssUBVvHuqQ67gaWFZHiS2ZNJDFfmiHXKZ/w9plyhbHCWG4UJCpdpR6mymvB9DfDaOUi2ffASSTSTW2fjYpio2iJCAM1woruGujpiqWxIeCma50XOnNrV5JzAYMNP/wxm7kuNrQchlncpG2+qX9Wq/r7icKbiUf5RHhfNSiBfqzb8h97c47fsXp3lmIjo9APOIxKov2rpq2N2u6adad3LcCGeaqsUTJyj1Z7uMiGBFR+Ofqor0S5jQxFPOHkDJqUoPE/o1cpa9RuXWBdVceXhcc3Yv6C88nNB05/45j9LCP3tkw8K/fk1yad4vxTTBIpE8Wk/GSeggAieyiKwfEj+7KBmVqnFvCKuHBb+PY2PYMuqQ3EZEz7ruCOZHhax1+LaN0Bmle4h2r/lmKxWGkndmaLt8pL8o7mjxKnoCsD+8coMHwTHzOPH0Mqdk6FqtTR8SyxzvHsofedSUj+Ddp/27zxVnXtvFLCYyFu/NJibkRm8WoAnI3opeTtrqjVXiHclwrGN5NuDLusvIYQSsVRnekLKacPIOR/jhf6L67zpluuAh9a4WCzbAvOt56s+mA/AzEO8hoOybQ2HmHNoMv48mmOgqJ4NkUrIYyQIbb98X8ZeQsqYf7ypEPa39yDb4T5KJzQDJsxrmHwco+/E48vh4tQXBqWqHug5HXhCkK/0nsYbmy4+XYdLMdj0HLPSIIUA0tRFSITEzz2L2f91BW+pQ3LFWzuf3Uj9qWGBhOFUkEQp30sCdvQn4wssis51EgrPXOdQVcCUJ/h4OEA+MVBZJhGJ+0buTpI1JNIewessrs9ejkpjfQtJ5NiKhjOmOQCa7vSed05pRBiqzMVvO6jyuD2++4QOAbptYEFYJanRL2N2bq3Zk/L+8WnttdseB9rg8JevU8bspFOjFnWXdOfAWUNgsmuyJSLh3/hXxkXUAVm3rlTpMmDN7W35Kw37KltSNCO/nLkaQMjS7AMPa34xQEnsvQA0NLuGRl0/h2kD44gpIYyY/dyW+KWdfS28Ao89iFbJ9CxTofyPkqBGM0+yVlWoLBLD7rVy9NZk8pBD+ftt7O4QVfLUsd3KleSIx2RiyIl8MyR62TgW80x5UJlyuPR9F/w+gD+emqO6oUVLlgvBGgMfjUhYdEScZEftorTG7Ko/QLeAho8pk06Apd0fx86t2cM6F1tSzhZOBxo/uwPcl9MV3JUTh82cSkgn5/JGZAKgCx+pYu3+5l85nD2p9PJffiHD6f7h1Q6pGcQJxbmVVlhg/wxIiKnWsGeD3T468O4U0dMlDWhuSk18F1wKocR4LhBfeRRV46s78Owz+EpAkNaB8GcTecXm1NkdqDn++yeGzIvG/D4ObQd9wryxw3c8DHIj9ru2fHCLKLBH055z90AZJWKa9GZkFZqh0BmUyWINFmuycgp1u7b+21z/2LyPBerQhmgdJ0T+6n8sx4M6LUFnlwArnJCr60VPRjIb1Oq1Izqd2yuTfV0CNY5tRPAyyhqQJJlfxfJ7weJIeOjb/rF+3BUxxcs6W3JDlEaxwqrL40Z60IpIXqLO9y8ePHWSUJuRvyWYXCBRNEJoDWUaxcImNTX92J5dJ7HdTD5XrMc3u8YbZ/YOQAAAABFWElGXwAAAElJKgAIAAAAAQBphwQAAQAAABoAAAAAAAAAAQCGkgcAMgAAACwAAAAAAAAAQVNDSUkAAAAxLjE3LjUtMjEwLVBLTUUyT0hURFNXSzJQNkVUTE9RSjJJNFJFLjAuMi0zAA==" rel="apple-touch-icon" type="image/x-icon"/>
<!--== CSS ==============================================================-->
<style type="text/css">
    /* <![CDATA[ */
    body {
        margin: 0;
    }

    .barrier path {
      stroke-width: 2;
      stroke-linejoin: round;
    }

    .hud-background {
      stroke: none;
      fill: white;
      fill-opacity: 0.8;      
    }

    .hud-foreground {
      stroke: black;
      stroke-linejoin: round;
      stroke-linecap: round;
      fill: none;
    }

    text {
      font-family: sans-serif;
      font-weight: bold;
    }

    * {cursor:crosshair}

    #fullscreen {
      border: 3px solid black;
      border-top: none;
      background: white;
      padding: 5px;

      position: fixed;
      left: 50%;
      transform: translateX(-50%);

      top: 0px;
      transition-property: top;
      transition-duration: 1s;
    }

    :fullscreen > #fullscreen {
      top: -120%;
    }

    #fullscreen button {
      border: none;
      background: none;

      color: red;
      font-weight: bold;
      white-space: nowrap;
    }

    /* ]]> */
  </style>
<style title="style-hide-mouse" type="text/css">
    /* <![CDATA[ */
    * {cursor:none}
    /* ]]> */
  </style>
</head>
<script data-src="/js/main.js" type="application/javascript"><!--//--><![CDATA[//><!--

//--><!]]></script>
<body>
<svg baseprofile="full" style="position: fixed; width: 100%; height: 100%; margin: 0; background: white" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<!--== TUNNEL ===============================================================-->
<svg height="100%" id="tunnel" preserveaspectratio="xMidYMid meet" viewbox="-100 -100 200 200" visibility="hidden" width="100%">
</svg>
<!--== EXPLOSION!!!! ========================================================-->
<svg height="100%" preserveaspectratio="xMidYMid meet" viewbox="-100 -100 200 200" visibility="visible" width="100%">
<path d="m -0.63488,-4.3752
            c  0.24879,1.233, 1.1883,2.6366, 1.768,0.69037
               0.74264,0.71431, 1.2069,0.6277, 1.6362,-0.5115
              -0.034821,1.0871, 0.096633,1.6827, 0.74401,1.7541
              -0.091757,1.4249, 0.70746,2.0783, 1.2188,1.8749
              -0.894,0.93533, -0.4517,1.2793, -0.1438,1.9055
              -0.6904,0.3722, -0.6323,1.1294, -0.2202,2.0686 
              -0.8022,-0.0916, -1.2136,0.497, -0.9903,2.1906
              -0.5751,-0.6694, -1.2232,-0.5666, -1.4943,1.3293
              -0.162,-1.1736, -0.4604,-2.6908, -1.3395,-1.1883
              -0.49014,-2.0469, -0.93497,-0.738, -1.3874,0.0043
               0.10639,-0.88002, 0.073166,-1.5303, -0.60252,-1.123
               0.44939,-0.82156, 1.0157,-1.7132, -0.041883,-3.03
               0.45163,-1.7508, 0.018089,-2.1904, -0.50161,-2.5024
               0.67964,-1.0053, 0.49818,-2.0107, 0.28858,-3.016
               0.52476,1.1059, 0.93462,1.3608, 1.0661,-0.4466
            z
            m -0.15082,-1.5778
            c  0.074098,2.0969, -0.58436,1.8254, -1.3271,1.2814
               0.54867,2.1298, 0.033405,2.9625, -0.45613,3.8265
               1.306,0.68211, 0.96098,2.0011, 0.39794,3.4043
               1.3865,-0.46902, 1.0123,0.84256, 0.083778,2.7148
               0.6771,-0.1353, 1.0998,-0.2861, 1.0191,1.6048
               0.47854,-1.0645, 1.3389,-2.4648, 1.4732,1.0237
               0.69655,-2.8185, 1.0794,-1.349, 1.487,0.2973
               0.3541,-1.4463, 0.8078,-2.8978, 1.864,-1.3746
              -0.1962,-1.8445, -0.125,-3.2698, 1.3195,-2.5424
              -1.163,-2.1605, -0.2327,-2.5422, 0.3352,-3.2319
              -1.4432,-0.2307, -0.4485,-0.83498, -0.0527,-1.9151
              -1.2304,-0.5137, -1.6742,-1.4126, -1.2459,-2.7388
              -0.9898,1.2593, -0.9672,-0.606, -1.131,-1.896
              -0.51549,1.084, -0.9993,2.4142, -1.8584,0.82793
              -0.92276,2.4614, -1.531,0.17894, -1.9087,-1.2819
            z" fill="#f5bd3c" id="explosion" stroke="#ff2626" stroke-width="0.5" transform="scale(3,3)" visibility="hidden"><animate attributename="d" dur="0.4s" fill="freeze" values="m -0.63488,-4.3752
                   c  0.24879,1.233, 1.1883,2.6366, 1.768,0.69037
                      0.74264,0.71431, 1.2069,0.6277, 1.6362,-0.5115
                     -0.034821,1.0871, 0.096633,1.6827, 0.74401,1.7541
                     -0.091757,1.4249, 0.70746,2.0783, 1.2188,1.8749
                     -0.894,0.93533, -0.4517,1.2793, -0.1438,1.9055
                     -0.6904,0.3722, -0.6323,1.1294, -0.2202,2.0686
                     -0.8022,-0.0916, -1.2136,0.497, -0.9903,2.1906
                     -0.5751,-0.6694, -1.2232,-0.5666, -1.4943,1.3293
                     -0.162,-1.1736, -0.4604,-2.6908, -1.3395,-1.1883
                     -0.49014,-2.0469, -0.93497,-0.738, -1.3874,0.0043
                      0.10639,-0.88002, 0.073166,-1.5303, -0.60252,-1.123
                      0.44939,-0.82156, 1.0157,-1.7132, -0.041883,-3.03
                      0.45163,-1.7508, 0.018089,-2.1904, -0.50161,-2.5024
                      0.67964,-1.0053, 0.49818,-2.0107, 0.28858,-3.016
                      0.52476,1.1059, 0.93462,1.3608, 1.0661,-0.4466
                   z
                   m -0.15082,-1.5778
                   c  0.074098,2.0969, -0.58436,1.8254, -1.3271,1.2814
                      0.54867,2.1298, 0.033405,2.9625, -0.45613,3.8265
                      1.306,0.68211, 0.96098,2.0011, 0.39794,3.4043
                      1.3865,-0.46902, 1.0123,0.84256, 0.083778,2.7148
                      0.6771,-0.1353, 1.0998,-0.2861, 1.0191,1.6048
                      0.47854,-1.0645, 1.3389,-2.4648, 1.4732,1.0237
                      0.69655,-2.8185, 1.0794,-1.349, 1.487,0.2973
                      0.3541,-1.4463, 0.8078,-2.8978, 1.864,-1.3746
                     -0.1962,-1.8445, -0.125,-3.2698, 1.3195,-2.5424
                     -1.163,-2.1605, -0.2327,-2.5422, 0.3352,-3.2319
                     -1.4432,-0.2307, -0.4485,-0.83498, -0.0527,-1.9151
                     -1.2304,-0.5137, -1.6742,-1.4126, -1.2459,-2.7388
                     -0.9898,1.2593, -0.9672,-0.606, -1.131,-1.896
                     -0.51549,1.084, -0.9993,2.4142, -1.8584,0.82793
                     -0.92276,2.4614, -1.531,0.17894, -1.9087,-1.2819
                   z;
  
                   m -28.703,-29.65
                   c  3.1162,7.1472, 14.884,15.283, 22.145,4.0018
                      9.3018,4.1406, 15.117,3.6386, 20.494,-2.965
                     -0.43617,6.3017, 1.2104,9.7538, 9.3191,10.168
                     -1.1493,8.2598, 8.8612,12.047, 15.265,10.868
                     -11.198,5.4215, -5.657,7.4156, -1.8,11.045,-8.648
                      2.1575,-7.92, 6.5469,-2.759, 11.991,-10.048
                     -0.531,-15.201, 2.881,-12.404, 12.698,-7.203
                     -3.88,-15.32, -3.284,-18.716, 7.706,-2.0291
                     -6.803,-5.7675, -15.598,-16.779, -6.888,-6.1392
                     -11.865,-11.711, -4.2781,-17.378, 0.0251,1.3326
                     -5.1012,0.91647, -8.8704,-7.5468, -6.5096,5.6288
                     -4.7623,12.722, -9.931,-0.52467, -17.564,5.6568
                     -10.149,0.22658, -12.697,-6.2829, -14.505,8.5128
                     -5.8277,6.2399, -11.655,3.6145, -17.483,6.5728
                      6.4104,11.707, 7.888,13.353, -2.5888
                   z
                   m -1.8891,-9.146
                   c  0.9281,12.155, -7.3194,10.581, -16.623,7.4278
                      6.8723,12.346, 0.4184,17.172, -5.7132,22.181
                      16.358,3.954, 12.037,11.6, 4.9844,19.733
                      17.367,-2.7187, 12.68,4.884, 1.0493,15.737
                      8.4809,-0.78413, 13.776,-1.6578, 12.764,9.3027
                      5.9945,-6.1707, 16.771,-14.287, 18.454,5.9344
                      8.7251,-16.338, 13.519,-7.8198, 18.626,1.7233
                      4.4356,-8.384, 10.119,-16.798, 23.349,-7.968
                     -2.458,-10.692, -1.566,-18.955, 16.527,-14.738
                     -14.567,-12.524, -2.916,-14.736, 4.197,-18.734
                     -18.076,-1.3376, -5.617,-4.8404, -0.66,-11.102
                     -15.41,-2.9776, -20.969,-8.1886, -15.605,-15.876
                     -12.398,7.2993, -12.115,-3.5128, -14.166,-10.991
                     -6.4567,6.2837, -12.517,13.994, -23.277,4.7992
                     -11.558,14.268,-19.177,1.0372,-23.907,-7.4309
                   z"></animate>
</path>
</svg>
<!--== HUD ==================================================================-->
<g id="hud" visibility="hidden">
<svg preserveaspectratio="xMinYMid meet" viewbox="0 0 0.1 1">
<g transform="translate(0.02, 0.98), scale(0.15,-0.15)">
<!-- Radar Scope -->
<g>
<circle class="hud-background" cx="0.5" cy="0.5" r="0.5"></circle>
<circle clip-path="url(#hud-radar-scope-clip-path)" cx="0.5" cy="0.5" fill="#777777" id="hud-radar-scope-missile-target" r="0.04" stroke="none"></circle>
<circle clip-path="url(#hud-radar-scope-clip-path)" fill="#111111" id="hud-radar-scope-missile" r="0.04" stroke="none"></circle>
<circle class="hud-foreground" cx="0.5" cy="0.5" r="0.5" stroke-width="0.04"></circle>
<clippath id="hud-radar-scope-clip-path">
<circle cx="0.5" cy="0.5" r="0.5"></circle>
</clippath>
</g>
<!-- Speedometer-->
<g>
<g transform="translate(1.1,0.1), scale(1.8,1.8)">
<rect class="hud-background" height="0.122" width="1.0"></rect>
<rect clip-path="url(#hud-speedometer-bar-clip-path)" fill="#333333" height="0.122" id="hud-speedometer-bar" stroke="none" width="1.0" x="-0.5"></rect>
<rect class="hud-foreground" height="0.122" stroke-width="0.02" width="1.0"></rect>
<clippath id="hud-speedometer-bar-clip-path">
<rect height="0.122" width="0.5"></rect>
</clippath>
</g>
<text id="hud-speedometer-label-text" transform="translate(1.2, 0.4), scale(0.012,-0.012)">SPEED</text>
<text id="hud-speedometer-speed-text" transform="translate(3, 0.1), scale(0.02,-0.02)"></text>
<clippath id="speedometer-clip-path">
<rect height="0.22" width="1.8" x="1.1" y="0.1"></rect>
</clippath>
</g>
<!-- Lives Indicator ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<g>
<defs>
<g id="hud-lives-indicator-missile" transform="rotate(-65), translate(0,-0.5), scale(0.6,0.6)">
<path d="m -0.07, 0.01
                      L -0.2, -0.07
                      L  0.0,  0.6
                      L  0.2, -0.07
                      L  0.07, 0.01" stroke-width="0.04" style="fill:white; stroke: black; stroke-linejoin:round;"></path>
<path d="m -0.07, 0.0
                      C -0.12, 0.4 -0.12,0.8  0.0,  1.0
                      C  0.12, 0.8  0.12,0.4  0.07, 0.0
                      z" fill="white" stroke="black" stroke-width="0.04"></path>
</g>
</defs>
<use id="hud-lives-indicator-missile-1" transform="translate(0.6,1.4)" visibility="hidden" xlink:href="#hud-lives-indicator-missile"></use>
<use id="hud-lives-indicator-missile-2" transform="translate(0.6,1.7)" visibility="hidden" xlink:href="#hud-lives-indicator-missile"></use>
<use id="hud-lives-indicator-missile-3" transform="translate(0.6,2.0)" visibility="hidden" xlink:href="#hud-lives-indicator-missile"></use>
<use id="hud-lives-indicator-missile-4" transform="translate(0.6,2.3)" visibility="hidden" xlink:href="#hud-lives-indicator-missile"></use>
<use id="hud-lives-indicator-missile-5" transform="translate(0.6,2.6)" visibility="hidden" xlink:href="#hud-lives-indicator-missile"></use>
<g id="hud-lives-indicator-infinite" transform="translate(0.5,1.5)" visibility="hidden">
<use transform="translate(0.3,0.15), scale(1.4,1.4)" xlink:href="#hud-lives-indicator-missile"></use>
<path d="m  0.0, 0.04
                    C  0.5, 0.5  0.5,-0.5  0.0,-0.04
                    C -0.5,-0.5 -0.5, 0.5  0.0, 0.04
                    M  0.035, 0.0
                    C  0.43,-0.4  0.43, 0.4  0.035, 0.0
                    M  -0.035, 0.0
                    C  -0.43, 0.4 -0.43,-0.4 -0.035, 0.0" stroke="white" stroke-opacity="0.2" stroke-width="0.02"></path>
</g>
<g id="hud-lives-indicator-none" transform="translate(0.5,1.5)" visibility="visible">
<use transform="translate(0.3,0.15), scale(1.4,1.4)" xlink:href="#hud-lives-indicator-missile"></use>
<path d="M  0.0, 0.4
                    A  0.4, 0.4  0 0,0  0.4, 0.0
                    A  0.4, 0.4  0 0,0  0.0,-0.4
                    A  0.4, 0.4  0 0,0 -0.4, 0.0
                    A  0.4, 0.4  0 0,0  0.0, 0.4
                    z
                    M  0.26,-0.20
                    A  0.328,0.328, 0 0,1 -0.20,0.26
                    z
                    M  -0.26,0.20
                    A  0.328,0.328, 0 0,1 0.20,-0.26
                    z" stroke="white" stroke-opacity="0.2" stroke-width="0.02" transform="scale(0.8,0.8)"></path>
</g>
</g>
</g>
<!-- Level Indicator ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<text id="hud-level-indicator" transform="translate(0.035, 0.035), scale(0.0025,0.0025)"></text>
<!-- Frame Rate Indicator ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<text fill="#333333" id="hud-frame-rate-indicator" transform="translate(0.035, 0.08), scale(0.0025,0.0025)"></text>
</svg>
<svg preserveaspectratio="xMaxYMid meet" viewbox="0 0 0.06 1">
<!-- Progress Indicator ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<g transform="translate(0,0.965), scale(0.95,-0.95)">
<path d="M  0.03   0.0
                l -0.04   0.0
                  -0.005  0.005
                   0.0    0.26
                   0.02   0.02
                   0.0    0.72
                   0.025  0
                z" fill="white" opacity="0.8" stroke="#333333" stroke-width="0.0005"></path>
<text opacity="0.8" transform="translate(0.024,0.01), rotate(90), scale(0.0026,-0.0026)">PROGRESS</text>
<g id="hud-progress-indicator-best-progress" transform="translate(0,0.2)">
<rect fill="#777777" height="0.008" width="0.04" x="-0.01"></rect>
<text fill="#777777" transform="translate(-0.04,-0.002), scale(0.001,-0.001)">PB</text>
</g>
<g id="hud-progress-indicator-progress" transform="translate(0,0.2)">
<rect fill="#333333" height="0.008" width="0.04" x="-0.01"></rect>
</g>
<path class="hud-foreground" d="m 0, 1.005
                L 0.03, 1.005
                  0.03, 0
                  0, 0" stroke-width="0.006"></path>
</g>
</svg>
</g>
<!--== FOG ==================================================================-->
<rect fill="white" height="100%" id="fog" opacity="1" width="100%"></rect>
<!--== BANNER ===============================================================-->
<svg height="100%" id="banner" overflow="visible" preserveaspectratio="xMaxYMid meet" viewbox="0 0 0.01 1" visibility="hidden" width="130%">
<rect fill="#000" height="0.2" opacity="0.95" stroke-linecap="round" stroke-linejoin="round" stroke-width="0.005" width="6" x="-0.1" y="0.45"></rect>
<g transform="translate(-0.05,0.54) scale(0.004,0.004)">
<text fill="#fff" id="banner-title"></text>
</g>
<g transform="translate(0.25,0.6) scale(0.0025,0.0025)">
<text fill="#ccc" id="banner-text"></text>
</g>
</svg>
<defs>
<!--== BARRIER PATHS ========================================================-->
<path d="M 100,0
            A 100,100 0 0,1 0,100
            A 100,100 0 0,1 -100,0
            A 100,100 0 0,1 0,-100
            A 100,100 0 0,1 100,0
            z
  
            M 0,90
            A 90,90 0 0,0 90,0
            L 30,0
            A 30,30 0 0,1 0,30
            z
  
            M 0,-90
            A 90,90 0 0,0 -90,0
            L -30,0
            A 30,30 0 0,1 0,-30
            z" id="barrier-path-1"></path>
<path d="M 100,0
            A 100,100 0 0,1  0,   100
            A 100,100 0 0,1 -100, 0
            A 100,100 0 0,1  0,  -100
            A 100,100 0 0,1  100, 0
            z
  
            M 80,0
            A 30,30 0 0,0  50,-30
            A 30,30 0 0,0  20, 0
            A 30,30 0 0,0  50, 30
            A 30,30 0 0,0  80, 0
            z
  
  
            M 5,-43.3
            A 30,30 0 0,0 -25, -73.3
            A 30,30 0 0,0 -55, -43.3
            A 30,30 0 0,0 -25, -13.3
            A 30,30 0 0,0  5,  -43.3
            z
  
  
            M 5,43.3
            A 30,30 0 0,0 -25, 13.3
            A 30,30 0 0,0 -55, 43.3
            A 30,30 0 0,0 -25, 73.3
            A 30,30 0 0,0  5,  43.3
            z" id="barrier-path-2"></path>
<path d="M 100,0
            A 100,100 0 0,1  0,   100
            A 100,100 0 0,1 -100, 0
            A 100,100 0 0,1  0,  -100
            A 100,100 0 0,1  100, 0
            z
  
            M 0,90
            A 90,90 0 0,0 90,0
            L 30,0
            A 30,30 0 0,0  0, -30
            A 30,30 0 0,0 -30, 0
            A 30,30 0 0,0  0,  30
            z" id="barrier-path-3"></path>
<path d="M 100,0
            A 100,100 0 0,1  0,   100
            A 100,100 0 0,1 -100, 0
            A 100,100 0 0,1  0,  -100
            A 100,100 0 0,1  100, 0
            z
  
            M -30.78,84.57
            A 90,90 0 0,0 90,0
            L 30,0
            A 30,30 0 0,1 -10.26,28.19
            z" id="barrier-path-4"></path>
<path d="M 100,0
            A 100,100 0 0,1  0,   100
            A 100,100 0 0,1 -100, 0
            A 100,100 0 0,1  0,  -100
            A 100,100 0 0,1  100, 0
            z
  
            M 45,77.94
            A 90,90 0 0,0 45,-77.94
            L 45,-45
            A 58,58 0 0,0 45,45
            z
  
            M -45,-77.94
            A 90,90 0 0,0 -45,77.94
            L -45,45
            A 58,58 0 0,0 -45,-45
            z" id="barrier-path-5"></path>
<path d="M 100,0
            A 100,100 0 0,1  0,   100
            A 100,100 0 0,1 -100, 0
            A 100,100 0 0,1  0,  -100
            A 100,100 0 0,1  100, 0
            z
  
            M  80, 25
            L  80,-25
            L -80,-25
            L -80, 25
            z" id="barrier-path-6"></path>
<path d="M 100,0
            A 100,100 0 0,1  0,   100
            A 100,100 0 0,1 -100, 0
            A 100,100 0 0,1  0,  -100
            A 100,100 0 0,1  100, 0
            z
  
            M 90,0
            A 90,90 0 0,0  0, -90
            A 90,90 0 0,0 -90, 0
            A 90,90 0 0,0  0,  90
            A 90,90 0 0,0  90, 0
            z" id="barrier-path-blank"></path>
<path d="M 100,0
            A 100,100 0 0,1  0,   100
            A 100,100 0 0,1 -100, 0
            A 100,100 0 0,1  0,  -100
            A 100,100 0 0,1  100, 0
            z
  
            M 90,0
            A 90,90 0 0,0  -63.63,  -63.63
            L -53.03,-53.03
            A 75,75 0 0,0  -75,0
            L -90,0
            A 90,90 0 0,0  63.63,63.63
            L 53.03,53.03
            A 75,75 0 0,0  75,0
            z" id="barrier-path-finish"></path>
<!-- Collision Detection -->
<line id="collision-line" x1="-300" x2="100" y1="100" y2="100"></line>
</defs>
</svg>
<div id="fullscreen">
<button onclick="
      document.body.requestFullscreen();
      event.stopPropagation();
      event.preventDefault();
    ">ENTER FULLSCREEN</button>
</div>
<!--== SCRIPTS ==============================================================-->
<!-- 2d geometry SVG library -->
<script data-src="lib/2D.js" type="application/javascript"><!--//--><![CDATA[//><!--
Array.prototype.foreach=function(func){var length=this.length;for(var i=0;i<length;i++){func(this[i]);}};
Array.prototype.grep=function(func){var length=this.length;var result=[];for(var i=0;i<length;i++){var elem=this[i];if(func(elem)){result.push(elem);}}return result;};
Array.prototype.map=function(func){var length=this.length;var result=[];for(var i=0;i<length;i++){result.push(func(this[i]));}return result;};
Array.prototype.min=function(){var length=this.length;var min=this[0];for(var i=0;i<length;i++){var elem=this[i];if(elem<min)min=elem;}return min;}
Array.prototype.max=function(){var length=this.length;var max=this[0];for(var i=0;i<length;i++)var elem=this[i];if(elem>max)max=elem;return max;}
AntiZoomAndPan.VERSION="1.2"
function AntiZoomAndPan(){this.init();}
AntiZoomAndPan.prototype.init=function(){var svgRoot=svgDocument.documentElement;this.svgNodes=new Array();this.x_trans=0;this.y_trans=0;this.scale=1;this.lastTM=svgRoot.createSVGMatrix();svgRoot.addEventListener('SVGZoom',this,false);svgRoot.addEventListener('SVGScroll',this,false);svgRoot.addEventListener('SVGResize',this,false);};
AntiZoomAndPan.prototype.appendNode=function(svgNode){this.svgNodes.push(svgNode);};
AntiZoomAndPan.prototype.removeNode=function(svgNode){for(var i=0;i<this.svgNodes.length;i++){if(this.svgNodes[i]===svgNode){this.svgNodes.splice(i,1);break;}}};
AntiZoomAndPan.prototype.handleEvent=function(e){var type=e.type;if(this[type]==null)throw new Error("Unsupported event type: "+type);this[type](e);};
AntiZoomAndPan.prototype.SVGZoom=function(e){this.update();};
AntiZoomAndPan.prototype.SVGScroll=function(e){this.update();};
AntiZoomAndPan.prototype.SVGResize=function(e){this.update();};
AntiZoomAndPan.prototype.update=function(){if(this.svgNodes.length>0){var svgRoot=svgDocument.documentElement;var viewbox=(window.ViewBox!=null)?new ViewBox(svgRoot):null;var matrix=(viewbox!=null)?viewbox.getTM():svgRoot.createSVGMatrix();var trans=svgRoot.currentTranslate;matrix=matrix.scale(1.0/svgRoot.currentScale);matrix=matrix.translate(-trans.x,-trans.y);for(var i=0;i<this.svgNodes.length;i++){var node=this.svgNodes[i];var CTM=matrix.multiply(this.lastTM.multiply(node.getCTM()));var transform="matrix("+[CTM.a,CTM.b,CTM.c,CTM.d,CTM.e,CTM.f].join(",")+")";this.svgNodes[i].setAttributeNS(null,"transform",transform);}this.lastTM=matrix.inverse();}};
EventHandler.VERSION=1.0;
function EventHandler(){this.init();};
EventHandler.prototype.init=function(){};
EventHandler.prototype.handleEvent=function(e){if(this[e.type]==null)throw new Error("Unsupported event type: "+e.type);this[e.type](e);};var svgns="http://www.w3.org/2000/svg";
Mouser.prototype=new EventHandler();
Mouser.prototype.constructor=Mouser;
Mouser.superclass=EventHandler.prototype;
function Mouser(){this.init();}
Mouser.prototype.init=function(){this.svgNode=null;this.handles=new Array();this.shapes=new Array();this.lastPoint=null;this.currentNode=null;this.realize();};
Mouser.prototype.realize=function(){if(this.svgNode==null){var rect=svgDocument.createElementNS(svgns,"rect");this.svgNode=rect;rect.setAttributeNS(null,"x","-16384");rect.setAttributeNS(null,"y","-16384");rect.setAttributeNS(null,"width","32767");rect.setAttributeNS(null,"height","32767");rect.setAttributeNS(null,"fill","none");rect.setAttributeNS(null,"pointer-events","all");rect.setAttributeNS(null,"display","none");svgDocument.documentElement.appendChild(rect);}};
Mouser.prototype.register=function(handle){if(this.handleIndex(handle)==-1){var owner=handle.owner;handle.select(true);this.handles.push(handle);if(owner!=null&&this.shapeIndex(owner)==-1)this.shapes.push(owner);}};
Mouser.prototype.unregister=function(handle){var index=this.handleIndex(handle);if(index!=-1){handle.select(false);this.handles.splice(index,1);}};
Mouser.prototype.registerShape=function(shape){if(this.shapeIndex(shape)==-1){shape.select(true);this.shapes.push(shape);}};
Mouser.prototype.unregisterShape=function(shape){var index=this.shapeIndex(shape);if(index!=-1){shape.select(false);shape.selectHandles(false);shape.showHandles(false);shape.unregisterHandles();this.shapes.splice(index,1);}};
Mouser.prototype.unregisterAll=function(){for(var i=0;i<this.handles.length;i++){this.handles[i].select(false);}this.handles=new Array();};
Mouser.prototype.unregisterShapes=function(){for(var i=0;i<this.shapes.length;i++){var shape=this.shapes[i];shape.select(false);shape.selectHandles(false);shape.showHandles(false);shape.unregisterHandles();}this.shapes=new Array();};
Mouser.prototype.handleIndex=function(handle){var result=-1;for(var i=0;i<this.handles.length;i++){if(this.handles[i]===handle){result=i;break;}}return result;};
Mouser.prototype.shapeIndex=function(shape){var result=-1;for(var i=0;i<this.shapes.length;i++){if(this.shapes[i]===shape){result=i;break;}}return result;};
Mouser.prototype.beginDrag=function(e){this.currentNode=e.target;var svgPoint=this.getUserCoordinate(this.currentNode,e.clientX,e.clientY);this.lastPoint=new Point2D(svgPoint.x,svgPoint.y);this.svgNode.addEventListener("mouseup",this,false);this.svgNode.addEventListener("mousemove",this,false);svgDocument.documentElement.appendChild(this.svgNode);this.svgNode.setAttributeNS(null,"display","inline");};
Mouser.prototype.mouseup=function(e){this.lastPoint=null;this.currentNode=null;this.svgNode.removeEventListener("mouseup",this,false);this.svgNode.removeEventListener("mousemove",this,false);this.svgNode.setAttributeNS(null,"display","none");};
Mouser.prototype.mousemove=function(e){var svgPoint=this.getUserCoordinate(this.currentNode,e.clientX,e.clientY);var newPoint=new Point2D(svgPoint.x,svgPoint.y);var delta=newPoint.subtract(this.lastPoint);var updates=new Array();var updateId=new Date().getTime();this.lastPoint.setFromPoint(newPoint);for(var i=0;i<this.handles.length;i++){var handle=this.handles[i];var owner=handle.owner;handle.translate(delta);if(owner!=null){if(owner.lastUpdate!=updateId){owner.lastUpdate=updateId;updates.push(owner);}}else{updates.push(handle);}}for(var i=0;i<updates.length;i++){updates[i].update();}};
Mouser.prototype.getUserCoordinate=function(node,x,y){var svgRoot=svgDocument.documentElement;var pan=svgRoot.currentTranslate;var zoom=svgRoot.currentScale;var CTM=this.getTransformToElement(node);var iCTM=CTM.inverse();var worldPoint=svgDocument.documentElement.createSVGPoint();worldPoint.x=(x-pan.x)/zoom;worldPoint.y=(y-pan.y)/zoom;return worldPoint.matrixTransform(iCTM);};
Mouser.prototype.getTransformToElement=function(node){var CTM=node.getCTM();while((node=node.parentNode)!=svgDocument){CTM=node.getCTM().multiply(CTM);}return CTM;};
ViewBox.VERSION="1.0";
function ViewBox(svgNode){if(arguments.length>0){this.init(svgNode);}}
ViewBox.prototype.init=function(svgNode){var viewBox=svgNode.getAttributeNS(null,"viewBox");var preserveAspectRatio=svgNode.getAttributeNS(null,"preserveAspectRatio");if(viewBox!=null&&viewBox!=""){var params=viewBox.split(/\s*,\s*|\s+/);this.x=parseFloat(params[0]);this.y=parseFloat(params[1]);this.width=parseFloat(params[2]);this.height=parseFloat(params[3]);}else{this.x=0;this.y=0;this.width=innerWidth;this.height=innerHeight;}this.setPAR(preserveAspectRatio);};
ViewBox.prototype.getTM=function(){var svgRoot=svgDocument.documentElement;var matrix=svgDocument.documentElement.createSVGMatrix();var windowWidth=svgRoot.getAttributeNS(null,"width");var windowHeight=svgRoot.getAttributeNS(null,"height");if(windowWidth!=null&&windowWidth!=""){windowWidth=parseFloat(windowWidth);}else{if(window.innerWidth){windowWidth=innerWidth;}else{windowWidth=document.documentElement.viewport.width;}}if(windowHeight!=null&&windowHeight!=""){windowHeight=parseFloat(windowHeight);}else{if(window.innerHeight){windowHeight=innerHeight;}else{windowHeight=document.documentElement.viewport.height;}}var x_ratio=this.width/windowWidth;var y_ratio=this.height/windowHeight;matrix=matrix.translate(this.x,this.y);if(this.alignX=="none"){matrix=matrix.scaleNonUniform(x_ratio,y_ratio);}else{if(x_ratio<y_ratio&&this.meetOrSlice=="meet"||x_ratio>y_ratio&&this.meetOrSlice=="slice"){var x_trans=0;var x_diff=windowWidth*y_ratio-this.width;if(this.alignX=="Mid")x_trans=-x_diff/2;else if(this.alignX=="Max")x_trans=-x_diff;matrix=matrix.translate(x_trans,0);matrix=matrix.scale(y_ratio);}else if(x_ratio>y_ratio&&this.meetOrSlice=="meet"||x_ratio<y_ratio&&this.meetOrSlice=="slice"){var y_trans=0;var y_diff=windowHeight*x_ratio-this.height;if(this.alignY=="Mid")y_trans=-y_diff/2;else if(this.alignY=="Max")y_trans=-y_diff;matrix=matrix.translate(0,y_trans);matrix=matrix.scale(x_ratio);}else{matrix=matrix.scale(x_ratio);}}return matrix;}
ViewBox.prototype.setPAR=function(PAR){if(PAR){var params=PAR.split(/\s+/);var align=params[0];if(align=="none"){this.alignX="none";this.alignY="none";}else{this.alignX=align.substring(1,4);this.alignY=align.substring(5,9);}if(params.length==2){this.meetOrSlice=params[1];}else{this.meetOrSlice="meet";}}else{this.align="xMidYMid";this.alignX="Mid";this.alignY="Mid";this.meetOrSlice="meet";}};
function Intersection(status){if(arguments.length>0){this.init(status);}}
Intersection.prototype.init=function(status){this.status=status;this.points=new Array();};
Intersection.prototype.appendPoint=function(point){this.points.push(point);};
Intersection.prototype.appendPoints=function(points){this.points=this.points.concat(points);};
Intersection.intersectShapes=function(shape1,shape2){var ip1=shape1.getIntersectionParams();var ip2=shape2.getIntersectionParams();var result;if(ip1!=null&&ip2!=null){if(ip1.name=="Path"){result=Intersection.intersectPathShape(shape1,shape2);}else if(ip2.name=="Path"){result=Intersection.intersectPathShape(shape2,shape1);}else{var method;var params;if(ip1.name<ip2.name){method="intersect"+ip1.name+ip2.name;params=ip1.params.concat(ip2.params);}else{method="intersect"+ip2.name+ip1.name;params=ip2.params.concat(ip1.params);}if(!(method in Intersection))throw new Error("Intersection not available: "+method);result=Intersection[method].apply(null,params);}}else{result=new Intersection("No Intersection");}return result;};
Intersection.intersectPathShape=function(path,shape){return path.intersectShape(shape);};
Intersection.intersectBezier2Bezier2=function(a1,a2,a3,b1,b2,b3){var a,b;var c12,c11,c10;var c22,c21,c20;var TOLERANCE=1e-4;var result=new Intersection("No Intersection");a=a2.multiply(-2);c12=a1.add(a.add(a3));a=a1.multiply(-2);b=a2.multiply(2);c11=a.add(b);c10=new Point2D(a1.x,a1.y);a=b2.multiply(-2);c22=b1.add(a.add(b3));a=b1.multiply(-2);b=b2.multiply(2);c21=a.add(b);c20=new Point2D(b1.x,b1.y);var a=c12.x*c11.y-c11.x*c12.y;var b=c22.x*c11.y-c11.x*c22.y;var c=c21.x*c11.y-c11.x*c21.y;var d=c11.x*(c10.y-c20.y)+c11.y*(-c10.x+c20.x);var e=c22.x*c12.y-c12.x*c22.y;var f=c21.x*c12.y-c12.x*c21.y;var g=c12.x*(c10.y-c20.y)+c12.y*(-c10.x+c20.x);var poly=new Polynomial(-e*e,-2*e*f,a*b-f*f-2*e*g,a*c-2*f*g,a*d-g*g);var roots=poly.getRoots();for(var i=0;i<roots.length;i++){var s=roots[i];if(0<=s&&s<=1){var xRoots=new Polynomial(-c12.x,-c11.x,-c10.x+c20.x+s*c21.x+s*s*c22.x).getRoots();var yRoots=new Polynomial(-c12.y,-c11.y,-c10.y+c20.y+s*c21.y+s*s*c22.y).getRoots();if(xRoots.length>0&&yRoots.length>0){checkRoots:for(var j=0;j<xRoots.length;j++){var xRoot=xRoots[j];if(0<=xRoot&&xRoot<=1){for(var k=0;k<yRoots.length;k++){if(Math.abs(xRoot-yRoots[k])<TOLERANCE){result.points.push(c22.multiply(s*s).add(c21.multiply(s).add(c20)));break checkRoots;}}}}}}}return result;};
Intersection.intersectBezier2Bezier3=function(a1,a2,a3,b1,b2,b3,b4){var a,b,c,d;var c12,c11,c10;var c23,c22,c21,c20;var result=new Intersection("No Intersection");a=a2.multiply(-2);c12=a1.add(a.add(a3));a=a1.multiply(-2);b=a2.multiply(2);c11=a.add(b);c10=new Point2D(a1.x,a1.y);a=b1.multiply(-1);b=b2.multiply(3);c=b3.multiply(-3);d=a.add(b.add(c.add(b4)));c23=new Vector2D(d.x,d.y);a=b1.multiply(3);b=b2.multiply(-6);c=b3.multiply(3);d=a.add(b.add(c));c22=new Vector2D(d.x,d.y);a=b1.multiply(-3);b=b2.multiply(3);c=a.add(b);c21=new Vector2D(c.x,c.y);c20=new Vector2D(b1.x,b1.y);var c10x2=c10.x*c10.x;var c10y2=c10.y*c10.y;var c11x2=c11.x*c11.x;var c11y2=c11.y*c11.y;var c12x2=c12.x*c12.x;var c12y2=c12.y*c12.y;var c20x2=c20.x*c20.x;var c20y2=c20.y*c20.y;var c21x2=c21.x*c21.x;var c21y2=c21.y*c21.y;var c22x2=c22.x*c22.x;var c22y2=c22.y*c22.y;var c23x2=c23.x*c23.x;var c23y2=c23.y*c23.y;var poly=new Polynomial(-2*c12.x*c12.y*c23.x*c23.y+c12x2*c23y2+c12y2*c23x2,-2*c12.x*c12.y*c22.x*c23.y-2*c12.x*c12.y*c22.y*c23.x+2*c12y2*c22.x*c23.x+2*c12x2*c22.y*c23.y,-2*c12.x*c21.x*c12.y*c23.y-2*c12.x*c12.y*c21.y*c23.x-2*c12.x*c12.y*c22.x*c22.y+2*c21.x*c12y2*c23.x+c12y2*c22x2+c12x2*(2*c21.y*c23.y+c22y2),2*c10.x*c12.x*c12.y*c23.y+2*c10.y*c12.x*c12.y*c23.x+c11.x*c11.y*c12.x*c23.y+c11.x*c11.y*c12.y*c23.x-2*c20.x*c12.x*c12.y*c23.y-2*c12.x*c20.y*c12.y*c23.x-2*c12.x*c21.x*c12.y*c22.y-2*c12.x*c12.y*c21.y*c22.x-2*c10.x*c12y2*c23.x-2*c10.y*c12x2*c23.y+2*c20.x*c12y2*c23.x+2*c21.x*c12y2*c22.x-c11y2*c12.x*c23.x-c11x2*c12.y*c23.y+c12x2*(2*c20.y*c23.y+2*c21.y*c22.y),2*c10.x*c12.x*c12.y*c22.y+2*c10.y*c12.x*c12.y*c22.x+c11.x*c11.y*c12.x*c22.y+c11.x*c11.y*c12.y*c22.x-2*c20.x*c12.x*c12.y*c22.y-2*c12.x*c20.y*c12.y*c22.x-2*c12.x*c21.x*c12.y*c21.y-2*c10.x*c12y2*c22.x-2*c10.y*c12x2*c22.y+2*c20.x*c12y2*c22.x-c11y2*c12.x*c22.x-c11x2*c12.y*c22.y+c21x2*c12y2+c12x2*(2*c20.y*c22.y+c21y2),2*c10.x*c12.x*c12.y*c21.y+2*c10.y*c12.x*c21.x*c12.y+c11.x*c11.y*c12.x*c21.y+c11.x*c11.y*c21.x*c12.y-2*c20.x*c12.x*c12.y*c21.y-2*c12.x*c20.y*c21.x*c12.y-2*c10.x*c21.x*c12y2-2*c10.y*c12x2*c21.y+2*c20.x*c21.x*c12y2-c11y2*c12.x*c21.x-c11x2*c12.y*c21.y+2*c12x2*c20.y*c21.y,-2*c10.x*c10.y*c12.x*c12.y-c10.x*c11.x*c11.y*c12.y-c10.y*c11.x*c11.y*c12.x+2*c10.x*c12.x*c20.y*c12.y+2*c10.y*c20.x*c12.x*c12.y+c11.x*c20.x*c11.y*c12.y+c11.x*c11.y*c12.x*c20.y-2*c20.x*c12.x*c20.y*c12.y-2*c10.x*c20.x*c12y2+c10.x*c11y2*c12.x+c10.y*c11x2*c12.y-2*c10.y*c12x2*c20.y-c20.x*c11y2*c12.x-c11x2*c20.y*c12.y+c10x2*c12y2+c10y2*c12x2+c20x2*c12y2+c12x2*c20y2);var roots=poly.getRootsInInterval(0,1);for(var i=0;i<roots.length;i++){var s=roots[i];var xRoots=new Polynomial(c12.x,c11.x,c10.x-c20.x-s*c21.x-s*s*c22.x-s*s*s*c23.x).getRoots();var yRoots=new Polynomial(c12.y,c11.y,c10.y-c20.y-s*c21.y-s*s*c22.y-s*s*s*c23.y).getRoots();if(xRoots.length>0&&yRoots.length>0){var TOLERANCE=1e-4;checkRoots:for(var j=0;j<xRoots.length;j++){var xRoot=xRoots[j];if(0<=xRoot&&xRoot<=1){for(var k=0;k<yRoots.length;k++){if(Math.abs(xRoot-yRoots[k])<TOLERANCE){result.points.push(c23.multiply(s*s*s).add(c22.multiply(s*s).add(c21.multiply(s).add(c20))));break checkRoots;}}}}}}if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectBezier2Circle=function(p1,p2,p3,c,r){return Intersection.intersectBezier2Ellipse(p1,p2,p3,c,r,r);};
Intersection.intersectBezier2Ellipse=function(p1,p2,p3,ec,rx,ry){var a,b;var c2,c1,c0;var result=new Intersection("No Intersection");a=p2.multiply(-2);c2=p1.add(a.add(p3));a=p1.multiply(-2);b=p2.multiply(2);c1=a.add(b);c0=new Point2D(p1.x,p1.y);var rxrx=rx*rx;var ryry=ry*ry;var roots=new Polynomial(ryry*c2.x*c2.x+rxrx*c2.y*c2.y,2*(ryry*c2.x*c1.x+rxrx*c2.y*c1.y),ryry*(2*c2.x*c0.x+c1.x*c1.x)+rxrx*(2*c2.y*c0.y+c1.y*c1.y)-2*(ryry*ec.x*c2.x+rxrx*ec.y*c2.y),2*(ryry*c1.x*(c0.x-ec.x)+rxrx*c1.y*(c0.y-ec.y)),ryry*(c0.x*c0.x+ec.x*ec.x)+rxrx*(c0.y*c0.y+ec.y*ec.y)-2*(ryry*ec.x*c0.x+rxrx*ec.y*c0.y)-rxrx*ryry).getRoots();for(var i=0;i<roots.length;i++){var t=roots[i];if(0<=t&&t<=1)result.points.push(c2.multiply(t*t).add(c1.multiply(t).add(c0)));}if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectBezier2Line=function(p1,p2,p3,a1,a2){var a,b;var c2,c1,c0;var cl;var n;var min=a1.min(a2);var max=a1.max(a2);var result=new Intersection("No Intersection");a=p2.multiply(-2);c2=p1.add(a.add(p3));a=p1.multiply(-2);b=p2.multiply(2);c1=a.add(b);c0=new Point2D(p1.x,p1.y);n=new Vector2D(a1.y-a2.y,a2.x-a1.x);cl=a1.x*a2.y-a2.x*a1.y;roots=new Polynomial(n.dot(c2),n.dot(c1),n.dot(c0)+cl).getRoots();for(var i=0;i<roots.length;i++){var t=roots[i];if(0<=t&&t<=1){var p4=p1.lerp(p2,t);var p5=p2.lerp(p3,t);var p6=p4.lerp(p5,t);if(a1.x==a2.x){if(min.y<=p6.y&&p6.y<=max.y){result.status="Intersection";result.appendPoint(p6);}}else if(a1.y==a2.y){if(min.x<=p6.x&&p6.x<=max.x){result.status="Intersection";result.appendPoint(p6);}}else if(p6.gte(min)&&p6.lte(max)){result.status="Intersection";result.appendPoint(p6);}}}return result;};
Intersection.intersectBezier2Polygon=function(p1,p2,p3,points){var result=new Intersection("No Intersection");var length=points.length;for(var i=0;i<length;i++){var a1=points[i];var a2=points[(i+1)%length];var inter=Intersection.intersectBezier2Line(p1,p2,p3,a1,a2);result.appendPoints(inter.points);}if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectBezier2Rectangle=function(p1,p2,p3,r1,r2){var min=r1.min(r2);var max=r1.max(r2);var topRight=new Point2D(max.x,min.y);var bottomLeft=new Point2D(min.x,max.y);var inter1=Intersection.intersectBezier2Line(p1,p2,p3,min,topRight);var inter2=Intersection.intersectBezier2Line(p1,p2,p3,topRight,max);var inter3=Intersection.intersectBezier2Line(p1,p2,p3,max,bottomLeft);var inter4=Intersection.intersectBezier2Line(p1,p2,p3,bottomLeft,min);var result=new Intersection("No Intersection");result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectBezier3Bezier3=function(a1,a2,a3,a4,b1,b2,b3,b4){var a,b,c,d;var c13,c12,c11,c10;var c23,c22,c21,c20;var result=new Intersection("No Intersection");a=a1.multiply(-1);b=a2.multiply(3);c=a3.multiply(-3);d=a.add(b.add(c.add(a4)));c13=new Vector2D(d.x,d.y);a=a1.multiply(3);b=a2.multiply(-6);c=a3.multiply(3);d=a.add(b.add(c));c12=new Vector2D(d.x,d.y);a=a1.multiply(-3);b=a2.multiply(3);c=a.add(b);c11=new Vector2D(c.x,c.y);c10=new Vector2D(a1.x,a1.y);a=b1.multiply(-1);b=b2.multiply(3);c=b3.multiply(-3);d=a.add(b.add(c.add(b4)));c23=new Vector2D(d.x,d.y);a=b1.multiply(3);b=b2.multiply(-6);c=b3.multiply(3);d=a.add(b.add(c));c22=new Vector2D(d.x,d.y);a=b1.multiply(-3);b=b2.multiply(3);c=a.add(b);c21=new Vector2D(c.x,c.y);c20=new Vector2D(b1.x,b1.y);var c10x2=c10.x*c10.x;var c10x3=c10.x*c10.x*c10.x;var c10y2=c10.y*c10.y;var c10y3=c10.y*c10.y*c10.y;var c11x2=c11.x*c11.x;var c11x3=c11.x*c11.x*c11.x;var c11y2=c11.y*c11.y;var c11y3=c11.y*c11.y*c11.y;var c12x2=c12.x*c12.x;var c12x3=c12.x*c12.x*c12.x;var c12y2=c12.y*c12.y;var c12y3=c12.y*c12.y*c12.y;var c13x2=c13.x*c13.x;var c13x3=c13.x*c13.x*c13.x;var c13y2=c13.y*c13.y;var c13y3=c13.y*c13.y*c13.y;var c20x2=c20.x*c20.x;var c20x3=c20.x*c20.x*c20.x;var c20y2=c20.y*c20.y;var c20y3=c20.y*c20.y*c20.y;var c21x2=c21.x*c21.x;var c21x3=c21.x*c21.x*c21.x;var c21y2=c21.y*c21.y;var c22x2=c22.x*c22.x;var c22x3=c22.x*c22.x*c22.x;var c22y2=c22.y*c22.y;var c23x2=c23.x*c23.x;var c23x3=c23.x*c23.x*c23.x;var c23y2=c23.y*c23.y;var c23y3=c23.y*c23.y*c23.y;var poly=new Polynomial(-c13x3*c23y3+c13y3*c23x3-3*c13.x*c13y2*c23x2*c23.y+3*c13x2*c13.y*c23.x*c23y2,-6*c13.x*c22.x*c13y2*c23.x*c23.y+6*c13x2*c13.y*c22.y*c23.x*c23.y+3*c22.x*c13y3*c23x2-3*c13x3*c22.y*c23y2-3*c13.x*c13y2*c22.y*c23x2+3*c13x2*c22.x*c13.y*c23y2,-6*c21.x*c13.x*c13y2*c23.x*c23.y-6*c13.x*c22.x*c13y2*c22.y*c23.x+6*c13x2*c22.x*c13.y*c22.y*c23.y+3*c21.x*c13y3*c23x2+3*c22x2*c13y3*c23.x+3*c21.x*c13x2*c13.y*c23y2-3*c13.x*c21.y*c13y2*c23x2-3*c13.x*c22x2*c13y2*c23.y+c13x2*c13.y*c23.x*(6*c21.y*c23.y+3*c22y2)+c13x3*(-c21.y*c23y2-2*c22y2*c23.y-c23.y*(2*c21.y*c23.y+c22y2)),c11.x*c12.y*c13.x*c13.y*c23.x*c23.y-c11.y*c12.x*c13.x*c13.y*c23.x*c23.y+6*c21.x*c22.x*c13y3*c23.x+3*c11.x*c12.x*c13.x*c13.y*c23y2+6*c10.x*c13.x*c13y2*c23.x*c23.y-3*c11.x*c12.x*c13y2*c23.x*c23.y-3*c11.y*c12.y*c13.x*c13.y*c23x2-6*c10.y*c13x2*c13.y*c23.x*c23.y-6*c20.x*c13.x*c13y2*c23.x*c23.y+3*c11.y*c12.y*c13x2*c23.x*c23.y-2*c12.x*c12y2*c13.x*c23.x*c23.y-6*c21.x*c13.x*c22.x*c13y2*c23.y-6*c21.x*c13.x*c13y2*c22.y*c23.x-6*c13.x*c21.y*c22.x*c13y2*c23.x+6*c21.x*c13x2*c13.y*c22.y*c23.y+2*c12x2*c12.y*c13.y*c23.x*c23.y+c22x3*c13y3-3*c10.x*c13y3*c23x2+3*c10.y*c13x3*c23y2+3*c20.x*c13y3*c23x2+c12y3*c13.x*c23x2-c12x3*c13.y*c23y2-3*c10.x*c13x2*c13.y*c23y2+3*c10.y*c13.x*c13y2*c23x2-2*c11.x*c12.y*c13x2*c23y2+c11.x*c12.y*c13y2*c23x2-c11.y*c12.x*c13x2*c23y2+2*c11.y*c12.x*c13y2*c23x2+3*c20.x*c13x2*c13.y*c23y2-c12.x*c12y2*c13.y*c23x2-3*c20.y*c13.x*c13y2*c23x2+c12x2*c12.y*c13.x*c23y2-3*c13.x*c22x2*c13y2*c22.y+c13x2*c13.y*c23.x*(6*c20.y*c23.y+6*c21.y*c22.y)+c13x2*c22.x*c13.y*(6*c21.y*c23.y+3*c22y2)+c13x3*(-2*c21.y*c22.y*c23.y-c20.y*c23y2-c22.y*(2*c21.y*c23.y+c22y2)-c23.y*(2*c20.y*c23.y+2*c21.y*c22.y)),6*c11.x*c12.x*c13.x*c13.y*c22.y*c23.y+c11.x*c12.y*c13.x*c22.x*c13.y*c23.y+c11.x*c12.y*c13.x*c13.y*c22.y*c23.x-c11.y*c12.x*c13.x*c22.x*c13.y*c23.y-c11.y*c12.x*c13.x*c13.y*c22.y*c23.x-6*c11.y*c12.y*c13.x*c22.x*c13.y*c23.x-6*c10.x*c22.x*c13y3*c23.x+6*c20.x*c22.x*c13y3*c23.x+6*c10.y*c13x3*c22.y*c23.y+2*c12y3*c13.x*c22.x*c23.x-2*c12x3*c13.y*c22.y*c23.y+6*c10.x*c13.x*c22.x*c13y2*c23.y+6*c10.x*c13.x*c13y2*c22.y*c23.x+6*c10.y*c13.x*c22.x*c13y2*c23.x-3*c11.x*c12.x*c22.x*c13y2*c23.y-3*c11.x*c12.x*c13y2*c22.y*c23.x+2*c11.x*c12.y*c22.x*c13y2*c23.x+4*c11.y*c12.x*c22.x*c13y2*c23.x-6*c10.x*c13x2*c13.y*c22.y*c23.y-6*c10.y*c13x2*c22.x*c13.y*c23.y-6*c10.y*c13x2*c13.y*c22.y*c23.x-4*c11.x*c12.y*c13x2*c22.y*c23.y-6*c20.x*c13.x*c22.x*c13y2*c23.y-6*c20.x*c13.x*c13y2*c22.y*c23.x-2*c11.y*c12.x*c13x2*c22.y*c23.y+3*c11.y*c12.y*c13x2*c22.x*c23.y+3*c11.y*c12.y*c13x2*c22.y*c23.x-2*c12.x*c12y2*c13.x*c22.x*c23.y-2*c12.x*c12y2*c13.x*c22.y*c23.x-2*c12.x*c12y2*c22.x*c13.y*c23.x-6*c20.y*c13.x*c22.x*c13y2*c23.x-6*c21.x*c13.x*c21.y*c13y2*c23.x-6*c21.x*c13.x*c22.x*c13y2*c22.y+6*c20.x*c13x2*c13.y*c22.y*c23.y+2*c12x2*c12.y*c13.x*c22.y*c23.y+2*c12x2*c12.y*c22.x*c13.y*c23.y+2*c12x2*c12.y*c13.y*c22.y*c23.x+3*c21.x*c22x2*c13y3+3*c21x2*c13y3*c23.x-3*c13.x*c21.y*c22x2*c13y2-3*c21x2*c13.x*c13y2*c23.y+c13x2*c22.x*c13.y*(6*c20.y*c23.y+6*c21.y*c22.y)+c13x2*c13.y*c23.x*(6*c20.y*c22.y+3*c21y2)+c21.x*c13x2*c13.y*(6*c21.y*c23.y+3*c22y2)+c13x3*(-2*c20.y*c22.y*c23.y-c23.y*(2*c20.y*c22.y+c21y2)-c21.y*(2*c21.y*c23.y+c22y2)-c22.y*(2*c20.y*c23.y+2*c21.y*c22.y)),c11.x*c21.x*c12.y*c13.x*c13.y*c23.y+c11.x*c12.y*c13.x*c21.y*c13.y*c23.x+c11.x*c12.y*c13.x*c22.x*c13.y*c22.y-c11.y*c12.x*c21.x*c13.x*c13.y*c23.y-c11.y*c12.x*c13.x*c21.y*c13.y*c23.x-c11.y*c12.x*c13.x*c22.x*c13.y*c22.y-6*c11.y*c21.x*c12.y*c13.x*c13.y*c23.x-6*c10.x*c21.x*c13y3*c23.x+6*c20.x*c21.x*c13y3*c23.x+2*c21.x*c12y3*c13.x*c23.x+6*c10.x*c21.x*c13.x*c13y2*c23.y+6*c10.x*c13.x*c21.y*c13y2*c23.x+6*c10.x*c13.x*c22.x*c13y2*c22.y+6*c10.y*c21.x*c13.x*c13y2*c23.x-3*c11.x*c12.x*c21.x*c13y2*c23.y-3*c11.x*c12.x*c21.y*c13y2*c23.x-3*c11.x*c12.x*c22.x*c13y2*c22.y+2*c11.x*c21.x*c12.y*c13y2*c23.x+4*c11.y*c12.x*c21.x*c13y2*c23.x-6*c10.y*c21.x*c13x2*c13.y*c23.y-6*c10.y*c13x2*c21.y*c13.y*c23.x-6*c10.y*c13x2*c22.x*c13.y*c22.y-6*c20.x*c21.x*c13.x*c13y2*c23.y-6*c20.x*c13.x*c21.y*c13y2*c23.x-6*c20.x*c13.x*c22.x*c13y2*c22.y+3*c11.y*c21.x*c12.y*c13x2*c23.y-3*c11.y*c12.y*c13.x*c22x2*c13.y+3*c11.y*c12.y*c13x2*c21.y*c23.x+3*c11.y*c12.y*c13x2*c22.x*c22.y-2*c12.x*c21.x*c12y2*c13.x*c23.y-2*c12.x*c21.x*c12y2*c13.y*c23.x-2*c12.x*c12y2*c13.x*c21.y*c23.x-2*c12.x*c12y2*c13.x*c22.x*c22.y-6*c20.y*c21.x*c13.x*c13y2*c23.x-6*c21.x*c13.x*c21.y*c22.x*c13y2+6*c20.y*c13x2*c21.y*c13.y*c23.x+2*c12x2*c21.x*c12.y*c13.y*c23.y+2*c12x2*c12.y*c21.y*c13.y*c23.x+2*c12x2*c12.y*c22.x*c13.y*c22.y-3*c10.x*c22x2*c13y3+3*c20.x*c22x2*c13y3+3*c21x2*c22.x*c13y3+c12y3*c13.x*c22x2+3*c10.y*c13.x*c22x2*c13y2+c11.x*c12.y*c22x2*c13y2+2*c11.y*c12.x*c22x2*c13y2-c12.x*c12y2*c22x2*c13.y-3*c20.y*c13.x*c22x2*c13y2-3*c21x2*c13.x*c13y2*c22.y+c12x2*c12.y*c13.x*(2*c21.y*c23.y+c22y2)+c11.x*c12.x*c13.x*c13.y*(6*c21.y*c23.y+3*c22y2)+c21.x*c13x2*c13.y*(6*c20.y*c23.y+6*c21.y*c22.y)+c12x3*c13.y*(-2*c21.y*c23.y-c22y2)+c10.y*c13x3*(6*c21.y*c23.y+3*c22y2)+c11.y*c12.x*c13x2*(-2*c21.y*c23.y-c22y2)+c11.x*c12.y*c13x2*(-4*c21.y*c23.y-2*c22y2)+c10.x*c13x2*c13.y*(-6*c21.y*c23.y-3*c22y2)+c13x2*c22.x*c13.y*(6*c20.y*c22.y+3*c21y2)+c20.x*c13x2*c13.y*(6*c21.y*c23.y+3*c22y2)+c13x3*(-2*c20.y*c21.y*c23.y-c22.y*(2*c20.y*c22.y+c21y2)-c20.y*(2*c21.y*c23.y+c22y2)-c21.y*(2*c20.y*c23.y+2*c21.y*c22.y)),-c10.x*c11.x*c12.y*c13.x*c13.y*c23.y+c10.x*c11.y*c12.x*c13.x*c13.y*c23.y+6*c10.x*c11.y*c12.y*c13.x*c13.y*c23.x-6*c10.y*c11.x*c12.x*c13.x*c13.y*c23.y-c10.y*c11.x*c12.y*c13.x*c13.y*c23.x+c10.y*c11.y*c12.x*c13.x*c13.y*c23.x+c11.x*c11.y*c12.x*c12.y*c13.x*c23.y-c11.x*c11.y*c12.x*c12.y*c13.y*c23.x+c11.x*c20.x*c12.y*c13.x*c13.y*c23.y+c11.x*c20.y*c12.y*c13.x*c13.y*c23.x+c11.x*c21.x*c12.y*c13.x*c13.y*c22.y+c11.x*c12.y*c13.x*c21.y*c22.x*c13.y-c20.x*c11.y*c12.x*c13.x*c13.y*c23.y-6*c20.x*c11.y*c12.y*c13.x*c13.y*c23.x-c11.y*c12.x*c20.y*c13.x*c13.y*c23.x-c11.y*c12.x*c21.x*c13.x*c13.y*c22.y-c11.y*c12.x*c13.x*c21.y*c22.x*c13.y-6*c11.y*c21.x*c12.y*c13.x*c22.x*c13.y-6*c10.x*c20.x*c13y3*c23.x-6*c10.x*c21.x*c22.x*c13y3-2*c10.x*c12y3*c13.x*c23.x+6*c20.x*c21.x*c22.x*c13y3+2*c20.x*c12y3*c13.x*c23.x+2*c21.x*c12y3*c13.x*c22.x+2*c10.y*c12x3*c13.y*c23.y-6*c10.x*c10.y*c13.x*c13y2*c23.x+3*c10.x*c11.x*c12.x*c13y2*c23.y-2*c10.x*c11.x*c12.y*c13y2*c23.x-4*c10.x*c11.y*c12.x*c13y2*c23.x+3*c10.y*c11.x*c12.x*c13y2*c23.x+6*c10.x*c10.y*c13x2*c13.y*c23.y+6*c10.x*c20.x*c13.x*c13y2*c23.y-3*c10.x*c11.y*c12.y*c13x2*c23.y+2*c10.x*c12.x*c12y2*c13.x*c23.y+2*c10.x*c12.x*c12y2*c13.y*c23.x+6*c10.x*c20.y*c13.x*c13y2*c23.x+6*c10.x*c21.x*c13.x*c13y2*c22.y+6*c10.x*c13.x*c21.y*c22.x*c13y2+4*c10.y*c11.x*c12.y*c13x2*c23.y+6*c10.y*c20.x*c13.x*c13y2*c23.x+2*c10.y*c11.y*c12.x*c13x2*c23.y-3*c10.y*c11.y*c12.y*c13x2*c23.x+2*c10.y*c12.x*c12y2*c13.x*c23.x+6*c10.y*c21.x*c13.x*c22.x*c13y2-3*c11.x*c20.x*c12.x*c13y2*c23.y+2*c11.x*c20.x*c12.y*c13y2*c23.x+c11.x*c11.y*c12y2*c13.x*c23.x-3*c11.x*c12.x*c20.y*c13y2*c23.x-3*c11.x*c12.x*c21.x*c13y2*c22.y-3*c11.x*c12.x*c21.y*c22.x*c13y2+2*c11.x*c21.x*c12.y*c22.x*c13y2+4*c20.x*c11.y*c12.x*c13y2*c23.x+4*c11.y*c12.x*c21.x*c22.x*c13y2-2*c10.x*c12x2*c12.y*c13.y*c23.y-6*c10.y*c20.x*c13x2*c13.y*c23.y-6*c10.y*c20.y*c13x2*c13.y*c23.x-6*c10.y*c21.x*c13x2*c13.y*c22.y-2*c10.y*c12x2*c12.y*c13.x*c23.y-2*c10.y*c12x2*c12.y*c13.y*c23.x-6*c10.y*c13x2*c21.y*c22.x*c13.y-c11.x*c11.y*c12x2*c13.y*c23.y-2*c11.x*c11y2*c13.x*c13.y*c23.x+3*c20.x*c11.y*c12.y*c13x2*c23.y-2*c20.x*c12.x*c12y2*c13.x*c23.y-2*c20.x*c12.x*c12y2*c13.y*c23.x-6*c20.x*c20.y*c13.x*c13y2*c23.x-6*c20.x*c21.x*c13.x*c13y2*c22.y-6*c20.x*c13.x*c21.y*c22.x*c13y2+3*c11.y*c20.y*c12.y*c13x2*c23.x+3*c11.y*c21.x*c12.y*c13x2*c22.y+3*c11.y*c12.y*c13x2*c21.y*c22.x-2*c12.x*c20.y*c12y2*c13.x*c23.x-2*c12.x*c21.x*c12y2*c13.x*c22.y-2*c12.x*c21.x*c12y2*c22.x*c13.y-2*c12.x*c12y2*c13.x*c21.y*c22.x-6*c20.y*c21.x*c13.x*c22.x*c13y2-c11y2*c12.x*c12.y*c13.x*c23.x+2*c20.x*c12x2*c12.y*c13.y*c23.y+6*c20.y*c13x2*c21.y*c22.x*c13.y+2*c11x2*c11.y*c13.x*c13.y*c23.y+c11x2*c12.x*c12.y*c13.y*c23.y+2*c12x2*c20.y*c12.y*c13.y*c23.x+2*c12x2*c21.x*c12.y*c13.y*c22.y+2*c12x2*c12.y*c21.y*c22.x*c13.y+c21x3*c13y3+3*c10x2*c13y3*c23.x-3*c10y2*c13x3*c23.y+3*c20x2*c13y3*c23.x+c11y3*c13x2*c23.x-c11x3*c13y2*c23.y-c11.x*c11y2*c13x2*c23.y+c11x2*c11.y*c13y2*c23.x-3*c10x2*c13.x*c13y2*c23.y+3*c10y2*c13x2*c13.y*c23.x-c11x2*c12y2*c13.x*c23.y+c11y2*c12x2*c13.y*c23.x-3*c21x2*c13.x*c21.y*c13y2-3*c20x2*c13.x*c13y2*c23.y+3*c20y2*c13x2*c13.y*c23.x+c11.x*c12.x*c13.x*c13.y*(6*c20.y*c23.y+6*c21.y*c22.y)+c12x3*c13.y*(-2*c20.y*c23.y-2*c21.y*c22.y)+c10.y*c13x3*(6*c20.y*c23.y+6*c21.y*c22.y)+c11.y*c12.x*c13x2*(-2*c20.y*c23.y-2*c21.y*c22.y)+c12x2*c12.y*c13.x*(2*c20.y*c23.y+2*c21.y*c22.y)+c11.x*c12.y*c13x2*(-4*c20.y*c23.y-4*c21.y*c22.y)+c10.x*c13x2*c13.y*(-6*c20.y*c23.y-6*c21.y*c22.y)+c20.x*c13x2*c13.y*(6*c20.y*c23.y+6*c21.y*c22.y)+c21.x*c13x2*c13.y*(6*c20.y*c22.y+3*c21y2)+c13x3*(-2*c20.y*c21.y*c22.y-c20y2*c23.y-c21.y*(2*c20.y*c22.y+c21y2)-c20.y*(2*c20.y*c23.y+2*c21.y*c22.y)),-c10.x*c11.x*c12.y*c13.x*c13.y*c22.y+c10.x*c11.y*c12.x*c13.x*c13.y*c22.y+6*c10.x*c11.y*c12.y*c13.x*c22.x*c13.y-6*c10.y*c11.x*c12.x*c13.x*c13.y*c22.y-c10.y*c11.x*c12.y*c13.x*c22.x*c13.y+c10.y*c11.y*c12.x*c13.x*c22.x*c13.y+c11.x*c11.y*c12.x*c12.y*c13.x*c22.y-c11.x*c11.y*c12.x*c12.y*c22.x*c13.y+c11.x*c20.x*c12.y*c13.x*c13.y*c22.y+c11.x*c20.y*c12.y*c13.x*c22.x*c13.y+c11.x*c21.x*c12.y*c13.x*c21.y*c13.y-c20.x*c11.y*c12.x*c13.x*c13.y*c22.y-6*c20.x*c11.y*c12.y*c13.x*c22.x*c13.y-c11.y*c12.x*c20.y*c13.x*c22.x*c13.y-c11.y*c12.x*c21.x*c13.x*c21.y*c13.y-6*c10.x*c20.x*c22.x*c13y3-2*c10.x*c12y3*c13.x*c22.x+2*c20.x*c12y3*c13.x*c22.x+2*c10.y*c12x3*c13.y*c22.y-6*c10.x*c10.y*c13.x*c22.x*c13y2+3*c10.x*c11.x*c12.x*c13y2*c22.y-2*c10.x*c11.x*c12.y*c22.x*c13y2-4*c10.x*c11.y*c12.x*c22.x*c13y2+3*c10.y*c11.x*c12.x*c22.x*c13y2+6*c10.x*c10.y*c13x2*c13.y*c22.y+6*c10.x*c20.x*c13.x*c13y2*c22.y-3*c10.x*c11.y*c12.y*c13x2*c22.y+2*c10.x*c12.x*c12y2*c13.x*c22.y+2*c10.x*c12.x*c12y2*c22.x*c13.y+6*c10.x*c20.y*c13.x*c22.x*c13y2+6*c10.x*c21.x*c13.x*c21.y*c13y2+4*c10.y*c11.x*c12.y*c13x2*c22.y+6*c10.y*c20.x*c13.x*c22.x*c13y2+2*c10.y*c11.y*c12.x*c13x2*c22.y-3*c10.y*c11.y*c12.y*c13x2*c22.x+2*c10.y*c12.x*c12y2*c13.x*c22.x-3*c11.x*c20.x*c12.x*c13y2*c22.y+2*c11.x*c20.x*c12.y*c22.x*c13y2+c11.x*c11.y*c12y2*c13.x*c22.x-3*c11.x*c12.x*c20.y*c22.x*c13y2-3*c11.x*c12.x*c21.x*c21.y*c13y2+4*c20.x*c11.y*c12.x*c22.x*c13y2-2*c10.x*c12x2*c12.y*c13.y*c22.y-6*c10.y*c20.x*c13x2*c13.y*c22.y-6*c10.y*c20.y*c13x2*c22.x*c13.y-6*c10.y*c21.x*c13x2*c21.y*c13.y-2*c10.y*c12x2*c12.y*c13.x*c22.y-2*c10.y*c12x2*c12.y*c22.x*c13.y-c11.x*c11.y*c12x2*c13.y*c22.y-2*c11.x*c11y2*c13.x*c22.x*c13.y+3*c20.x*c11.y*c12.y*c13x2*c22.y-2*c20.x*c12.x*c12y2*c13.x*c22.y-2*c20.x*c12.x*c12y2*c22.x*c13.y-6*c20.x*c20.y*c13.x*c22.x*c13y2-6*c20.x*c21.x*c13.x*c21.y*c13y2+3*c11.y*c20.y*c12.y*c13x2*c22.x+3*c11.y*c21.x*c12.y*c13x2*c21.y-2*c12.x*c20.y*c12y2*c13.x*c22.x-2*c12.x*c21.x*c12y2*c13.x*c21.y-c11y2*c12.x*c12.y*c13.x*c22.x+2*c20.x*c12x2*c12.y*c13.y*c22.y-3*c11.y*c21x2*c12.y*c13.x*c13.y+6*c20.y*c21.x*c13x2*c21.y*c13.y+2*c11x2*c11.y*c13.x*c13.y*c22.y+c11x2*c12.x*c12.y*c13.y*c22.y+2*c12x2*c20.y*c12.y*c22.x*c13.y+2*c12x2*c21.x*c12.y*c21.y*c13.y-3*c10.x*c21x2*c13y3+3*c20.x*c21x2*c13y3+3*c10x2*c22.x*c13y3-3*c10y2*c13x3*c22.y+3*c20x2*c22.x*c13y3+c21x2*c12y3*c13.x+c11y3*c13x2*c22.x-c11x3*c13y2*c22.y+3*c10.y*c21x2*c13.x*c13y2-c11.x*c11y2*c13x2*c22.y+c11.x*c21x2*c12.y*c13y2+2*c11.y*c12.x*c21x2*c13y2+c11x2*c11.y*c22.x*c13y2-c12.x*c21x2*c12y2*c13.y-3*c20.y*c21x2*c13.x*c13y2-3*c10x2*c13.x*c13y2*c22.y+3*c10y2*c13x2*c22.x*c13.y-c11x2*c12y2*c13.x*c22.y+c11y2*c12x2*c22.x*c13.y-3*c20x2*c13.x*c13y2*c22.y+3*c20y2*c13x2*c22.x*c13.y+c12x2*c12.y*c13.x*(2*c20.y*c22.y+c21y2)+c11.x*c12.x*c13.x*c13.y*(6*c20.y*c22.y+3*c21y2)+c12x3*c13.y*(-2*c20.y*c22.y-c21y2)+c10.y*c13x3*(6*c20.y*c22.y+3*c21y2)+c11.y*c12.x*c13x2*(-2*c20.y*c22.y-c21y2)+c11.x*c12.y*c13x2*(-4*c20.y*c22.y-2*c21y2)+c10.x*c13x2*c13.y*(-6*c20.y*c22.y-3*c21y2)+c20.x*c13x2*c13.y*(6*c20.y*c22.y+3*c21y2)+c13x3*(-2*c20.y*c21y2-c20y2*c22.y-c20.y*(2*c20.y*c22.y+c21y2)),-c10.x*c11.x*c12.y*c13.x*c21.y*c13.y+c10.x*c11.y*c12.x*c13.x*c21.y*c13.y+6*c10.x*c11.y*c21.x*c12.y*c13.x*c13.y-6*c10.y*c11.x*c12.x*c13.x*c21.y*c13.y-c10.y*c11.x*c21.x*c12.y*c13.x*c13.y+c10.y*c11.y*c12.x*c21.x*c13.x*c13.y-c11.x*c11.y*c12.x*c21.x*c12.y*c13.y+c11.x*c11.y*c12.x*c12.y*c13.x*c21.y+c11.x*c20.x*c12.y*c13.x*c21.y*c13.y+6*c11.x*c12.x*c20.y*c13.x*c21.y*c13.y+c11.x*c20.y*c21.x*c12.y*c13.x*c13.y-c20.x*c11.y*c12.x*c13.x*c21.y*c13.y-6*c20.x*c11.y*c21.x*c12.y*c13.x*c13.y-c11.y*c12.x*c20.y*c21.x*c13.x*c13.y-6*c10.x*c20.x*c21.x*c13y3-2*c10.x*c21.x*c12y3*c13.x+6*c10.y*c20.y*c13x3*c21.y+2*c20.x*c21.x*c12y3*c13.x+2*c10.y*c12x3*c21.y*c13.y-2*c12x3*c20.y*c21.y*c13.y-6*c10.x*c10.y*c21.x*c13.x*c13y2+3*c10.x*c11.x*c12.x*c21.y*c13y2-2*c10.x*c11.x*c21.x*c12.y*c13y2-4*c10.x*c11.y*c12.x*c21.x*c13y2+3*c10.y*c11.x*c12.x*c21.x*c13y2+6*c10.x*c10.y*c13x2*c21.y*c13.y+6*c10.x*c20.x*c13.x*c21.y*c13y2-3*c10.x*c11.y*c12.y*c13x2*c21.y+2*c10.x*c12.x*c21.x*c12y2*c13.y+2*c10.x*c12.x*c12y2*c13.x*c21.y+6*c10.x*c20.y*c21.x*c13.x*c13y2+4*c10.y*c11.x*c12.y*c13x2*c21.y+6*c10.y*c20.x*c21.x*c13.x*c13y2+2*c10.y*c11.y*c12.x*c13x2*c21.y-3*c10.y*c11.y*c21.x*c12.y*c13x2+2*c10.y*c12.x*c21.x*c12y2*c13.x-3*c11.x*c20.x*c12.x*c21.y*c13y2+2*c11.x*c20.x*c21.x*c12.y*c13y2+c11.x*c11.y*c21.x*c12y2*c13.x-3*c11.x*c12.x*c20.y*c21.x*c13y2+4*c20.x*c11.y*c12.x*c21.x*c13y2-6*c10.x*c20.y*c13x2*c21.y*c13.y-2*c10.x*c12x2*c12.y*c21.y*c13.y-6*c10.y*c20.x*c13x2*c21.y*c13.y-6*c10.y*c20.y*c21.x*c13x2*c13.y-2*c10.y*c12x2*c21.x*c12.y*c13.y-2*c10.y*c12x2*c12.y*c13.x*c21.y-c11.x*c11.y*c12x2*c21.y*c13.y-4*c11.x*c20.y*c12.y*c13x2*c21.y-2*c11.x*c11y2*c21.x*c13.x*c13.y+3*c20.x*c11.y*c12.y*c13x2*c21.y-2*c20.x*c12.x*c21.x*c12y2*c13.y-2*c20.x*c12.x*c12y2*c13.x*c21.y-6*c20.x*c20.y*c21.x*c13.x*c13y2-2*c11.y*c12.x*c20.y*c13x2*c21.y+3*c11.y*c20.y*c21.x*c12.y*c13x2-2*c12.x*c20.y*c21.x*c12y2*c13.x-c11y2*c12.x*c21.x*c12.y*c13.x+6*c20.x*c20.y*c13x2*c21.y*c13.y+2*c20.x*c12x2*c12.y*c21.y*c13.y+2*c11x2*c11.y*c13.x*c21.y*c13.y+c11x2*c12.x*c12.y*c21.y*c13.y+2*c12x2*c20.y*c21.x*c12.y*c13.y+2*c12x2*c20.y*c12.y*c13.x*c21.y+3*c10x2*c21.x*c13y3-3*c10y2*c13x3*c21.y+3*c20x2*c21.x*c13y3+c11y3*c21.x*c13x2-c11x3*c21.y*c13y2-3*c20y2*c13x3*c21.y-c11.x*c11y2*c13x2*c21.y+c11x2*c11.y*c21.x*c13y2-3*c10x2*c13.x*c21.y*c13y2+3*c10y2*c21.x*c13x2*c13.y-c11x2*c12y2*c13.x*c21.y+c11y2*c12x2*c21.x*c13.y-3*c20x2*c13.x*c21.y*c13y2+3*c20y2*c21.x*c13x2*c13.y,c10.x*c10.y*c11.x*c12.y*c13.x*c13.y-c10.x*c10.y*c11.y*c12.x*c13.x*c13.y+c10.x*c11.x*c11.y*c12.x*c12.y*c13.y-c10.y*c11.x*c11.y*c12.x*c12.y*c13.x-c10.x*c11.x*c20.y*c12.y*c13.x*c13.y+6*c10.x*c20.x*c11.y*c12.y*c13.x*c13.y+c10.x*c11.y*c12.x*c20.y*c13.x*c13.y-c10.y*c11.x*c20.x*c12.y*c13.x*c13.y-6*c10.y*c11.x*c12.x*c20.y*c13.x*c13.y+c10.y*c20.x*c11.y*c12.x*c13.x*c13.y-c11.x*c20.x*c11.y*c12.x*c12.y*c13.y+c11.x*c11.y*c12.x*c20.y*c12.y*c13.x+c11.x*c20.x*c20.y*c12.y*c13.x*c13.y-c20.x*c11.y*c12.x*c20.y*c13.x*c13.y-2*c10.x*c20.x*c12y3*c13.x+2*c10.y*c12x3*c20.y*c13.y-3*c10.x*c10.y*c11.x*c12.x*c13y2-6*c10.x*c10.y*c20.x*c13.x*c13y2+3*c10.x*c10.y*c11.y*c12.y*c13x2-2*c10.x*c10.y*c12.x*c12y2*c13.x-2*c10.x*c11.x*c20.x*c12.y*c13y2-c10.x*c11.x*c11.y*c12y2*c13.x+3*c10.x*c11.x*c12.x*c20.y*c13y2-4*c10.x*c20.x*c11.y*c12.x*c13y2+3*c10.y*c11.x*c20.x*c12.x*c13y2+6*c10.x*c10.y*c20.y*c13x2*c13.y+2*c10.x*c10.y*c12x2*c12.y*c13.y+2*c10.x*c11.x*c11y2*c13.x*c13.y+2*c10.x*c20.x*c12.x*c12y2*c13.y+6*c10.x*c20.x*c20.y*c13.x*c13y2-3*c10.x*c11.y*c20.y*c12.y*c13x2+2*c10.x*c12.x*c20.y*c12y2*c13.x+c10.x*c11y2*c12.x*c12.y*c13.x+c10.y*c11.x*c11.y*c12x2*c13.y+4*c10.y*c11.x*c20.y*c12.y*c13x2-3*c10.y*c20.x*c11.y*c12.y*c13x2+2*c10.y*c20.x*c12.x*c12y2*c13.x+2*c10.y*c11.y*c12.x*c20.y*c13x2+c11.x*c20.x*c11.y*c12y2*c13.x-3*c11.x*c20.x*c12.x*c20.y*c13y2-2*c10.x*c12x2*c20.y*c12.y*c13.y-6*c10.y*c20.x*c20.y*c13x2*c13.y-2*c10.y*c20.x*c12x2*c12.y*c13.y-2*c10.y*c11x2*c11.y*c13.x*c13.y-c10.y*c11x2*c12.x*c12.y*c13.y-2*c10.y*c12x2*c20.y*c12.y*c13.x-2*c11.x*c20.x*c11y2*c13.x*c13.y-c11.x*c11.y*c12x2*c20.y*c13.y+3*c20.x*c11.y*c20.y*c12.y*c13x2-2*c20.x*c12.x*c20.y*c12y2*c13.x-c20.x*c11y2*c12.x*c12.y*c13.x+3*c10y2*c11.x*c12.x*c13.x*c13.y+3*c11.x*c12.x*c20y2*c13.x*c13.y+2*c20.x*c12x2*c20.y*c12.y*c13.y-3*c10x2*c11.y*c12.y*c13.x*c13.y+2*c11x2*c11.y*c20.y*c13.x*c13.y+c11x2*c12.x*c20.y*c12.y*c13.y-3*c20x2*c11.y*c12.y*c13.x*c13.y-c10x3*c13y3+c10y3*c13x3+c20x3*c13y3-c20y3*c13x3-3*c10.x*c20x2*c13y3-c10.x*c11y3*c13x2+3*c10x2*c20.x*c13y3+c10.y*c11x3*c13y2+3*c10.y*c20y2*c13x3+c20.x*c11y3*c13x2+c10x2*c12y3*c13.x-3*c10y2*c20.y*c13x3-c10y2*c12x3*c13.y+c20x2*c12y3*c13.x-c11x3*c20.y*c13y2-c12x3*c20y2*c13.y-c10.x*c11x2*c11.y*c13y2+c10.y*c11.x*c11y2*c13x2-3*c10.x*c10y2*c13x2*c13.y-c10.x*c11y2*c12x2*c13.y+c10.y*c11x2*c12y2*c13.x-c11.x*c11y2*c20.y*c13x2+3*c10x2*c10.y*c13.x*c13y2+c10x2*c11.x*c12.y*c13y2+2*c10x2*c11.y*c12.x*c13y2-2*c10y2*c11.x*c12.y*c13x2-c10y2*c11.y*c12.x*c13x2+c11x2*c20.x*c11.y*c13y2-3*c10.x*c20y2*c13x2*c13.y+3*c10.y*c20x2*c13.x*c13y2+c11.x*c20x2*c12.y*c13y2-2*c11.x*c20y2*c12.y*c13x2+c20.x*c11y2*c12x2*c13.y-c11.y*c12.x*c20y2*c13x2-c10x2*c12.x*c12y2*c13.y-3*c10x2*c20.y*c13.x*c13y2+3*c10y2*c20.x*c13x2*c13.y+c10y2*c12x2*c12.y*c13.x-c11x2*c20.y*c12y2*c13.x+2*c20x2*c11.y*c12.x*c13y2+3*c20.x*c20y2*c13x2*c13.y-c20x2*c12.x*c12y2*c13.y-3*c20x2*c20.y*c13.x*c13y2+c12x2*c20y2*c12.y*c13.x);var roots=poly.getRootsInInterval(0,1);for(var i=0;i<roots.length;i++){var s=roots[i];var xRoots=new Polynomial(c13.x,c12.x,c11.x,c10.x-c20.x-s*c21.x-s*s*c22.x-s*s*s*c23.x).getRoots();var yRoots=new Polynomial(c13.y,c12.y,c11.y,c10.y-c20.y-s*c21.y-s*s*c22.y-s*s*s*c23.y).getRoots();if(xRoots.length>0&&yRoots.length>0){var TOLERANCE=1e-4;checkRoots:for(var j=0;j<xRoots.length;j++){var xRoot=xRoots[j];if(0<=xRoot&&xRoot<=1){for(var k=0;k<yRoots.length;k++){if(Math.abs(xRoot-yRoots[k])<TOLERANCE){result.points.push(c23.multiply(s*s*s).add(c22.multiply(s*s).add(c21.multiply(s).add(c20))));break checkRoots;}}}}}}if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectBezier3Circle=function(p1,p2,p3,p4,c,r){return Intersection.intersectBezier3Ellipse(p1,p2,p3,p4,c,r,r);};
Intersection.intersectBezier3Ellipse=function(p1,p2,p3,p4,ec,rx,ry){var a,b,c,d;var c3,c2,c1,c0;var result=new Intersection("No Intersection");a=p1.multiply(-1);b=p2.multiply(3);c=p3.multiply(-3);d=a.add(b.add(c.add(p4)));c3=new Vector2D(d.x,d.y);a=p1.multiply(3);b=p2.multiply(-6);c=p3.multiply(3);d=a.add(b.add(c));c2=new Vector2D(d.x,d.y);a=p1.multiply(-3);b=p2.multiply(3);c=a.add(b);c1=new Vector2D(c.x,c.y);c0=new Vector2D(p1.x,p1.y);var rxrx=rx*rx;var ryry=ry*ry;var poly=new Polynomial(c3.x*c3.x*ryry+c3.y*c3.y*rxrx,2*(c3.x*c2.x*ryry+c3.y*c2.y*rxrx),2*(c3.x*c1.x*ryry+c3.y*c1.y*rxrx)+c2.x*c2.x*ryry+c2.y*c2.y*rxrx,2*c3.x*ryry*(c0.x-ec.x)+2*c3.y*rxrx*(c0.y-ec.y)+2*(c2.x*c1.x*ryry+c2.y*c1.y*rxrx),2*c2.x*ryry*(c0.x-ec.x)+2*c2.y*rxrx*(c0.y-ec.y)+c1.x*c1.x*ryry+c1.y*c1.y*rxrx,2*c1.x*ryry*(c0.x-ec.x)+2*c1.y*rxrx*(c0.y-ec.y),c0.x*c0.x*ryry-2*c0.y*ec.y*rxrx-2*c0.x*ec.x*ryry+c0.y*c0.y*rxrx+ec.x*ec.x*ryry+ec.y*ec.y*rxrx-rxrx*ryry);var roots=poly.getRootsInInterval(0,1);for(var i=0;i<roots.length;i++){var t=roots[i];result.points.push(c3.multiply(t*t*t).add(c2.multiply(t*t).add(c1.multiply(t).add(c0))));}if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectBezier3Line=function(p1,p2,p3,p4,a1,a2){var a,b,c,d;var c3,c2,c1,c0;var cl;var n;var min=a1.min(a2);var max=a1.max(a2);var result=new Intersection("No Intersection");a=p1.multiply(-1);b=p2.multiply(3);c=p3.multiply(-3);d=a.add(b.add(c.add(p4)));c3=new Vector2D(d.x,d.y);a=p1.multiply(3);b=p2.multiply(-6);c=p3.multiply(3);d=a.add(b.add(c));c2=new Vector2D(d.x,d.y);a=p1.multiply(-3);b=p2.multiply(3);c=a.add(b);c1=new Vector2D(c.x,c.y);c0=new Vector2D(p1.x,p1.y);n=new Vector2D(a1.y-a2.y,a2.x-a1.x);cl=a1.x*a2.y-a2.x*a1.y;roots=new Polynomial(n.dot(c3),n.dot(c2),n.dot(c1),n.dot(c0)+cl).getRoots();for(var i=0;i<roots.length;i++){var t=roots[i];if(0<=t&&t<=1){var p5=p1.lerp(p2,t);var p6=p2.lerp(p3,t);var p7=p3.lerp(p4,t);var p8=p5.lerp(p6,t);var p9=p6.lerp(p7,t);var p10=p8.lerp(p9,t);if(a1.x==a2.x){if(min.y<=p10.y&&p10.y<=max.y){result.status="Intersection";result.appendPoint(p10);}}else if(a1.y==a2.y){if(min.x<=p10.x&&p10.x<=max.x){result.status="Intersection";result.appendPoint(p10);}}else if(p10.gte(min)&&p10.lte(max)){result.status="Intersection";result.appendPoint(p10);}}}return result;};
Intersection.intersectBezier3Polygon=function(p1,p2,p3,p4,points){var result=new Intersection("No Intersection");var length=points.length;for(var i=0;i<length;i++){var a1=points[i];var a2=points[(i+1)%length];var inter=Intersection.intersectBezier3Line(p1,p2,p3,p4,a1,a2);result.appendPoints(inter.points);}if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectBezier3Rectangle=function(p1,p2,p3,p4,r1,r2){var min=r1.min(r2);var max=r1.max(r2);var topRight=new Point2D(max.x,min.y);var bottomLeft=new Point2D(min.x,max.y);var inter1=Intersection.intersectBezier3Line(p1,p2,p3,p4,min,topRight);var inter2=Intersection.intersectBezier3Line(p1,p2,p3,p4,topRight,max);var inter3=Intersection.intersectBezier3Line(p1,p2,p3,p4,max,bottomLeft);var inter4=Intersection.intersectBezier3Line(p1,p2,p3,p4,bottomLeft,min);var result=new Intersection("No Intersection");result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectCircleCircle=function(c1,r1,c2,r2){var result;var r_max=r1+r2;var r_min=Math.abs(r1-r2);var c_dist=c1.distanceFrom(c2);if(c_dist>r_max){result=new Intersection("Outside");}else if(c_dist<r_min){result=new Intersection("Inside");}else{result=new Intersection("Intersection");var a=(r1*r1-r2*r2+c_dist*c_dist)/(2*c_dist);var h=Math.sqrt(r1*r1-a*a);var p=c1.lerp(c2,a/c_dist);var b=h/c_dist;result.points.push(new Point2D(p.x-b*(c2.y-c1.y),p.y+b*(c2.x-c1.x)));result.points.push(new Point2D(p.x+b*(c2.y-c1.y),p.y-b*(c2.x-c1.x)));}return result;};
Intersection.intersectCircleEllipse=function(cc,r,ec,rx,ry){return Intersection.intersectEllipseEllipse(cc,r,r,ec,rx,ry);};
Intersection.intersectCircleLine=function(c,r,a1,a2){var result;var a=(a2.x-a1.x)*(a2.x-a1.x)+(a2.y-a1.y)*(a2.y-a1.y);var b=2*((a2.x-a1.x)*(a1.x-c.x)+(a2.y-a1.y)*(a1.y-c.y));var cc=c.x*c.x+c.y*c.y+a1.x*a1.x+a1.y*a1.y-2*(c.x*a1.x+c.y*a1.y)-r*r;var deter=b*b-4*a*cc;if(deter<0){result=new Intersection("Outside");}else if(deter==0){result=new Intersection("Tangent");}else{var e=Math.sqrt(deter);var u1=(-b+e)/(2*a);var u2=(-b-e)/(2*a);if((u1<0||u1>1)&&(u2<0||u2>1)){if((u1<0&&u2<0)||(u1>1&&u2>1)){result=new Intersection("Outside");}else{result=new Intersection("Inside");}}else{result=new Intersection("Intersection");if(0<=u1&&u1<=1)result.points.push(a1.lerp(a2,u1));if(0<=u2&&u2<=1)result.points.push(a1.lerp(a2,u2));}}return result;};
Intersection.intersectCirclePolygon=function(c,r,points){var result=new Intersection("No Intersection");var length=points.length;var inter;for(var i=0;i<length;i++){var a1=points[i];var a2=points[(i+1)%length];inter=Intersection.intersectCircleLine(c,r,a1,a2);result.appendPoints(inter.points);}if(result.points.length>0)result.status="Intersection";else result.status=inter.status;return result;};
Intersection.intersectCircleRectangle=function(c,r,r1,r2){var min=r1.min(r2);var max=r1.max(r2);var topRight=new Point2D(max.x,min.y);var bottomLeft=new Point2D(min.x,max.y);var inter1=Intersection.intersectCircleLine(c,r,min,topRight);var inter2=Intersection.intersectCircleLine(c,r,topRight,max);var inter3=Intersection.intersectCircleLine(c,r,max,bottomLeft);var inter4=Intersection.intersectCircleLine(c,r,bottomLeft,min);var result=new Intersection("No Intersection");result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0)result.status="Intersection";else result.status=inter1.status;return result;};
Intersection.intersectEllipseEllipse=function(c1,rx1,ry1,c2,rx2,ry2){var a=[ry1*ry1,0,rx1*rx1,-2*ry1*ry1*c1.x,-2*rx1*rx1*c1.y,ry1*ry1*c1.x*c1.x+rx1*rx1*c1.y*c1.y-rx1*rx1*ry1*ry1];var b=[ry2*ry2,0,rx2*rx2,-2*ry2*ry2*c2.x,-2*rx2*rx2*c2.y,ry2*ry2*c2.x*c2.x+rx2*rx2*c2.y*c2.y-rx2*rx2*ry2*ry2];var yPoly=Intersection.bezout(a,b);var yRoots=yPoly.getRoots();var epsilon=1e-3;var norm0=(a[0]*a[0]+2*a[1]*a[1]+a[2]*a[2])*epsilon;var norm1=(b[0]*b[0]+2*b[1]*b[1]+b[2]*b[2])*epsilon;var result=new Intersection("No Intersection");for(var y=0;y<yRoots.length;y++){var xPoly=new Polynomial(a[0],a[3]+yRoots[y]*a[1],a[5]+yRoots[y]*(a[4]+yRoots[y]*a[2]));var xRoots=xPoly.getRoots();for(var x=0;x<xRoots.length;x++){var test=(a[0]*xRoots[x]+a[1]*yRoots[y]+a[3])*xRoots[x]+(a[2]*yRoots[y]+a[4])*yRoots[y]+a[5];if(Math.abs(test)<norm0){test=(b[0]*xRoots[x]+b[1]*yRoots[y]+b[3])*xRoots[x]+(b[2]*yRoots[y]+b[4])*yRoots[y]+b[5];if(Math.abs(test)<norm1){result.appendPoint(new Point2D(xRoots[x],yRoots[y]));}}}}if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectEllipseLine=function(c,rx,ry,a1,a2){var result;var origin=new Vector2D(a1.x,a1.y);var dir=Vector2D.fromPoints(a1,a2);var center=new Vector2D(c.x,c.y);var diff=origin.subtract(center);var mDir=new Vector2D(dir.x/(rx*rx),  dir.y/(ry*ry));var mDiff=new Vector2D(diff.x/(rx*rx), diff.y/(ry*ry));var a=dir.dot(mDir);var b=dir.dot(mDiff);var c=diff.dot(mDiff)-1.0;var d=b*b-a*c;if(d<0){result=new Intersection("Outside");}else if(d>0){var root=Math.sqrt(d);var t_a=(-b-root)/a;var t_b=(-b+root)/a;if((t_a<0||1<t_a)&&(t_b<0||1<t_b)){if((t_a<0&&t_b<0)||(t_a>1&&t_b>1))result=new Intersection("Outside");else result=new Intersection("Inside");}else{result=new Intersection("Intersection");if(0<=t_a&&t_a<=1)result.appendPoint(a1.lerp(a2,t_a));if(0<=t_b&&t_b<=1)result.appendPoint(a1.lerp(a2,t_b));}}else{var t=-b/a;if(0<=t&&t<=1){result=new Intersection("Intersection");result.appendPoint(a1.lerp(a2,t));}else{result=new Intersection("Outside");}}return result;};
Intersection.intersectEllipsePolygon=function(c,rx,ry,points){var result=new Intersection("No Intersection");var length=points.length;for(var i=0;i<length;i++){var b1=points[i];var b2=points[(i+1)%length];var inter=Intersection.intersectEllipseLine(c,rx,ry,b1,b2);result.appendPoints(inter.points);}if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectEllipseRectangle=function(c,rx,ry,r1,r2){var min=r1.min(r2);var max=r1.max(r2);var topRight=new Point2D(max.x,min.y);var bottomLeft=new Point2D(min.x,max.y);var inter1=Intersection.intersectEllipseLine(c,rx,ry,min,topRight);var inter2=Intersection.intersectEllipseLine(c,rx,ry,topRight,max);var inter3=Intersection.intersectEllipseLine(c,rx,ry,max,bottomLeft);var inter4=Intersection.intersectEllipseLine(c,rx,ry,bottomLeft,min);var result=new Intersection("No Intersection");result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectLineLine=function(a1,a2,b1,b2){var result;var ua_t=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x);var ub_t=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x);var u_b=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(u_b!=0){var ua=ua_t/u_b;var ub=ub_t/u_b;if(0<=ua&&ua<=1&&0<=ub&&ub<=1){result=new Intersection("Intersection");result.points.push(new Point2D(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)));}else{result=new Intersection("No Intersection");}}else{if(ua_t==0||ub_t==0){result=new Intersection("Coincident");}else{result=new Intersection("Parallel");}}return result;};
Intersection.intersectLinePolygon=function(a1,a2,points){var result=new Intersection("No Intersection");var length=points.length;for(var i=0;i<length;i++){var b1=points[i];var b2=points[(i+1)%length];var inter=Intersection.intersectLineLine(a1,a2,b1,b2);result.appendPoints(inter.points);}if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectLineRectangle=function(a1,a2,r1,r2){var min=r1.min(r2);var max=r1.max(r2);var topRight=new Point2D(max.x,min.y);var bottomLeft=new Point2D(min.x,max.y);var inter1=Intersection.intersectLineLine(min,topRight,a1,a2);var inter2=Intersection.intersectLineLine(topRight,max,a1,a2);var inter3=Intersection.intersectLineLine(max,bottomLeft,a1,a2);var inter4=Intersection.intersectLineLine(bottomLeft,min,a1,a2);var result=new Intersection("No Intersection");result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectPolygonPolygon=function(points1,points2){var result=new Intersection("No Intersection");var length=points1.length;for(var i=0;i<length;i++){var a1=points1[i];var a2=points1[(i+1)%length];var inter=Intersection.intersectLinePolygon(a1,a2,points2);result.appendPoints(inter.points);}if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectPolygonRectangle=function(points,r1,r2){var min=r1.min(r2);var max=r1.max(r2);var topRight=new Point2D(max.x,min.y);var bottomLeft=new Point2D(min.x,max.y);var inter1=Intersection.intersectLinePolygon(min,topRight,points);var inter2=Intersection.intersectLinePolygon(topRight,max,points);var inter3=Intersection.intersectLinePolygon(max,bottomLeft,points);var inter4=Intersection.intersectLinePolygon(bottomLeft,min,points);var result=new Intersection("No Intersection");result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0)result.status="Intersection";return result;};
Intersection.intersectRayRay=function(a1,a2,b1,b2){var result;var ua_t=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x);var ub_t=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x);var u_b=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(u_b!=0){var ua=ua_t/u_b;result=new Intersection("Intersection");result.points.push(new Point2D(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)));}else{if(ua_t==0||ub_t==0){result=new Intersection("Coincident");}else{result=new Intersection("Parallel");}}return result;};
Intersection.intersectRectangleRectangle=function(a1,a2,b1,b2){var min=a1.min(a2);var max=a1.max(a2);var topRight=new Point2D(max.x,min.y);var bottomLeft=new Point2D(min.x,max.y);var inter1=Intersection.intersectLineRectangle(min,topRight,b1,b2);var inter2=Intersection.intersectLineRectangle(topRight,max,b1,b2);var inter3=Intersection.intersectLineRectangle(max,bottomLeft,b1,b2);var inter4=Intersection.intersectLineRectangle(bottomLeft,min,b1,b2);var result=new Intersection("No Intersection");result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0)result.status="Intersection";return result;};
Intersection.bezout=function(e1,e2){var AB=e1[0]*e2[1]-e2[0]*e1[1];var AC=e1[0]*e2[2]-e2[0]*e1[2];var AD=e1[0]*e2[3]-e2[0]*e1[3];var AE=e1[0]*e2[4]-e2[0]*e1[4];var AF=e1[0]*e2[5]-e2[0]*e1[5];var BC=e1[1]*e2[2]-e2[1]*e1[2];var BE=e1[1]*e2[4]-e2[1]*e1[4];var BF=e1[1]*e2[5]-e2[1]*e1[5];var CD=e1[2]*e2[3]-e2[2]*e1[3];var DE=e1[3]*e2[4]-e2[3]*e1[4];var DF=e1[3]*e2[5]-e2[3]*e1[5];var BFpDE=BF+DE;var BEmCD=BE-CD;return new Polynomial(AB*BC-AC*AC,AB*BEmCD+AD*BC-2*AC*AE,AB*BFpDE+AD*BEmCD-AE*AE-2*AC*AF,AB*DF+AD*BFpDE-2*AE*AF,AD*DF-AF*AF);};
function IntersectionParams(name,params){if(arguments.length>0)this.init(name,params);}
IntersectionParams.prototype.init=function(name,params){this.name=name;this.params=params;};
function Point2D(x,y){if(arguments.length>0){this.x=x;this.y=y;}}
Point2D.prototype.clone=function(){return new Point2D(this.x,this.y);};
Point2D.prototype.add=function(that){return new Point2D(this.x+that.x,this.y+that.y);};
Point2D.prototype.addEquals=function(that){this.x+=that.x;this.y+=that.y;return this;};
Point2D.prototype.offset=function(a,b){var result=0;if(!(b.x<=this.x||this.x+a.x<=0)){var t=b.x*a.y-a.x*b.y;var s;var d;if(t>0){if(this.x<0){s=this.x*a.y;d=s/a.x-this.y;}else if(this.x>0){s=this.x*b.y;d=s/b.x-this.y}else{d=-this.y;}}else{if(b.x<this.x+a.x){s=(b.x-this.x)*a.y;d=b.y-(this.y+s/a.x);}else if(b.x>this.x+a.x){s=(a.x+this.x)*b.y;d=s/b.x-(this.y+a.y);}else{d=b.y-(this.y+a.y);}}if(d>0){result=d;}}return result;};
Point2D.prototype.rmoveto=function(dx,dy){this.x+=dx;this.y+=dy;};
Point2D.prototype.scalarAdd=function(scalar){return new Point2D(this.x+scalar,this.y+scalar);};
Point2D.prototype.scalarAddEquals=function(scalar){this.x+=scalar;this.y+=scalar;return this;};
Point2D.prototype.subtract=function(that){return new Point2D(this.x-that.x,this.y-that.y);};
Point2D.prototype.subtractEquals=function(that){this.x-=that.x;this.y-=that.y;return this;};
Point2D.prototype.scalarSubtract=function(scalar){return new Point2D(this.x-scalar,this.y-scalar);};
Point2D.prototype.scalarSubtractEquals=function(scalar){this.x-=scalar;this.y-=scalar;return this;};
Point2D.prototype.multiply=function(scalar){return new Point2D(this.x*scalar,this.y*scalar);};
Point2D.prototype.multiplyEquals=function(scalar){this.x*=scalar;this.y*=scalar;return this;};
Point2D.prototype.divide=function(scalar){return new Point2D(this.x/scalar, this.y/scalar);};
Point2D.prototype.divideEquals=function(scalar){this.x/=scalar;this.y/=scalar;return this;};
Point2D.prototype.compare=function(that){return(this.x-that.x||this.y-that.y);};
Point2D.prototype.eq=function(that){return(this.x==that.x&&this.y==that.y);};
Point2D.prototype.lt=function(that){return(this.x<that.x&&this.y<that.y);};
Point2D.prototype.lte=function(that){return(this.x<=that.x&&this.y<=that.y);};
Point2D.prototype.gt=function(that){return(this.x>that.x&&this.y>that.y);};
Point2D.prototype.gte=function(that){return(this.x>=that.x&&this.y>=that.y);};
Point2D.prototype.lerp=function(that,t){return new Point2D(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t);};
Point2D.prototype.distanceFrom=function(that){var dx=this.x-that.x;var dy=this.y-that.y;return Math.sqrt(dx*dx+dy*dy);};
Point2D.prototype.min=function(that){return new Point2D(Math.min(this.x,that.x),Math.min(this.y,that.y));};
Point2D.prototype.max=function(that){return new Point2D(Math.max(this.x,that.x),Math.max(this.y,that.y));};
Point2D.prototype.toString=function(){return this.x+","+this.y;};
Point2D.prototype.setXY=function(x,y){this.x=x;this.y=y;};
Point2D.prototype.setFromPoint=function(that){this.x=that.x;this.y=that.y;};
Point2D.prototype.swap=function(that){var x=this.x;var y=this.y;this.x=that.x;this.y=that.y;that.x=x;that.y=y;};
Polynomial.TOLERANCE=1e-6;
Polynomial.ACCURACY=6;
Polynomial.interpolate=function(xs,ys,n,offset,x){if(xs.constructor!==Array||ys.constructor!==Array)throw new Error("Polynomial.interpolate: xs and ys must be arrays");if(isNaN(n)||isNaN(offset)||isNaN(x))throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");var y=0;var dy=0;var c=new Array(n);var d=new Array(n);var ns=0;var result;var diff=Math.abs(x-xs[offset]);for(var i=0;i<n;i++){var dift=Math.abs(x-xs[offset+i]);if(dift<diff){ns=i;diff=dift;}c[i]=d[i]=ys[offset+i];}y=ys[offset+ns];ns--;for(var m=1;m<n;m++){for(var i=0;i<n-m;i++){var ho=xs[offset+i]-x;var hp=xs[offset+i+m]-x;var w=c[i+1]-d[i];var den=ho-hp;if(den==0.0){result={y:0,dy:0};break;}den=w/den;d[i]=hp*den;c[i]=ho*den;}dy=(2*(ns+1)<(n-m))?c[ns+1]:d[ns--];y+=dy;}return{y:y,dy:dy};};
function Polynomial(){this.init(arguments);}
Polynomial.prototype.init=function(coefs){this.coefs=new Array();for(var i=coefs.length-1;i>=0;i--)this.coefs.push(coefs[i]);this._variable="t";this._s=0;};
Polynomial.prototype.eval=function(x){if(isNaN(x))throw new Error("Polynomial.eval: parameter must be a number");var result=0;for(var i=this.coefs.length-1;i>=0;i--)result=result*x+this.coefs[i];return result;};
Polynomial.prototype.add=function(that){var result=new Polynomial();var d1=this.getDegree();var d2=that.getDegree();var dmax=Math.max(d1,d2);for(var i=0;i<=dmax;i++){var v1=(i<=d1)?this.coefs[i]:0;var v2=(i<=d2)?that.coefs[i]:0;result.coefs[i]=v1+v2;}return result;};
Polynomial.prototype.multiply=function(that){var result=new Polynomial();for(var i=0;i<=this.getDegree()+that.getDegree();i++)result.coefs.push(0);for(var i=0;i<=this.getDegree();i++)for(var j=0;j<=that.getDegree();j++)result.coefs[i+j]+=this.coefs[i]*that.coefs[j];return result;};
Polynomial.prototype.divide_scalar=function(scalar){for(var i=0;i<this.coefs.length;i++)this.coefs[i]/=scalar;};
Polynomial.prototype.simplify=function(){for(var i=this.getDegree();i>=0;i--){if(Math.abs(this.coefs[i])<=Polynomial.TOLERANCE)this.coefs.pop();else break;}};
Polynomial.prototype.bisection=function(min,max){var minValue=this.eval(min);var maxValue=this.eval(max);var result;if(Math.abs(minValue)<=Polynomial.TOLERANCE)result=min;else if(Math.abs(maxValue)<=Polynomial.TOLERANCE)result=max;else if(minValue*maxValue<=0){var tmp1=Math.log(max-min);var tmp2=Math.LN10*Polynomial.ACCURACY;var iters=Math.ceil((tmp1+tmp2)/Math.LN2);for(var i=0;i<iters;i++){result=0.5*(min+max);var value=this.eval(result);if(Math.abs(value)<=Polynomial.TOLERANCE){break;}if(value*minValue<0){max=result;maxValue=value;}else{min=result;minValue=value;}}}return result;};
Polynomial.prototype.toString=function(){var coefs=new Array();var signs=new Array();for(var i=this.coefs.length-1;i>=0;i--){var value=Math.round(this.coefs[i]*1000)/1000;if(value!=0){var sign=(value<0)?" - ":" + ";value=Math.abs(value);if(i>0)if(value==1)value=this._variable;else value+=this._variable;if(i>1)value+="^"+i;signs.push(sign);coefs.push(value);}}signs[0]=(signs[0]==" + ")?"":"-";var result="";for(var i=0;i<coefs.length;i++)result+=signs[i]+coefs[i];return result;};
Polynomial.prototype.trapezoid=function(min,max,n){if(isNaN(min)||isNaN(max)||isNaN(n))throw new Error("Polynomial.trapezoid: parameters must be numbers");var range=max-min;var TOLERANCE=1e-7;if(n==1){var minValue=this.eval(min);var maxValue=this.eval(max);this._s=0.5*range*(minValue+maxValue);}else{var it=1<<(n-2);var delta=range/it;var x=min+0.5*delta;var sum=0;for(var i=0;i<it;i++){sum+=this.eval(x);x+=delta;}this._s=0.5*(this._s+range*sum/it);}if(isNaN(this._s))throw new Error("Polynomial.trapezoid: this._s is NaN");return this._s;};
Polynomial.prototype.simpson=function(min,max){if(isNaN(min)||isNaN(max))throw new Error("Polynomial.simpson: parameters must be numbers");var range=max-min;var st=0.5*range*(this.eval(min)+this.eval(max));var t=st;var s=4.0*st/3.0;var os=s;var ost=st;var TOLERANCE=1e-7;var it=1;for(var n=2;n<=20;n++){var delta=range/it;var x=min+0.5*delta;var sum=0;for(var i=1;i<=it;i++){sum+=this.eval(x);x+=delta;}t=0.5*(t+range*sum/it);st=t;s=(4.0*st-ost)/3.0;if(Math.abs(s-os)<TOLERANCE*Math.abs(os))break;os=s;ost=st;it<<=1;}return s;};
Polynomial.prototype.romberg=function(min,max){if(isNaN(min)||isNaN(max))throw new Error("Polynomial.romberg: parameters must be numbers");var MAX=20;var K=3;var TOLERANCE=1e-6;var s=new Array(MAX+1);var h=new Array(MAX+1);var result={y:0,dy:0};h[0]=1.0;for(var j=1;j<=MAX;j++){s[j-1]=this.trapezoid(min,max,j);if(j>=K){result=Polynomial.interpolate(h,s,K,j-K,0.0);if(Math.abs(result.dy)<=TOLERANCE*result.y)break;}s[j]=s[j-1];h[j]=0.25*h[j-1];}return result.y;};
Polynomial.prototype.getDegree=function(){return this.coefs.length-1;};
Polynomial.prototype.getDerivative=function(){var derivative=new Polynomial();for(var i=1;i<this.coefs.length;i++){derivative.coefs.push(i*this.coefs[i]);}return derivative;};
Polynomial.prototype.getRoots=function(){var result;this.simplify();switch(this.getDegree()){case 0:result=new Array();break;case 1:result=this.getLinearRoot();break;case 2:result=this.getQuadraticRoots();break;case 3:result=this.getCubicRoots();break;case 4:result=this.getQuarticRoots();break;default:result=new Array();}return result;};
Polynomial.prototype.getRootsInInterval=function(min,max){var roots=new Array();var root;if(this.getDegree()==1){root=this.bisection(min,max);if(root!=null)roots.push(root);}else{var deriv=this.getDerivative();var droots=deriv.getRootsInInterval(min,max);if(droots.length>0){root=this.bisection(min,droots[0]);if(root!=null)roots.push(root);for(i=0;i<=droots.length-2;i++){root=this.bisection(droots[i],droots[i+1]);if(root!=null)roots.push(root);}root=this.bisection(droots[droots.length-1],max);if(root!=null)roots.push(root);}else{root=this.bisection(min,max);if(root!=null)roots.push(root);}}return roots;};
Polynomial.prototype.getLinearRoot=function(){var result=new Array();var a=this.coefs[1];if(a!=0)result.push(-this.coefs[0]/a);return result;};
Polynomial.prototype.getQuadraticRoots=function(){var results=new Array();if(this.getDegree()==2){var a=this.coefs[2];var b=this.coefs[1]/a;var c=this.coefs[0]/a;var d=b*b-4*c;if(d>0){var e=Math.sqrt(d);results.push(0.5*(-b+e));results.push(0.5*(-b-e));}else if(d==0){results.push(0.5*-b);}}return results;};
Polynomial.prototype.getCubicRoots=function(){var results=new Array();if(this.getDegree()==3){var c3=this.coefs[3];var c2=this.coefs[2]/c3;var c1=this.coefs[1]/c3;var c0=this.coefs[0]/c3;var a=(3*c1-c2*c2)/3;var b=(2*c2*c2*c2-9*c1*c2+27*c0)/27;var offset=c2/3;var discrim=b*b/4 + a*a*a/27;var halfB=b/2;if(Math.abs(discrim)<=Polynomial.TOLERANCE)disrim=0;if(discrim>0){var e=Math.sqrt(discrim);var tmp;var root;tmp=-halfB+e;if(tmp>=0)root=Math.pow(tmp,1/3);else root=-Math.pow(-tmp,1/3);tmp=-halfB-e;if(tmp>=0)root+=Math.pow(tmp,1/3);else root-=Math.pow(-tmp,1/3);results.push(root-offset);}else if(discrim<0){var distance=Math.sqrt(-a/3);var angle=Math.atan2(Math.sqrt(-discrim),-halfB)/3;var cos=Math.cos(angle);var sin=Math.sin(angle);var sqrt3=Math.sqrt(3);results.push(2*distance*cos-offset);results.push(-distance*(cos+sqrt3*sin)-offset);results.push(-distance*(cos-sqrt3*sin)-offset);}else{var tmp;if(halfB>=0)tmp=-Math.pow(halfB,1/3);else tmp=Math.pow(-halfB,1/3);results.push(2*tmp-offset);results.push(-tmp-offset);}}return results;};
Polynomial.prototype.getQuarticRoots=function(){var results=new Array();if(this.getDegree()==4){var c4=this.coefs[4];var c3=this.coefs[3]/c4;var c2=this.coefs[2]/c4;var c1=this.coefs[1]/c4;var c0=this.coefs[0]/c4;var resolveRoots=new Polynomial(1,-c2,c3*c1-4*c0,-c3*c3*c0+4*c2*c0-c1*c1).getCubicRoots();var y=resolveRoots[0];var discrim=c3*c3/4-c2+y;if(Math.abs(discrim)<=Polynomial.TOLERANCE)discrim=0;if(discrim>0){var e=Math.sqrt(discrim);var t1=3*c3*c3/4-e*e-2*c2;var t2=(4*c3*c2-8*c1-c3*c3*c3)/(4*e);var plus=t1+t2;var minus=t1-t2;if(Math.abs(plus)<=Polynomial.TOLERANCE)plus=0;if(Math.abs(minus)<=Polynomial.TOLERANCE)minus=0;if(plus>=0){var f=Math.sqrt(plus);results.push(-c3/4 + (e+f)/2);results.push(-c3/4 + (e-f)/2);}if(minus>=0){var f=Math.sqrt(minus);results.push(-c3/4 + (f-e)/2);results.push(-c3/4 - (f+e)/2);}}else if(discrim<0){}else{var t2=y*y-4*c0;if(t2>=-Polynomial.TOLERANCE){if(t2<0)t2=0;t2=2*Math.sqrt(t2);t1=3*c3*c3/4-2*c2;if(t1+t2>=Polynomial.TOLERANCE){var d=Math.sqrt(t1+t2);results.push(-c3/4 + d/2);results.push(-c3/4 - d/2);}if(t1-t2>=Polynomial.TOLERANCE){var d=Math.sqrt(t1-t2);results.push(-c3/4 + d/2);results.push(-c3/4 - d/2);}}}}return results;};
function Vector2D(x,y){if(arguments.length>0){this.x=x;this.y=y;}}
Vector2D.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};
Vector2D.prototype.dot=function(that){return this.x*that.x+this.y*that.y;};
Vector2D.prototype.cross=function(that){return this.x*that.y-this.y*that.x;}
Vector2D.prototype.unit=function(){return this.divide(this.length());};
Vector2D.prototype.unitEquals=function(){this.divideEquals(this.length());return this;};
Vector2D.prototype.add=function(that){return new Vector2D(this.x+that.x,this.y+that.y);};
Vector2D.prototype.addEquals=function(that){this.x+=that.x;this.y+=that.y;return this;};
Vector2D.prototype.subtract=function(that){return new Vector2D(this.x-that.x,this.y-that.y);};
Vector2D.prototype.subtractEquals=function(that){this.x-=that.x;this.y-=that.y;return this;};
Vector2D.prototype.multiply=function(scalar){return new Vector2D(this.x*scalar,this.y*scalar);};
Vector2D.prototype.multiplyEquals=function(scalar){this.x*=scalar;this.y*=scalar;return this;};
Vector2D.prototype.divide=function(scalar){return new Vector2D(this.x/ scalar, this.y /scalar);};
Vector2D.prototype.divideEquals=function(scalar){this.x/=scalar;this.y/=scalar;return this;};
Vector2D.prototype.perp=function(){return new Vector2D(-this.y,this.x);};
Vector2D.prototype.perpendicular=function(that){return this.subtract(this.project(that));};
Vector2D.prototype.project=function(that){var percent=this.dot(that)/that.dot(that);return that.multiply(percent);};
Vector2D.prototype.toString=function(){return this.x+","+this.y;};
Vector2D.fromPoints=function(p1,p2){return new Vector2D(p2.x-p1.x,p2.y-p1.y);};
Shape.prototype=new EventHandler();
Shape.prototype.constructor=Shape;
Shape.superclass=EventHandler.prototype;
function Shape(svgNode){if(arguments.length>0){this.init(svgNode);}}
Shape.prototype.init=function(svgNode){this.svgNode=svgNode;this.locked=false;this.visible=true;this.selected=false;this.callback=null;this.lastUpdate=null;}
Shape.prototype.show=function(state){var display=(state)?"inline":"none";this.visible=state;this.svgNode.setAttributeNS(null,"display",display);};
Shape.prototype.refresh=function(){};
Shape.prototype.update=function(){this.refresh();if(this.owner)this.owner.update(this);if(this.callback!=null)this.callback(this);};
Shape.prototype.translate=function(delta){};
Shape.prototype.select=function(state){this.selected=state;};
Shape.prototype.registerHandles=function(){};
Shape.prototype.unregisterHandles=function(){};
Shape.prototype.selectHandles=function(select){};
Shape.prototype.showHandles=function(state){};
Shape.prototype.mousedown=function(e){if(!this.locked){if(e.shiftKey){if(this.selected){mouser.unregisterShape(this);}else{mouser.registerShape(this);this.showHandles(true);this.selectHandles(true);this.registerHandles();}}else{if(this.selected){this.selectHandles(true);this.registerHandles();}else{mouser.unregisterShapes();mouser.registerShape(this);this.showHandles(true);this.selectHandles(false);}}}};
Circle.prototype=new Shape();
Circle.prototype.constructor=Circle;
Circle.superclass=Shape.prototype;
function Circle(svgNode){if(arguments.length>0){this.init(svgNode);}}
Circle.prototype.init=function(svgNode){if(svgNode.localName=="circle"){Circle.superclass.init.call(this,svgNode);var cx=parseFloat(svgNode.getAttributeNS(null,"cx"));var cy=parseFloat(svgNode.getAttributeNS(null,"cy"));var r=parseFloat(svgNode.getAttributeNS(null,"r"));this.center=new Handle(cx,cy,this);this.last=new Point2D(cx,cy);this.radius=new Handle(cx+r,cy,this);}else{throw new Error("Circle.init: Invalid SVG Node: "+svgNode.localName);}};
Circle.prototype.realize=function(){if(this.svgNode!=null){this.center.realize();this.radius.realize();this.center.show(false);this.radius.show(false);this.svgNode.addEventListener("mousedown",this,false);}};
Circle.prototype.translate=function(delta){this.center.translate(delta);this.radius.translate(delta);this.refresh();};
Circle.prototype.refresh=function(){var r=this.radius.point.distanceFrom(this.center.point);this.svgNode.setAttributeNS(null,"cx",this.center.point.x);this.svgNode.setAttributeNS(null,"cy",this.center.point.y);this.svgNode.setAttributeNS(null,"r",r);};
Circle.prototype.registerHandles=function(){mouser.register(this.center);mouser.register(this.radius);};
Circle.prototype.unregisterHandles=function(){mouser.unregister(this.center);mouser.unregister(this.radius);};
Circle.prototype.selectHandles=function(select){this.center.select(select);this.radius.select(select);};
Circle.prototype.showHandles=function(state){this.center.show(state);this.radius.show(state);};
Circle.prototype.getIntersectionParams=function(){return new IntersectionParams("Circle",[this.center.point,parseFloat(this.svgNode.getAttributeNS(null,"r"))]);};
Ellipse.prototype=new Shape();
Ellipse.prototype.constructor=Ellipse;
Ellipse.superclass=Shape.prototype;
function Ellipse(svgNode){if(arguments.length>0){this.init(svgNode);}}
Ellipse.prototype.init=function(svgNode){if(svgNode==null||svgNode.localName!="ellipse")throw new Error("Ellipse.init: Invalid localName: "+svgNode.localName);Ellipse.superclass.init.call(this,svgNode);var cx=parseFloat(svgNode.getAttributeNS(null,"cx"));var cy=parseFloat(svgNode.getAttributeNS(null,"cy"));var rx=parseFloat(svgNode.getAttributeNS(null,"rx"));var ry=parseFloat(svgNode.getAttributeNS(null,"ry"));this.center=new Handle(cx,cy,this);this.radiusX=new Handle(cx+rx,cy,this);this.radiusY=new Handle(cx,cy+ry,this);};
Ellipse.prototype.realize=function(){this.center.realize();this.radiusX.realize();this.radiusY.realize();this.center.show(false);this.radiusX.show(false);this.radiusY.show(false);this.svgNode.addEventListener("mousedown",this,false);};
Ellipse.prototype.refresh=function(){var rx=Math.abs(this.center.point.x-this.radiusX.point.x);var ry=Math.abs(this.center.point.y-this.radiusY.point.y);this.svgNode.setAttributeNS(null,"cx",this.center.point.x);this.svgNode.setAttributeNS(null,"cy",this.center.point.y);this.svgNode.setAttributeNS(null,"rx",rx);this.svgNode.setAttributeNS(null,"ry",ry);};
Ellipse.prototype.registerHandles=function(){mouser.register(this.center);mouser.register(this.radiusX);mouser.register(this.radiusY);};
Ellipse.prototype.unregisterHandles=function(){mouser.unregister(this.center);mouser.unregister(this.radiusX);mouser.unregister(this.radiusY);};
Ellipse.prototype.selectHandles=function(select){this.center.select(select);this.radiusX.select(select);this.radiusY.select(select);};
Ellipse.prototype.showHandles=function(state){this.center.show(state);this.radiusX.show(state);this.radiusY.show(state);};
Ellipse.prototype.getIntersectionParams=function(){return new IntersectionParams("Ellipse",[this.center.point,parseFloat(this.svgNode.getAttributeNS(null,"rx")),parseFloat(this.svgNode.getAttributeNS(null,"ry"))]);};
Handle.prototype=new Shape();
Handle.prototype.constructor=Handle;
Handle.superclass=Shape.prototype;
Handle.NO_CONSTRAINTS=0;
Handle.CONSTRAIN_X=1;
Handle.CONSTRAIN_Y=2;
function Handle(x,y,owner){if(arguments.length>0){this.init(x,y,owner);}}
Handle.prototype.init=function(x,y,owner){Handle.superclass.init.call(this,null);this.point=new Point2D(x,y);this.owner=owner;this.constrain=Handle.NO_CONSTRAINTS;}
Handle.prototype.realize=function(){if(this.svgNode==null){var svgns="http://www.w3.org/2000/svg";var handle=svgDocument.createElementNS(svgns,"rect");var parent;if(this.owner!=null&&this.owner.svgNode!=null){parent=this.owner.svgNode.parentNode;}else{parent=svgDocument.documentElement;}handle.setAttributeNS(null,"x",this.point.x-2);handle.setAttributeNS(null,"y",this.point.y-2);handle.setAttributeNS(null,"width",4);handle.setAttributeNS(null,"height",4);handle.setAttributeNS(null,"stroke","black");handle.setAttributeNS(null,"fill","white");handle.addEventListener("mousedown",this,false);parent.appendChild(handle);this.svgNode=handle;this.show(this.visible);}};
Handle.prototype.unrealize=function(){this.svgNode.removeEventListener("mousedown",this,false);this.svgNode.parentNode.removeChild(this.svgNode);};
Handle.prototype.translate=function(delta){if(this.constrain==Handle.CONSTRAIN_X){this.point.x+=delta.x;}else if(this.constrain==Handle.CONSTRAIN_Y){this.point.y+=delta.y;}else{this.point.addEquals(delta);}this.refresh();};
Handle.prototype.refresh=function(){this.svgNode.setAttributeNS(null,"x",this.point.x-2);this.svgNode.setAttributeNS(null,"y",this.point.y-2);};
Handle.prototype.select=function(state){Handle.superclass.select.call(this,state);if(state){this.svgNode.setAttributeNS(null,"fill","black");}else{this.svgNode.setAttributeNS(null,"fill","white");}};
Handle.prototype.mousedown=function(e){if(!this.locked){if(e.shiftKey){if(this.selected){mouser.unregister(this);}else{mouser.register(this);mouser.beginDrag(e);}}else{if(!this.selected){var owner=this.owner;mouser.unregisterAll();mouser.register(this);}mouser.beginDrag(e);}}};
Lever.prototype=new Shape();
Lever.prototype.constructor=Lever;
Lever.superclass=Shape.prototype;
function Lever(x1,y1,x2,y2,owner){if(arguments.length>0){this.init(x1,y1,x2,y2,owner);}}
Lever.prototype.init=function(x1,y1,x2,y2,owner){Lever.superclass.init.call(this,null);this.point=new Handle(x1,y1,this);this.lever=new LeverHandle(x2,y2,this);this.owner=owner;};
Lever.prototype.realize=function(){if(this.svgNode==null){var svgns="http://www.w3.org/2000/svg";var line=svgDocument.createElementNS(svgns,"line");var parent;if(this.owner!=null&&this.owner.svgNode!=null){parent=this.owner.svgNode.parentNode;}else{parent=svgDocument.documentElement;}line.setAttributeNS(null,"x1",this.point.point.x);line.setAttributeNS(null,"y1",this.point.point.y);line.setAttributeNS(null,"x2",this.lever.point.x);line.setAttributeNS(null,"y2",this.lever.point.y);line.setAttributeNS(null,"stroke","black");parent.appendChild(line);this.svgNode=line;this.point.realize();this.lever.realize();this.show(this.visible);}};
Lever.prototype.refresh=function(){this.svgNode.setAttributeNS(null,"x1",this.point.point.x);this.svgNode.setAttributeNS(null,"y1",this.point.point.y);this.svgNode.setAttributeNS(null,"x2",this.lever.point.x);this.svgNode.setAttributeNS(null,"y2",this.lever.point.y);};
LeverHandle.prototype=new Handle();
LeverHandle.prototype.constructor=LeverHandle;
LeverHandle.superclass=Handle.prototype;
function LeverHandle(x,y,owner){if(arguments.length>0){this.init(x,y,owner);}}
LeverHandle.prototype.realize=function(){if(this.svgNode==null){var svgns="http://www.w3.org/2000/svg";var handle=svgDocument.createElementNS(svgns,"circle");var parent;if(this.owner!=null&&this.owner.svgNode!=null){parent=this.owner.svgNode.parentNode;}else{parent=svgDocument.documentElement;}handle.setAttributeNS(null,"cx",this.point.x);handle.setAttributeNS(null,"cy",this.point.y);handle.setAttributeNS(null,"r",2.5);handle.setAttributeNS(null,"fill","black");handle.addEventListener("mousedown",this,false);parent.appendChild(handle);this.svgNode=handle;this.show(this.visible);}};
LeverHandle.prototype.refresh=function(){this.svgNode.setAttributeNS(null,"cx",this.point.x);this.svgNode.setAttributeNS(null,"cy",this.point.y);};
LeverHandle.prototype.select=function(state){LeverHandle.superclass.select.call(this,state);this.svgNode.setAttributeNS(null,"fill","black");};
Line.prototype=new Shape();
Line.prototype.constructor=Line;
Line.superclass=Shape.prototype;
function Line(svgNode){if(arguments.length>0){this.init(svgNode);}}
Line.prototype.init=function(svgNode){if(svgNode==null||svgNode.localName!="line")throw new Error("Line.init: Invalid localName: "+svgNode.localName);Line.superclass.init.call(this,svgNode);var x1=parseFloat(svgNode.getAttributeNS(null,"x1"));var y1=parseFloat(svgNode.getAttributeNS(null,"y1"));var x2=parseFloat(svgNode.getAttributeNS(null,"x2"));var y2=parseFloat(svgNode.getAttributeNS(null,"y2"));this.p1=new Handle(x1,y1,this);this.p2=new Handle(x2,y2,this);};
Line.prototype.realize=function(){this.p1.realize();this.p2.realize();this.p1.show(false);this.p2.show(false);this.svgNode.addEventListener("mousedown",this,false);};
Line.prototype.refresh=function(){this.svgNode.setAttributeNS(null,"x1",this.p1.point.x);this.svgNode.setAttributeNS(null,"y1",this.p1.point.y);this.svgNode.setAttributeNS(null,"x2",this.p2.point.x);this.svgNode.setAttributeNS(null,"y2",this.p2.point.y);};
Line.prototype.registerHandles=function(){mouser.register(this.p1);mouser.register(this.p2);};
Line.prototype.unregisterHandles=function(){mouser.unregister(this.p1);mouser.unregister(this.p2);};
Line.prototype.selectHandles=function(select){this.p1.select(select);this.p2.select(select);};
Line.prototype.showHandles=function(state){this.p1.show(state);this.p2.show(state);};
Line.prototype.cut=function(t){var cutPoint=this.p1.point.lerp(this.p2.point,t);var newLine=this.svgNode.cloneNode(true);this.p2.point.setFromPoint(cutPoint);this.p2.update();if(this.svgNode.nextSibling!=null)this.svgNode.parentNode.insertBefore(newLine,this.svgNode.nextSibling);else this.svgNode.parentNode.appendChild(newLine);var line=new Line(newLine);line.realize();line.p1.point.setFromPoint(cutPoint);line.p1.update();};
Line.prototype.getIntersectionParams=function(){return new IntersectionParams("Line",[this.p1.point,this.p2.point]);};
function Token(type,text){if(arguments.length>0){this.init(type,text);}}
Token.prototype.init=function(type,text){this.type=type;this.text=text;};
Token.prototype.typeis=function(type){return this.type==type;}
Path.prototype=new Shape();
Path.prototype.constructor=Path;
Path.superclass=Shape.prototype;
Path.COMMAND=0;
Path.NUMBER=1;
Path.EOD=2;
Path.PARAMS={A:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],a:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],C:["x1","y1","x2","y2","x","y"],c:["x1","y1","x2","y2","x","y"],H:["x"],h:["x"],L:["x","y"],l:["x","y"],M:["x","y"],m:["x","y"],Q:["x1","y1","x","y"],q:["x1","y1","x","y"],S:["x2","y2","x","y"],s:["x2","y2","x","y"],T:["x","y"],t:["x","y"],V:["y"],v:["y"],Z:[],z:[]};
function Path(svgNode){if(arguments.length>0){this.init(svgNode);}}
Path.prototype.init=function(svgNode){if(svgNode==null||svgNode.localName!="path")throw new Error("Path.init: Invalid localName: "+svgNode.localName);Path.superclass.init.call(this,svgNode);this.segments=null;this.parseData(svgNode.getAttributeNS(null,"d"));};
Path.prototype.realize=function(){for(var i=0;i<this.segments.length;i++){this.segments[i].realize();}this.svgNode.addEventListener("mousedown",this,false);};
Path.prototype.unrealize=function(){for(var i=0;i<this.segments.length;i++){this.segments[i].unrealize();}this.svgNode.removeEventListener("mousedown",this,false);};
Path.prototype.refresh=function(){var d=new Array();for(var i=0;i<this.segments.length;i++){d.push(this.segments[i].toString());}this.svgNode.setAttributeNS(null,"d",d.join(" "));};
Path.prototype.registerHandles=function(){for(var i=0;i<this.segments.length;i++){this.segments[i].registerHandles();}};
Path.prototype.unregisterHandles=function(){for(var i=0;i<this.segments.length;i++){this.segments[i].unregisterHandles();}};
Path.prototype.selectHandles=function(select){for(var i=0;i<this.segments.length;i++){this.segments[i].selectHandles(select);}};
Path.prototype.showHandles=function(state){for(var i=0;i<this.segments.length;i++){this.segments[i].showHandles(state);}};
Path.prototype.appendPathSegment=function(segment){segment.previous=this.segments[this.segments.length-1];this.segments.push(segment);};
Path.prototype.parseData=function(d){var tokens=this.tokenize(d);var index=0;var token=tokens[index];var mode="BOD";this.segments=new Array();while(!token.typeis(Path.EOD)){var param_length;var params=new Array();if(mode=="BOD"){if(token.text=="M"||token.text=="m"){index++;param_length=Path.PARAMS[token.text].length;mode=token.text;}else{throw new Error("Path data must begin with a moveto command");}}else{if(token.typeis(Path.NUMBER)){param_length=Path.PARAMS[mode].length;}else{index++;param_length=Path.PARAMS[token.text].length;mode=token.text;}}if((index+param_length)<tokens.length){for(var i=index;i<index+param_length;i++){var number=tokens[i];if(number.typeis(Path.NUMBER))params[params.length]=number.text;else throw new Error("Parameter type is not a number: "+mode+","+number.text);}var segment;var length=this.segments.length;var previous=(length==0)?null:this.segments[length-1];switch(mode){case"A":segment=new AbsoluteArcPath(params,this,previous);break;case"C":segment=new AbsoluteCurveto3(params,this,previous);break;case"c":segment=new RelativeCurveto3(params,this,previous);break;case"H":segment=new AbsoluteHLineto(params,this,previous);break;case"L":segment=new AbsoluteLineto(params,this,previous);break;case"l":segment=new RelativeLineto(params,this,previous);break;case"M":segment=new AbsoluteMoveto(params,this,previous);break;case"m":segment=new RelativeMoveto(params,this,previous);break;case"Q":segment=new AbsoluteCurveto2(params,this,previous);break;case"q":segment=new RelativeCurveto2(params,this,previous);break;case"S":segment=new AbsoluteSmoothCurveto3(params,this,previous);break;case"s":segment=new RelativeSmoothCurveto3(params,this,previous);break;case"T":segment=new AbsoluteSmoothCurveto2(params,this,previous);break;case"t":segment=new RelativeSmoothCurveto2(params,this,previous);break;case"Z":segment=new RelativeClosePath(params,this,previous);break;case"z":segment=new RelativeClosePath(params,this,previous);break;default:throw new Error("Unsupported segment type: "+mode);};this.segments.push(segment);index+=param_length;token=tokens[index];if(mode=="M")mode="L";if(mode=="m")mode="l";}else{throw new Error("Path data ended before all parameters were found");}}}
Path.prototype.tokenize=function(d){var tokens=new Array();while(d!=""){if(d.match(/^([ \t\r\n,]+)/)){d=d.substr(RegExp.$1.length);}else if(d.match(/^([aAcChHlLmMqQsStTvVzZ])/)){tokens[tokens.length]=new Token(Path.COMMAND,RegExp.$1);d=d.substr(RegExp.$1.length);}else if(d.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/)){tokens[tokens.length]=new Token(Path.NUMBER,parseFloat(RegExp.$1));d=d.substr(RegExp.$1.length);}else{throw new Error("Unrecognized segment command: "+d);}}tokens[tokens.length]=new Token(Path.EOD,null);return tokens;}
Path.prototype.intersectShape=function(shape){var result=new Intersection("No Intersection");for(var i=0;i<this.segments.length;i++){var inter=Intersection.intersectShapes(this.segments[i],shape);result.appendPoints(inter.points);}if(result.points.length>0)result.status="Intersection";return result;};
Path.prototype.getIntersectionParams=function(){return new IntersectionParams("Path",[]);};
function AbsolutePathSegment(command,params,owner,previous){if(arguments.length>0)this.init(command,params,owner,previous);};
AbsolutePathSegment.prototype.init=function(command,params,owner,previous){this.command=command;this.owner=owner;this.previous=previous;this.handles=new Array();var index=0;while(index<params.length){var handle=new Handle(params[index],params[index+1],owner);this.handles.push(handle);index+=2;}};
AbsolutePathSegment.prototype.realize=function(){for(var i=0;i<this.handles.length;i++){var handle=this.handles[i];handle.realize();handle.show(false);}};
AbsolutePathSegment.prototype.unrealize=function(){for(var i=0;i<this.handles.length;i++){this.handles[i].unrealize();}};
AbsolutePathSegment.prototype.registerHandles=function(){for(var i=0;i<this.handles.length;i++){mouser.register(this.handles[i]);}};
AbsolutePathSegment.prototype.unregisterHandles=function(){for(var i=0;i<this.handles.length;i++){mouser.unregister(this.handles[i]);}};
AbsolutePathSegment.prototype.selectHandles=function(select){for(var i=0;i<this.handles.length;i++){this.handles[i].select(select);}};
AbsolutePathSegment.prototype.showHandles=function(state){for(var i=0;i<this.handles.length;i++){this.handles[i].show(state);}};
AbsolutePathSegment.prototype.toString=function(){var points=new Array();var command="";if(this.previous==null||this.previous.constructor!=this.constuctor)command=this.command;for(var i=0;i<this.handles.length;i++){points.push(this.handles[i].point.toString());}return command+points.join(" ");};
AbsolutePathSegment.prototype.getLastPoint=function(){return this.handles[this.handles.length-1].point;};
AbsolutePathSegment.prototype.getIntersectionParams=function(){return null;};
AbsoluteArcPath.prototype=new AbsolutePathSegment();
AbsoluteArcPath.prototype.constructor=AbsoluteArcPath;
AbsoluteArcPath.superclass=AbsolutePathSegment.prototype;
function AbsoluteArcPath(params,owner,previous){if(arguments.length>0){this.init("A",params,owner,previous);}}
AbsoluteArcPath.prototype.init=function(command,params,owner,previous){var point=new Array();var y=params.pop();var x=params.pop();point.push(x,y);AbsoluteArcPath.superclass.init.call(this,command,point,owner,previous);this.rx=parseFloat(params.shift());this.ry=parseFloat(params.shift());this.angle=parseFloat(params.shift());this.arcFlag=parseFloat(params.shift());this.sweepFlag=parseFloat(params.shift());};
AbsoluteArcPath.prototype.toString=function(){var points=new Array();var command="";if(this.previous.constructor!=this.constuctor)command=this.command;return command+[this.rx,this.ry,this.angle,this.arcFlag,this.sweepFlag,this.handles[0].point.toString()].join(",");};
AbsoluteArcPath.prototype.getIntersectionParams=function(){return new IntersectionParams("Ellipse",[this.getCenter(),this.rx,this.ry]);};
AbsoluteArcPath.prototype.getCenter=function(){var startPoint=this.previous.getLastPoint();var endPoint=this.handles[0].point;var rx=this.rx;var ry=this.ry;var angle=this.angle*Math.PI/180;var c=Math.cos(angle);var s=Math.sin(angle);var TOLERANCE=1e-6;var halfDiff=startPoint.subtract(endPoint).divide(2);var x1p=halfDiff.x*c+halfDiff.y*s;var y1p=halfDiff.x*-s+halfDiff.y*c;var x1px1p=x1p*x1p;var y1py1p=y1p*y1p;var lambda=(x1px1p/ (rx*rx) ) + ( y1py1p /(ry*ry));if(lambda>1){var factor=Math.sqrt(lambda);rx*=factor;ry*=factor;}var rxrx=rx*rx;var ryry=ry*ry;var rxy1=rxrx*y1py1p;var ryx1=ryry*x1px1p;var factor=(rxrx*ryry-rxy1-ryx1)/(rxy1+ryx1);if(Math.abs(factor)<TOLERANCE)factor=0;var sq=Math.sqrt(factor);if(this.arcFlag==this.sweepFlag)sq=-sq;var mid=startPoint.add(endPoint).divide(2);var cxp=sq*rx*y1p/ry;var cyp=sq*-ry*x1p/rx;return new Point2D(cxp*c-cyp*s+mid.x,cxp*s+cyp*c+mid.y);};
AbsoluteCurveto2.prototype=new AbsolutePathSegment();
AbsoluteCurveto2.prototype.constructor=AbsoluteCurveto2;
AbsoluteCurveto2.superclass=AbsolutePathSegment.prototype;
function AbsoluteCurveto2(params,owner,previous){if(arguments.length>0){this.init("Q",params,owner,previous);}}
AbsoluteCurveto2.prototype.getControlPoint=function(){return this.handles[0].point;};
AbsoluteCurveto2.prototype.getIntersectionParams=function(){return new IntersectionParams("Bezier2",[this.previous.getLastPoint(),this.handles[0].point,this.handles[1].point]);};
AbsoluteCurveto3.prototype=new AbsolutePathSegment();
AbsoluteCurveto3.prototype.constructor=AbsoluteCurveto3;
AbsoluteCurveto3.superclass=AbsolutePathSegment.prototype;
function AbsoluteCurveto3(params,owner,previous){if(arguments.length>0){this.init("C",params,owner,previous);}}
AbsoluteCurveto3.prototype.getLastControlPoint=function(){return this.handles[1].point;};
AbsoluteCurveto3.prototype.getIntersectionParams=function(){return new IntersectionParams("Bezier3",[this.previous.getLastPoint(),this.handles[0].point,this.handles[1].point,this.handles[2].point]);};
AbsoluteHLineto.prototype=new AbsolutePathSegment();
AbsoluteHLineto.prototype.constructor=AbsoluteHLineto;
AbsoluteHLineto.superclass=AbsolutePathSegment.prototype;
function AbsoluteHLineto(params,owner,previous){if(arguments.length>0){this.init("H",params,owner,previous);}}
AbsoluteHLineto.prototype.init=function(command,params,owner,previous){var prevPoint=previous.getLastPoint();var point=new Array();point.push(params.pop(),prevPoint.y);AbsoluteHLineto.superclass.init.call(this,command,point,owner,previous);};
AbsoluteHLineto.prototype.toString=function(){var points=new Array();var command="";if(this.previous.constructor!=this.constuctor)command=this.command;return command+this.handles[0].point.x;};
AbsoluteLineto.prototype=new AbsolutePathSegment();
AbsoluteLineto.prototype.constructor=AbsoluteLineto;
AbsoluteLineto.superclass=AbsolutePathSegment.prototype;
function AbsoluteLineto(params,owner,previous){if(arguments.length>0){this.init("L",params,owner,previous);}}
AbsoluteLineto.prototype.toString=function(){var points=new Array();var command="";if(this.previous.constructor!=this.constuctor)if(this.previous.constructor!=AbsoluteMoveto)command=this.command;return command+this.handles[0].point.toString();};
AbsoluteLineto.prototype.getIntersectionParams=function(){return new IntersectionParams("Line",[this.previous.getLastPoint(),this.handles[0].point]);};
AbsoluteMoveto.prototype=new AbsolutePathSegment();
AbsoluteMoveto.prototype.constructor=AbsoluteMoveto;
AbsoluteMoveto.superclass=AbsolutePathSegment.prototype;
function AbsoluteMoveto(params,owner,previous){if(arguments.length>0){this.init("M",params,owner,previous);}}
AbsoluteMoveto.prototype.toString=function(){return"M"+this.handles[0].point.toString();};
AbsoluteSmoothCurveto2.prototype=new AbsolutePathSegment();
AbsoluteSmoothCurveto2.prototype.constructor=AbsoluteSmoothCurveto2;
AbsoluteSmoothCurveto2.superclass=AbsolutePathSegment.prototype;
function AbsoluteSmoothCurveto2(params,owner,previous){if(arguments.length>0){this.init("T",params,owner,previous);}}
AbsoluteSmoothCurveto2.prototype.getControlPoint=function(){var lastPoint=this.previous.getLastPoint();var point;if(this.previous.command.match(/^[QqTt]$/)){var ctrlPoint=this.previous.getControlPoint();var diff=ctrlPoint.subtract(lastPoint);point=lastPoint.subtract(diff);}else{point=lastPoint;}return point;};
AbsoluteSmoothCurveto2.prototype.getIntersectionParams=function(){return new IntersectionParams("Bezier2",[this.previous.getLastPoint(),this.getControlPoint(),this.handles[0].point]);};
AbsoluteSmoothCurveto3.prototype=new AbsolutePathSegment();
AbsoluteSmoothCurveto3.prototype.constructor=AbsoluteSmoothCurveto3;
AbsoluteSmoothCurveto3.superclass=AbsolutePathSegment.prototype;
function AbsoluteSmoothCurveto3(params,owner,previous){if(arguments.length>0){this.init("S",params,owner,previous);}}
AbsoluteSmoothCurveto3.prototype.getFirstControlPoint=function(){var lastPoint=this.previous.getLastPoint();var point;if(this.previous.command.match(/^[SsCc]$/)){var lastControl=this.previous.getLastControlPoint();var diff=lastControl.subtract(lastPoint);point=lastPoint.subtract(diff);}else{point=lastPoint;}return point;};
AbsoluteSmoothCurveto3.prototype.getLastControlPoint=function(){return this.handles[0].point;};
AbsoluteSmoothCurveto3.prototype.getIntersectionParams=function(){return new IntersectionParams("Bezier3",[this.previous.getLastPoint(),this.getFirstControlPoint(),this.handles[0].point,this.handles[1].point]);};
RelativePathSegment.prototype=new AbsolutePathSegment();
RelativePathSegment.prototype.constructor=RelativePathSegment;
RelativePathSegment.superclass=AbsolutePathSegment.prototype;
function RelativePathSegment(command,params,owner,previous){if(arguments.length>0)this.init(command,params,owner,previous);}
RelativePathSegment.prototype.init=function(command,params,owner,previous){this.command=command;this.owner=owner;this.previous=previous;this.handles=new Array();var lastPoint;if(this.previous)lastPoint=this.previous.getLastPoint();else lastPoint=new Point2D(0,0);var index=0;while(index<params.length){var handle=new Handle(lastPoint.x+params[index],lastPoint.y+params[index+1],owner);this.handles.push(handle);index+=2;}};
RelativePathSegment.prototype.toString=function(){var points=new Array();var command="";var lastPoint;if(this.previous)lastPoint=this.previous.getLastPoint();else lastPoint=new Point2D(0,0);if(this.previous==null||this.previous.constructor!=this.constructor)command=this.command;for(var i=0;i<this.handles.length;i++){var point=this.handles[i].point.subtract(lastPoint);points.push(point.toString());}return command+points.join(" ");};
RelativeClosePath.prototype=new RelativePathSegment();
RelativeClosePath.prototype.constructor=RelativeClosePath;
RelativeClosePath.superclass=RelativePathSegment.prototype;
function RelativeClosePath(params,owner,previous){if(arguments.length>0){this.init("z",params,owner,previous);}}
RelativeClosePath.prototype.getLastPoint=function(){var current=this.previous;var point;while(current){if(current.command.match(/^[mMzZ]$/)){point=current.getLastPoint();break;}current=current.previous;}return point;};
RelativeClosePath.prototype.getIntersectionParams=function(){return new IntersectionParams("Line",[this.previous.getLastPoint(),this.getLastPoint()]);};
RelativeCurveto2.prototype=new RelativePathSegment();
RelativeCurveto2.prototype.constructor=RelativeCurveto2;
RelativeCurveto2.superclass=RelativePathSegment.prototype;
function RelativeCurveto2(params,owner,previous){if(arguments.length>0){this.init("q",params,owner,previous);}}
RelativeCurveto2.prototype.getControlPoint=function(){return this.handles[0].point;};
RelativeCurveto2.prototype.getIntersectionParams=function(){return new IntersectionParams("Bezier2",[this.previous.getLastPoint(),this.handles[0].point,this.handles[1].point]);};
RelativeCurveto3.prototype=new RelativePathSegment();
RelativeCurveto3.prototype.constructor=RelativeCurveto3;
RelativeCurveto3.superclass=RelativePathSegment.prototype;
function RelativeCurveto3(params,owner,previous){if(arguments.length>0){this.init("c",params,owner,previous);}}
RelativeCurveto3.prototype.getLastControlPoint=function(){return this.handles[1].point;};
RelativeCurveto3.prototype.getIntersectionParams=function(){return new IntersectionParams("Bezier3",[this.previous.getLastPoint(),this.handles[0].point,this.handles[1].point,this.handles[2].point]);};
RelativeLineto.prototype=new RelativePathSegment();
RelativeLineto.prototype.constructor=RelativeLineto;
RelativeLineto.superclass=RelativePathSegment.prototype;
function RelativeLineto(params,owner,previous){if(arguments.length>0){this.init("l",params,owner,previous);}}
RelativeLineto.prototype.toString=function(){var points=new Array();var command="";var lastPoint;var point;if(this.previous)lastPoint=this.previous.getLastPoint();else lastPoint=new Point(0,0);point=this.handles[0].point.subtract(lastPoint);if(this.previous.constructor!=this.constuctor)if(this.previous.constructor!=RelativeMoveto)cmd=this.command;return cmd+point.toString();};
RelativeLineto.prototype.getIntersectionParams=function(){return new IntersectionParams("Line",[this.previous.getLastPoint(),this.handles[0].point]);};
RelativeMoveto.prototype=new RelativePathSegment();
RelativeMoveto.prototype.constructor=RelativeMoveto;
RelativeMoveto.superclass=RelativePathSegment.prototype;
function RelativeMoveto(params,owner,previous){if(arguments.length>0){this.init("m",params,owner,previous);}}
RelativeMoveto.prototype.toString=function(){return"m"+this.handles[0].point.toString();};
RelativeSmoothCurveto2.prototype=new RelativePathSegment();
RelativeSmoothCurveto2.prototype.constructor=RelativeSmoothCurveto2;
RelativeSmoothCurveto2.superclass=RelativePathSegment.prototype;
function RelativeSmoothCurveto2(params,owner,previous){if(arguments.length>0){this.init("t",params,owner,previous);}}
RelativeSmoothCurveto2.prototype.getControlPoint=function(){var lastPoint=this.previous.getLastPoint();var point;if(this.previous.command.match(/^[QqTt]$/)){var ctrlPoint=this.previous.getControlPoint();var diff=ctrlPoint.subtract(lastPoint);point=lastPoint.subtract(diff);}else{point=lastPoint;}return point;};
RelativeSmoothCurveto2.prototype.getIntersectionParams=function(){return new IntersectionParams("Bezier2",[this.previous.getLastPoint(),this.getControlPoint(),this.handles[0].point]);};
RelativeSmoothCurveto3.prototype=new RelativePathSegment();
RelativeSmoothCurveto3.prototype.constructor=RelativeSmoothCurveto3;
RelativeSmoothCurveto3.superclass=RelativePathSegment.prototype;
function RelativeSmoothCurveto3(params,owner,previous){if(arguments.length>0){this.init("s",params,owner,previous);}}
RelativeSmoothCurveto3.prototype.getFirstControlPoint=function(){var lastPoint=this.previous.getLastPoint();var point;if(this.previous.command.match(/^[SsCc]$/)){var lastControl=this.previous.getLastControlPoint();var diff=lastControl.subtract(lastPoint);point=lastPoint.subtract(diff);}else{point=lastPoint;}return point;};
RelativeSmoothCurveto3.prototype.getLastControlPoint=function(){return this.handles[0].point;};
RelativeSmoothCurveto3.prototype.getIntersectionParams=function(){return new IntersectionParams("Bezier3",[this.previous.getLastPoint(),this.getFirstControlPoint(),this.handles[0].point,this.handles[1].point]);};
Polygon.prototype=new Shape();
Polygon.prototype.constructor=Polygon;
Polygon.superclass=Shape.prototype;
function Polygon(svgNode){if(arguments.length>0){this.init(svgNode);}}
Polygon.prototype.init=function(svgNode){if(svgNode.localName=="polygon"){Polygon.superclass.init.call(this,svgNode);var points=svgNode.getAttributeNS(null,"points").split(/[\s,]+/);this.handles=new Array();for(var i=0;i<points.length;i+=2){var x=parseFloat(points[i]);var y=parseFloat(points[i+1]);this.handles.push(new Handle(x,y,this));}}else{throw new Error("Polygon.init: Invalid SVG Node: "+svgNode.localName);}};
Polygon.prototype.realize=function(){if(this.svgNode!=null){for(var i=0;i<this.handles.length;i++){this.handles[i].realize();this.handles[i].show(false);}this.svgNode.addEventListener("mousedown",this,false);}};
Polygon.prototype.refresh=function(){var points=new Array();for(var i=0;i<this.handles.length;i++){points.push(this.handles[i].point.toString());}this.svgNode.setAttributeNS(null,"points",points.join(" "));};
Polygon.prototype.registerHandles=function(){for(var i=0;i<this.handles.length;i++)mouser.register(this.handles[i]);};
Polygon.prototype.unregisterHandles=function(){for(var i=0;i<this.handles.length;i++)mouser.unregister(this.handles[i]);};
Polygon.prototype.selectHandles=function(select){for(var i=0;i<this.handles.length;i++)this.handles[i].select(select);};
Polygon.prototype.showHandles=function(state){for(var i=0;i<this.handles.length;i++)this.handles[i].show(state);};
Polygon.prototype.pointInPolygon=function(point){var length=this.handles.length;var counter=0;var x_inter;var p1=this.handles[0].point;for(var i=1;i<=length;i++){var p2=this.handles[i%length].point;if(point.y>Math.min(p1.y,p2.y)){if(point.y<=Math.max(p1.y,p2.y)){if(point.x<=Math.max(p1.x,p2.x)){if(p1.y!=p2.y){x_inter=(point.y-p1.y)*(p2.x-p1.x)/(p2.y-p1.y)+p1.x;if(p1.x==p2.x||point.x<=x_inter){counter++;}}}}}p1=p2;}return(counter%2==1);};
Polygon.prototype.getIntersectionParams=function(){var points=new Array();for(var i=0;i<this.handles.length;i++){points.push(this.handles[i].point);}return new IntersectionParams("Polygon",[points]);};
Polygon.prototype.getArea=function(){var area=0;var length=this.handles.length;var neg=0;var pos=0;for(var i=0;i<length;i++){var h1=this.handles[i].point;var h2=this.handles[(i+1)%length].point;area+=(h1.x*h2.y-h2.x*h1.y);}return area/2;};
Polygon.prototype.getCentroid=function(){var length=this.handles.length;var area6x=6*this.getArea();var x_sum=0;var y_sum=0;for(var i=0;i<length;i++){var p1=this.handles[i].point;var p2=this.handles[(i+1)%length].point;var cross=(p1.x*p2.y-p2.x*p1.y);x_sum+=(p1.x+p2.x)*cross;y_sum+=(p1.y+p2.y)*cross;}return new Point2D(x_sum/ area6x, y_sum /area6x);};
Polygon.prototype.isClockwise=function(){return this.getArea()<0;};
Polygon.prototype.isCounterClockwise=function(){return this.getArea()>0;};
Polygon.prototype.isConcave=function(){var positive=0;var negative=0;var length=this.handles.length;for(var i=0;i<length;i++){var p0=this.handles[i].point;var p1=this.handles[(i+1)%length].point;var p2=this.handles[(i+2)%length].point;var v0=Vector2D.fromPoints(p0,p1);var v1=Vector2D.fromPoints(p1,p2);var cross=v0.cross(v1);if(cross<0){negative++;}else{positive++;}}return(negative!=0&&positive!=0);};
Polygon.prototype.isConvex=function(){return!this.isConcave();};
Rectangle.prototype=new Shape();
Rectangle.prototype.constructor=Rectangle;
Rectangle.superclass=Shape.prototype;
function Rectangle(svgNode){if(arguments.length>0){this.init(svgNode);}}
Rectangle.prototype.init=function(svgNode){if(svgNode.localName=="rect"){Rectangle.superclass.init.call(this,svgNode);var x=parseFloat(svgNode.getAttributeNS(null,"x"));var y=parseFloat(svgNode.getAttributeNS(null,"y"));var width=parseFloat(svgNode.getAttributeNS(null,"width"));var height=parseFloat(svgNode.getAttributeNS(null,"height"));this.p1=new Handle(x,y,this);this.p2=new Handle(x+width,y+height,this);}else{throw new Error("Rectangle.init: Invalid SVG Node: "+svgNode.localName);}};
Rectangle.prototype.realize=function(){if(this.svgNode!=null){this.p1.realize();this.p2.realize();this.p1.show(false);this.p2.show(false);this.svgNode.addEventListener("mousedown",this,false);}};
Rectangle.prototype.refresh=function(){var min=this.p1.point.min(this.p2.point);var max=this.p1.point.max(this.p2.point);this.svgNode.setAttributeNS(null,"x",min.x);this.svgNode.setAttributeNS(null,"y",min.y);this.svgNode.setAttributeNS(null,"width",max.x-min.x);this.svgNode.setAttributeNS(null,"height",max.y-min.y);};
Rectangle.prototype.registerHandles=function(){mouser.register(this.p1);mouser.register(this.p2);};
Rectangle.prototype.unregisterHandles=function(){mouser.unregister(this.p1);mouser.unregister(this.p2);};
Rectangle.prototype.selectHandles=function(select){this.p1.select(select);this.p2.select(select);};
Rectangle.prototype.showHandles=function(state){this.p1.show(state);this.p2.show(state);};
Rectangle.prototype.getIntersectionParams=function(){return new IntersectionParams("Rectangle",[this.p1.point,this.p2.point]);};

//--><!]]></script>
<script data-src="lib/Path.js" type="application/javascript"><!--//--><![CDATA[//><!--

//   Setup inheritance
Path.prototype             = new Shape();
Path.prototype.constructor = Path;
Path.superclass            = Shape.prototype;



//   Class constants

Path.COMMAND = 0;
Path.NUMBER  = 1;
Path.EOD     = 2;

Path.PARAMS = {
    A: [ "rx", "ry", "x-axis-rotation", "large-arc-flag", "sweep-flag", "x", "y" ],
    a: [ "rx", "ry", "x-axis-rotation", "large-arc-flag", "sweep-flag", "x", "y" ],
    C: [ "x1", "y1", "x2", "y2", "x", "y" ],
    c: [ "x1", "y1", "x2", "y2", "x", "y" ],
    H: [ "x" ],
    h: [ "x" ],
    L: [ "x", "y" ],
    l: [ "x", "y" ],
    M: [ "x", "y" ],
    m: [ "x", "y" ],
    Q: [ "x1", "y1", "x", "y" ],
    q: [ "x1", "y1", "x", "y" ],
    S: [ "x2", "y2", "x", "y" ],
    s: [ "x2", "y2", "x", "y" ],
    T: [ "x", "y" ],
    t: [ "x", "y" ],
    V: [ "y" ],
    v: [ "y" ],
    Z: [],
    z: []
};


/*****
*
*   constructor
*
*****/
function Path(svgNode) {
    if ( arguments.length > 0 ) {
        this.init(svgNode);
    }
}


/*****
*
*   init
*
*****/
Path.prototype.init = function(svgNode) {
    if ( svgNode == null || svgNode.localName != "path" )
        throw new Error("Path.init: Invalid localName: " + svgNode.localName);
    
    // Call superclass method
    Path.superclass.init.call(this, svgNode);
    
    // Convert path data to segments
    this.segments = null;
    this.parseData( svgNode.getAttributeNS(null, "d") );
};


/*****
*
*   realize
*
*****/
Path.prototype.realize = function() {
    for ( var i = 0; i < this.segments.length; i++ ) {
        this.segments[i].realize();
    }

    this.svgNode.addEventListener("mousedown", this, false);
};


/*****
*
*   unrealize
*
*****/
Path.prototype.unrealize = function() {
    for ( var i = 0; i < this.segments.length; i++ ) {
        this.segments[i].unrealize();
    }

    this.svgNode.removeEventListener("mousedown", this, false);
};



/*****
*
*   refresh
*
*****/
Path.prototype.refresh = function() {
    var d = new Array();

    for ( var i = 0; i < this.segments.length; i++ ) {
        d.push( this.segments[i].toString() );
    }

    this.svgNode.setAttributeNS(null, "d", d.join(" "));
};


/*****
*
*   registerHandles
*
*****/
Path.prototype.registerHandles = function() {
    for ( var i = 0; i < this.segments.length; i++ ) {
        this.segments[i].registerHandles();
    }
};


/*****
*
*   unregisterHandles
*
*****/
Path.prototype.unregisterHandles = function() {
    for ( var i = 0; i < this.segments.length; i++ ) {
        this.segments[i].unregisterHandles();
    }
};


/*****
*
*   selectHandles
*
*****/
Path.prototype.selectHandles = function(select) {
    for ( var i = 0; i < this.segments.length; i++ ) {
        this.segments[i].selectHandles(select);
    }
};


/*****
*
*   showHandles
*
*****/
Path.prototype.showHandles = function(state) {
    for ( var i = 0; i < this.segments.length; i++ ) {
        this.segments[i].showHandles(state);
    }
};


/*****
*
*   appendPathSegment
*
*****/
Path.prototype.appendPathSegment = function(segment) {
    segment.previous = this.segments[this.segments.length-1];

    this.segments.push(segment);
};


/*****
*
*   parseData
*
*****/
/* XXX BM. This function has been heavilly hacked to get elliptical arcs working XXX */

Path.prototype.parseData = function(d) {
    // convert path data to token array
    var tokens = this.tokenize(d);

    // point to first token in array
    var index = 0;

    // get the current token
    var token = tokens[index];

    // set mode to signify new path
    var mode = "BOD";

    // init segment array
    // NOTE: should destroy previous segment handles here
    this.segments = new Array();

    // Process all tokens
    while ( !token.typeis(Path.EOD) ) {
        var param_length;
        var params = new Array();

        if ( mode == "BOD" ) {
            // Start of new path.  Must be a moveto command
            if ( token.text == "M" || token.text == "m" ) {
                // Advance past command token
                index++;

                // Get count of numbers that must follow this command
                param_length = Path.PARAMS[token.text].length;

                // Set new parsing mode
                mode = token.text;
            } else {
                // Oops.  New path didn't start with a moveto command
                throw new Error("Path data must begin with a moveto command");
            }
        } else {
            // Currently in a path definition
            if ( token.typeis(Path.NUMBER) ) {
                // Many commands allow you to keep repeating parameters
                // without specifying the command again.  This handles
                // that case.
                param_length = Path.PARAMS[mode].length;
            } else {
                // Advance past command token
                index++; 

                // Get count of numbers that must follow this command
                param_length = Path.PARAMS[token.text].length;

                // Set new parsing mode
                mode = token.text;
            }
        }
        
        // Make sure we have enough tokens left to satisfy the number
        // of parameters we need for the last command
        if ( (index + param_length) < tokens.length ) {
            // Get each parameter
            for (var i = index; i < index + param_length; i++) {
                var number = tokens[i];
                
                // Make sure each parameter is a number.
                if ( number.typeis(Path.NUMBER) )
                    params[params.length] = number.text;
                else
                    throw new Error("Parameter type is not a number: " + mode + "," + number.text);
            }
            
            // NOTE: Should create add an appendPathSegment (careful, that
            // effects RelativePathSegments
            var segment;
            var length   = this.segments.length;
            var previous = ( length == 0 ) ? null : this.segments[length-1];
            switch (mode) {
                case "A":
                    var startPoint = previous.getLastPoint();
                    var x1 = startPoint.x;
                    var y1 = startPoint.y;
                    var bezier_param_list = arcToCurve.apply(this,[x1,y1].concat(params));
                    for (var i=0; i<bezier_param_list.length/6; i++) {
                        var bezier_params = new Array();
                        for (var j=0; j<6; j++) {
                            bezier_params.push(bezier_param_list.shift());
                        }
                        this.segments.push(new AbsoluteCurveto3(bezier_params, this, previous));
                        previous = this.segments[length-1];
                    }
                    break;

                case "C": this.segments.push(new AbsoluteCurveto3(       params, this, previous )); break;
                case "c": this.segments.push(new RelativeCurveto3(       params, this, previous )); break;
                case "H": this.segments.push(new AbsoluteHLineto(        params, this, previous )); break;
                case "L": this.segments.push(new AbsoluteLineto(         params, this, previous )); break;
                case "l": this.segments.push(new RelativeLineto(         params, this, previous )); break;
                case "M": this.segments.push(new AbsoluteMoveto(         params, this, previous )); break;
                case "m": this.segments.push(new RelativeMoveto(         params, this, previous )); break;
                case "Q": this.segments.push(new AbsoluteCurveto2(       params, this, previous )); break;
                case "q": this.segments.push(new RelativeCurveto2(       params, this, previous )); break;
                case "S": this.segments.push(new AbsoluteSmoothCurveto3( params, this, previous )); break;
                case "s": this.segments.push(new RelativeSmoothCurveto3( params, this, previous )); break;
                case "T": this.segments.push(new AbsoluteSmoothCurveto2( params, this, previous )); break;
                case "t": this.segments.push(new RelativeSmoothCurveto2( params, this, previous )); break;
                case "Z": this.segments.push(new RelativeClosePath(      params, this, previous )); break;
                case "z": this.segments.push(new RelativeClosePath(      params, this, previous )); break;
                default:
                    throw new Error("Unsupported segment type: " + mode);
            };

            // advance to the next unused token
            index += param_length;

            // get current token
            token = tokens[index];

            // Lineto's follow moveto when no command follows moveto params
            if ( mode == "M" ) mode = "L";
            if ( mode == "m" ) mode = "l";
        } else {
            throw new Error("Path data ended before all parameters were found");
        }
    }
}


/*****
*
*   tokenize
*
*   Need to add support for scientific notation
*
*****/
Path.prototype.tokenize = function(d) {
    var tokens = new Array();

    while ( d != "" ) {
        if ( d.match(/^([ \t\r\n,]+)/) )
        {
            d = d.substr(RegExp.$1.length);
        }
        else if ( d.match(/^([aAcChHlLmMqQsStTvVzZ])/) )
        {
            tokens[tokens.length] = new Token(Path.COMMAND, RegExp.$1);
            d = d.substr(RegExp.$1.length);
        }
        else if ( d.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/) )
        {
            tokens[tokens.length] = new Token(Path.NUMBER, parseFloat(RegExp.$1));
            d = d.substr(RegExp.$1.length);
        }
        else
        {
            throw new Error("Unrecognized segment command: " + d);
            //d = "";
        }
    }

    tokens[tokens.length] = new Token(Path.EOD, null);

    return tokens;
}


/*****
*
*   intersection methods
*
*****/

/*****
*
*   intersectShape
*
*****/
Path.prototype.intersectShape = function(shape) {
    var result = new Intersection("No Intersection");

    for ( var i = 0; i < this.segments.length; i++ ) {
        var inter = Intersection.intersectShapes(this.segments[i],shape);

        result.appendPoints(inter.points);
    }

    if ( result.points.length > 0 ) result.status = "Intersection";

    return result;
};


/*****
*
*   get/set methods
*
*****/

/*****
*
*   getIntersectionParams
*
*****/
Path.prototype.getIntersectionParams = function() {
    return new IntersectionParams(
        "Path",
        []
    );
};




function arcToCurve (x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {
    // for more information of where this math came from visit:
    // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes
    var _120 = Math.PI * 120 / 180,
        rad = Math.PI / 180 * (+angle || 0),
        res = [],
        xy,
        rotate = function (x, y, rad) {
            var X = x * Math.cos(rad) - y * Math.sin(rad),
                Y = x * Math.sin(rad) + y * Math.cos(rad);
            return {x: X, y: Y};
        },
        f1, f2,
        cx, cy;
    if (!recursive) {
        xy = rotate(x1, y1, -rad);
        x1 = xy.x;
        y1 = xy.y;
        xy = rotate(x2, y2, -rad);
        x2 = xy.x;
        y2 = xy.y;
        var cos = Math.cos(Math.PI / 180 * angle),
            sin = Math.sin(Math.PI / 180 * angle),
            x = (x1 - x2) / 2,
            y = (y1 - y2) / 2;
        var h = (x * x) / (rx * rx) + (y * y) / (ry * ry);
        if (h > 1) {
            h = Math.sqrt(h);
            rx = h * rx;
            ry = h * ry;
        }
        var rx2 = rx * rx,
            ry2 = ry * ry,
            k = (large_arc_flag == sweep_flag ? -1 : 1) *
                Math.sqrt(Math.abs((rx2 * ry2 - rx2 * y * y - ry2 * x * x) / (rx2 * y * y + ry2 * x * x)));

        cx = k * rx * y / ry + (x1 + x2) / 2;
        cy = k * -ry * x / rx + (y1 + y2) / 2;

        f1 = Math.asin(((y1 - cy) / ry).toFixed(9));
        f2 = Math.asin(((y2 - cy) / ry).toFixed(9));
        f1 = x1 < cx ? Math.PI - f1 : f1;
        f2 = x2 < cx ? Math.PI - f2 : f2;
//        f1 < 0 && (f1 = Math.PI * 2 + f1);
        f1 = f1 < 0 ? Math.PI * 2 + f1 : f1;
        f2 = f2 < 0 ? Math.PI * 2 + f2 : f2;
        if (sweep_flag && f1 > f2) {
            f1 = f1 - Math.PI * 2;
        }
        if (!sweep_flag && f2 > f1) {
            f2 = f2 - Math.PI * 2;
        }
    } else {
        f1 = recursive[0];
        f2 = recursive[1];
        cx = recursive[2];
        cy = recursive[3];
    }
    var df = f2 - f1;
    if (Math.abs(df) > _120) {
        var f2old = f2,
            x2old = x2,
            y2old = y2;
        f2 = f1 + _120 * (sweep_flag && f2 > f1 ? 1 : -1);
        x2 = cx + rx * Math.cos(f2);
        y2 = cy + ry * Math.sin(f2);
        res = arcToCurve(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [f2, f2old, cx, cy]);
    }
    df = f2 - f1;
    var c1 = Math.cos(f1),
        s1 = Math.sin(f1),
        c2 = Math.cos(f2),
        s2 = Math.sin(f2),
        t = Math.tan(df / 4),
        hx = 4 / 3 * rx * t,
        hy = 4 / 3 * ry * t,
        m1 = [x1, y1],
        m2 = [x1 + hx * s1, y1 - hy * c1],
        m3 = [x2 + hx * s2, y2 - hy * c2],
        m4 = [x2, y2];
    m2[0] = 2 * m1[0] - m2[0];
    m2[1] = 2 * m1[1] - m2[1];
    if (recursive) {
        return [m2, m3, m4].concat(res);
    } else {
        res = [m2, m3, m4].concat(res).join().split(",");
        var newres = [];
        for (var i = 0, ii = res.length; i < ii; i++) {
            newres[i] = i % 2 ? rotate(res[i - 1], res[i], rad).y : rotate(res[i], res[i + 1], rad).x;
        }
        return newres;
    }
}

//--><!]]></script>
<!-- Game files -->
<script data-src="src/base.js" type="application/javascript"><!--//--><![CDATA[//><!--
// Namespace
var MG = {};

//==============================================================================
// Constants
//==============================================================================

NAMESPACE_SVG   = 'http://www.w3.org/2000/svg';
NAMESPACE_XLINK = 'http://www.w3.org/1999/xlink';

//

MG.BARRIERS_ROOT_ELEMENT_ID  = 'barriers';
MG.HUD_ROOT_ELEMENT_ID       = 'hud';
MG.MENU_ROOT_ELEMENT_ID      = 'menu';

MG.BARRIER_SPACING = 650.0;
MG.TUNNEL_RADIUS = 100;
MG.MISSILE_LENGTH = 50.0;

MG.LINE_OF_SIGHT = 1600.0;
MG.FIELD_OF_VIEW = 60.0;
MG.PROJECTION_PLANE_DISTANCE = 100;

//--><!]]></script>
<script data-src="src/util.js" type="application/javascript"><!--//--><![CDATA[//><!--
//==============================================================================
// Utility Functions
//==============================================================================

MG.util = {} ;

MG.util.hideMouse = function () {
    var i;
    for (i=0; i<document.styleSheets.length; i++) {
        var styleSheet = document.styleSheets[i];

        if (styleSheet.title === 'style-hide-mouse') {
            styleSheet.disabled = false;
        }
    }
};

MG.util.showMouse = function () {
    var i;
    for (i=0; i<document.styleSheets.length; i++) {
        var styleSheet = document.styleSheets[i];

        if (styleSheet.title === 'style-hide-mouse') {
            styleSheet.disabled = true;
        }
    }
};

//--><!]]></script>
<script data-src="src/missile.js" type="application/javascript"><!--//--><![CDATA[//><!--
MG.missile = (function () {

    var ACCELERATION_TIME_CONSTANT = 1.0;
    var DRIFT_DAMPING = 0.25;

    var MAX_RADIUS = 0.8*MG.TUNNEL_RADIUS;

    var MissileState = {
        CRASHED:   'crashed',
        AUTOPILOT: 'autopilot',
        MANUAL:    'manual'
    }

    var mState;

    var mOffset;
    var mVelocity;
    var mTargetVelocity;

    var mX;
    var mY;

    var mTargetX;
    var mTargetY;

    var mDriftVelX;
    var mDriftVelY;
    var mDriftCounter;


    return {
        init: function () {
            this.reset();
        },


        reset: function (){
            mState = MissileState.AUTOPILOT;

            mOffset = 200.0;
            mVelocity = 0.0;
            mTargetVelocity = 400.0;

            mX = 0.0;
            mY = 0.0;

            mTargetX = 0.0;
            mTargetY = 0.0;

            mDriftVelX = 0.0;
            mDriftVelY = 0.0;
            mDriftCounter = 1.0;

        },


        update: function (dt) {

            switch (mState) {
                case MissileState.AUTOPILOT:
                    /* When under autopilot control, the missile will randomly
                    drift around the center of the tunnel, changing direction at
                    discrete intervals. */
                    /* The drift counter contains the time until the next direction change. */
                    mDriftCounter -= dt;
                    if (mDriftCounter < 0) {
                        mDriftCounter = 1.1 + 0.9*Math.random();

                        mDriftVelX = (MG.TUNNEL_RADIUS*(Math.random()-0.5) - mTargetX)/1.5;
                        mDriftVelY = (MG.TUNNEL_RADIUS*(Math.random()-0.5) - mTargetY)/1.5;
                    }

                    /* TODO Smooth */
                    mX += mDriftVelX * dt ;
                    mY += mDriftVelY * dt ;

                    break;

                case MissileState.MANUAL:
                    mX += (mTargetX - mX) * dt / DRIFT_DAMPING;
                    mY += (mTargetY - mY) * dt / DRIFT_DAMPING;
                    break;

                default:
                    /* leave the missile pointing in the same direction */
            }

            /* Clamp the missile's position to inside the tunnel wall */
            var radius = Math.sqrt(mX*mX + mY*mY);
            var newRadius = Math.min(MAX_RADIUS, radius);

            mX = (radius === 0) ? 0 : mX*newRadius/radius;
            mY = (radius === 0) ? 0 : mY*newRadius/radius;



            if (mState === MissileState.CRASHED) {
                /* If the missile has crashed, it will bounce backwards coming
                to rest near the location of the previous barrier. */
                mVelocity += dt*MG.BARRIER_SPACING*mVelocity/(mOffset - MG.BARRIER_SPACING);
            } else {
                mVelocity += dt*(mTargetVelocity - mVelocity)/ACCELERATION_TIME_CONSTANT;
            }

            mOffset -= mVelocity * dt;
        },

        getPosition: function () {
            return {x: mX, y:mY};
        },

        getTarget: function () {
            return {x: mTargetX, y:mTargetY};
        },

        getOffset: function () {
            return mOffset;
        },

        getVelocity: function () {
            return mVelocity;
        },

        isCrashed: function () {
            return mState == MissileState.CRASHED;
        },

        setTarget: function (targetX, targetY) {
            if (mState === MissileState.MANUAL) {
                mTargetX = targetX;
                mTargetY = targetY;
            }
        },

        setVelocity: function (velocity) {
            mTargetVelocity = velocity;
        },


        setManual: function () {
            mState = MissileState.MANUAL;
        },

        setAutopilot: function () {
            mState = MissileState.AUTOPILOT;
        },


        onBarrierPassed: function () {
            mOffset += MG.BARRIER_SPACING;
        },

        onCrash: function () {
            mVelocity = -Math.abs(mVelocity);

            mState = MissileState.CRASHED;
        }
    };
}());

//--><!]]></script>
<script data-src="src/wall.js" type="application/javascript"><!--//--><![CDATA[//><!--
MG.tunnelWall = (function (rootNode) {
    var DTHETA = 20;
    var NUM_SEGMENTS = 5;

    var NEAR_CLIPPING_PLANE = 25;

    var GRADIENT_START = MG.LINE_OF_SIGHT;
    var GRADIENT_STOP  = GRADIENT_START - MG.BARRIER_SPACING;


    var mTheta = 0;

    var mSegments = [];

    return {
        init: function (rootNode) {

            var gradient = document.createElementNS(NAMESPACE_SVG, 'linearGradient');
            gradient.id = 'tunnel-wall-segment-fade-gradient';
            gradient.setAttribute('gradientUnits', 'userSpaceOnUse');
            rootNode.appendChild(gradient);

            var gradientStart = document.createElementNS(NAMESPACE_SVG, 'stop');
            gradientStart.setAttribute('offset', (5*NEAR_CLIPPING_PLANE / GRADIENT_START) + '');
            gradientStart.setAttribute('stop-color', '#fff');
            gradient.appendChild(gradientStart);

            var gradientStop = document.createElementNS(NAMESPACE_SVG, 'stop');
            gradientStop.setAttribute('offset', (5*NEAR_CLIPPING_PLANE / GRADIENT_STOP) + '');
            gradientStop.setAttribute('stop-color', '#000');
            gradient.appendChild(gradientStop);

            for (var i=0; i < NUM_SEGMENTS; i++) {

                mSegments[i] = document.createElementNS(NAMESPACE_SVG, 'path');
                mSegments[i].setAttribute('class', 'wall-segment-dark');
                mSegments[i].setAttribute('d', 'M 0,0 l 1000,50 l 0,-50 z');

                mSegments[i].setAttribute('fill', 'url(#tunnel-wall-segment-fade-gradient)');


                rootNode.appendChild(mSegments[i]) ;
            }

            this.updateDOM(0,0,0);
        },

        update: function (dt) {
            mTheta = mTheta + dt * DTHETA;
            mTheta %= 360;
        },

        updateDOM: function (x, y, offset) {

            for (var i=0; i<NUM_SEGMENTS; i++) {
                var segmentTheta = mTheta + 360*i/NUM_SEGMENTS;

                var x_ = -x * Math.cos(segmentTheta*Math.PI/180) + -y * Math.sin(segmentTheta*Math.PI/180);
                var y_ = -x * Math.sin(segmentTheta*Math.PI/180) +  y * Math.cos(segmentTheta*Math.PI/180);

                var scale_x_ = 0.1*MG.PROJECTION_PLANE_DISTANCE * (1 - x_/MG.TUNNEL_RADIUS)
                             / (Math.tan(Math.PI * MG.FIELD_OF_VIEW/360.0)*NEAR_CLIPPING_PLANE);
                var scale_y_ = 0.1*MG.PROJECTION_PLANE_DISTANCE
                             / (Math.tan(Math.PI * MG.FIELD_OF_VIEW/360.0)*NEAR_CLIPPING_PLANE);

                var skew = 180*Math.atan(y_/MG.TUNNEL_RADIUS)/Math.PI;

                mSegments[i].setAttribute('transform', 'rotate(' + segmentTheta + ') '
                                                     + 'scale(' + scale_x_ + ',' + scale_y_ + ') '
                                                     + 'skewY(' + skew + ')' );



            }
        }
    }
}());

//--><!]]></script>
<script data-src="src/barrier.js" type="application/javascript"><!--//--><![CDATA[//><!--
MG.BarrierType = {
    RANDOM: 'random',

    BARRIER_1: 1,
    BARRIER_2: 2,
    BARRIER_3: 3,
    BARRIER_4: 4,
    BARRIER_5: 5,
    BARRIER_6: 6,

    BLANK: 'blank',
    START: 'start',
    FINISH: 'finish'
};
MG.NUM_RANDOM_BARRIERS = 6;

/* TODO find nicer way of initalising MG.BARRIER_PATH_IDS */
MG.BARRIER_PATH_IDS = {}
MG.BARRIER_PATH_IDS[MG.BarrierType.RANDOM] = '';
MG.BARRIER_PATH_IDS[MG.BarrierType.BARRIER_1] = 'barrier-path-1';
MG.BARRIER_PATH_IDS[MG.BarrierType.BARRIER_2] = 'barrier-path-2';
MG.BARRIER_PATH_IDS[MG.BarrierType.BARRIER_3] = 'barrier-path-3';
MG.BARRIER_PATH_IDS[MG.BarrierType.BARRIER_4] = 'barrier-path-4';
MG.BARRIER_PATH_IDS[MG.BarrierType.BARRIER_5] = 'barrier-path-5';
MG.BARRIER_PATH_IDS[MG.BarrierType.BARRIER_6] = 'barrier-path-6';
MG.BARRIER_PATH_IDS[MG.BarrierType.BLANK] = 'barrier-path-blank';
MG.BARRIER_PATH_IDS[MG.BarrierType.START] = 'barrier-path-blank';
MG.BARRIER_PATH_IDS[MG.BarrierType.FINISH] = 'barrier-path-finish';

MG.Barrier = function (type) {
    if (type === undefined) {type = MG.BarrierType.RANDOM;}

    var mIsInitialised = false;

    var mTheta = 0.0;
    var mDTheta = 300.0*(0.5 - Math.random());

    var mIsRandom = (type === MG.BarrierType.RANDOM);
    var mType = (type === MG.BarrierType.RANDOM) ? Math.ceil(MG.NUM_RANDOM_BARRIERS*Math.random()) : type;

    var mRootNode;
    var mFrontPath;
    var mBackPath;

    this.init = function () {

        mRootNode = document.createElementNS(NAMESPACE_SVG, 'g');

        /* The path representing the face nearest the camera */
        mFrontPath = document.getElementById(MG.BARRIER_PATH_IDS[mType]).cloneNode(true);
        mFrontPath.setAttribute('class', 'barrier-path-front');

        /* The path partially obscured by the front path, added to give the illusion of thickness. */
        mBackPath = document.getElementById(MG.BARRIER_PATH_IDS[mType]).cloneNode(true);
        mBackPath.setAttribute('class', 'barrier-path-back');

        mRootNode.setAttribute('class', 'barrier');
        mRootNode.appendChild(mBackPath);
        mRootNode.appendChild(mFrontPath);

        mIsInitialised = true;
    };

    this.destroy = function () {
        mRootNode.parentNode.removeChild(mRootNode);
    };

    /**
     * Checks whether the point specified by x and y will collide with the barrier.
     * Works by counting the number of intersections between the path outlining the
     * barrier and a line between some point outside of the barrier, and the point
     * that is being tested.
     * Returns true if the point intersects the transformed barrier, false otherwise.
     */
    this.collides = function (x, y) {
        /* transform the provided coordinates to the coordinate system of the barrier */
        var x_ =    x * Math.cos(mTheta*Math.PI/180) + y * Math.sin(mTheta*Math.PI/180);
        var y_ = -x * Math.sin(mTheta*Math.PI/180) + y * Math.cos(mTheta*Math.PI/180);

        /* the line to be used for finding the intersections should already exist
        but needs to be made to the point to the point that is to be tested */
        var lineNode = document.getElementById('collision-line');
        lineNode.setAttribute('x2', x_);
        lineNode.setAttribute('y2', y_);

        /* As the barriers path may not have been created yet, the original path is used */
        var pathNode = document.getElementById(MG.BARRIER_PATH_IDS[mType]);


        /* `Line` and `Path` are both part of Kevin Lindsey's svg geometry library. */
        /* `Path` has been hacked to properly support elliptical arc segments. */
        var line = new Line(lineNode);
        var path = new Path(pathNode);

        var intersections = new Intersection.intersectShapes(path, line);

        return intersections.points.length % 2 === 1;
    };

    this.update = function (dt) {
        mTheta += mDTheta * dt;
    };

    /**
     * Updates the barriers representation in the DOM to reflect changes made at
     * the last update.
     * `x` and `y` define the position of the viewpoint.
     * `offset` is the distance of the barrier from the viewpoint.
     */
    this.updateDOM = function (x, y, offset) {
        var frontScale = MG.PROJECTION_PLANE_DISTANCE / 
                (Math.tan(Math.PI * MG.FIELD_OF_VIEW/360.0)*(offset));

        var backScale    = MG.PROJECTION_PLANE_DISTANCE /
                (Math.tan(Math.PI * MG.FIELD_OF_VIEW/360.0)*(offset + 10));

        mFrontPath.setAttribute('transform',
                'scale(' + frontScale + ') translate(' + x    + ',' + y + ') rotate(' + mTheta + ')');
        mBackPath.setAttribute('transform',
                'scale(' + backScale + ') translate(' + x    + ',' + y + ') rotate(' + mTheta + ')');

        offset = Math.max(MG.LINE_OF_SIGHT - MG.BARRIER_SPACING ,Math.min(MG.LINE_OF_SIGHT,offset));
        var fog = 100 -100*(MG.LINE_OF_SIGHT - offset)/MG.BARRIER_SPACING;

        mFrontPath.setAttribute('fill',   'rgb('+(100+fog)+'%,'
                                                +(100+fog)+'%,'
                                                +(100+fog)+'%)');
        mBackPath.setAttribute('fill',    'rgb(' +(60+fog)+'%,'
                                                 +(60+fog)+'%,'
                                                 +(60+fog)+'%)');
        mFrontPath.setAttribute('stroke', 'rgb('  +(0+fog)+'%,'
                                                  +(0+fog)+'%,'
                                                  +(0+fog)+'%)');
        mBackPath.setAttribute('stroke',  'rgb('  +(0+fog)+'%,'
                                                  +(0+fog)+'%,'
                                                  +(0+fog)+'%)');
    };

    this.getType = function () {
        return mType;
    };

    this.isRandom = function () {
        return mIsRandom;
    };

    this.isInitialised = function () {
        return mIsInitialised;
    };

    this.getRootNode = function () {
        return mRootNode;
    };

};

//--><!]]></script>
<script data-src="src/barrierQueue.js" type="application/javascript"><!--//--><![CDATA[//><!--
MG.barrierQueue = (function () {
    var mBarrierQueue = [];
    var mRootNode;

    var mFirstBarrierIndex = 0;

    return {
        init: function (rootNode) {
            mRootNode = rootNode;
        },

        update: function (dt) {
            var i;

            /* iterate through and update each of the barriers in the queue */
            for (i = mFirstBarrierIndex; i < mBarrierQueue.length; i++) {
                mBarrierQueue[i].update(dt);
            }
        },

        updateDOM: function (missileX, missileY, missileOffset) {
            var i;

            /* Remove any barriers that have been queued for deletion */
            while (mFirstBarrierIndex > 0) {
                mBarrierQueue[0].destroy();
                mBarrierQueue.shift();
                mFirstBarrierIndex --;
            }

            /* Initialise any uninitialised barriers and add them behind the ones already there. */
            for (i = 0; i < mBarrierQueue.length; i++) {
                var barrier = mBarrierQueue[i];

                if (!barrier.isInitialised()) {
                    barrier.init();

                    if (i > 0) {
                        mRootNode.insertBefore(barrier.getRootNode(), mBarrierQueue[i-1].getRootNode());
                    } else {
                        mRootNode.appendChild(barrier.getRootNode());
                    }
                }
            }

            var z = 0.0;
            for (i = 0; i < mBarrierQueue.length; i++) {
                mBarrierQueue[i].updateDOM(missileX, missileY, z + missileOffset);
                z += MG.BARRIER_SPACING;
            }
        },

        /**
         * Adds a new barrier to the end of the queue.
         * The starting angle and angular rate are randomized.
         */
        pushBarrier: function (type) {
            /* Create a new barrier but do not initialise it */
            var barrier = new MG.Barrier(type);

            /* Add the barrier to the internal list */
            mBarrierQueue[mBarrierQueue.length] = barrier;

        },

        /**
         * Pops the barrier closest to the missile.
         */
        popBarrier: function () {
            mFirstBarrierIndex++;
            mFirstBarrierIndex = Math.min(mFirstBarrierIndex, mBarrierQueue.length);
        },

        /**
         * Returns a reference to the barrier at the front of the queue.
         */
        nextBarrier: function () {
            return mBarrierQueue[mFirstBarrierIndex];
        },

        /**
         * Deletes all barriers and returns the queue to it's original, empty state.
         */
        reset: function () {
            while (mFirstBarrierIndex < mBarrierQueue.length) {
                this.popBarrier();
            }
        },

        /**
         * Returns true if there are no barriers queued.
         */
        isEmpty: function () {
            return this.nextBarrier() === undefined;
        },


        /**
         * Returns the number of barriers in the queue that have not been marked for deletion.
         */
        numBarriers: function () {
            return mBarrierQueue.length - mFirstBarrierIndex;
        }
    };
}());

//--><!]]></script>
<script data-src="src/game.js" type="application/javascript"><!--//--><![CDATA[//><!--
MG.game = (function () {
    /** Constants **/
    var GameState = {
        WAIT_START: 'wait_start',
        STARTING:   'starting',
        RUNNING:    'running',
        FINISHED:   'finished',
        CRASHED:    'crashed'
    }

    var STARTING_LIVES = 5;

    var LEVEL_NUM_BARRIERS = 20;

    /** Variables **/
    var mState = GameState.WAIT_START;

    var mLives = STARTING_LIVES;
    var mLevel = 0;

    var mRemainingBarriers = 0;
    var mBarriersToPass = 0;

    var mProgress = 0.0;
    var mBestProgress = 0.0;

    /* Strings for UI ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
    var getLevelString = function () {
        return mLevel ? 'LEVEL ' + mLevel : 'QUALIFYING LEVEL';
    }

    var Messages = {
        START: {
            title: getLevelString,
            text:  function () {return 'CLICK TO BEGIN';}
        },
        CRASH: {
            title: function () {return 'CRASHED';},
            text:  function () {return 'CLICK TO RETRY';}
        },
        GAME_OVER: {
            title: function () {return 'GAME OVER';},
            text:  function () {return 'CLICK TO START AGAIN';}
        },
        FINISH: {
            title: function () {return 'LEVEL COMPLETED';},
            text:  function () {return 'CLICK TO CONTINUE';}
        }
    };



    var getLevelStartVelocity   = function (level) {
        return 300 + 100*level;
    }

    var getLevelFinishVelocity  = function (level) {
        return 400 + 100*level;
    }

    var getPreLevelIdleVelocity = function (level) {
        return 350 + 100*level;
    }

    var getPostLevelIdleVelocity = function (level) {
        return 550 + 100*level;
    }

    var playCrashAnimation = function () {
        // TODO move drawing out of the update loop

        // create a copy of the explosion element
        var explosion = document.getElementById('explosion');

        // play the animation
        explosion.firstChild.beginElement();
        explosion.setAttribute('visibility', 'visible');

        // TODO can't seem to get a callback to fire when the animation
        // finishes. Use timeout instead
        setTimeout(function (){
            var explosion = document.getElementById('explosion');
            explosion.setAttribute('visibility', 'hidden');
        }, 400);
    }

    var goWaitStartLevel = function () {
        MG.banner.show(Messages.START.title(), Messages.START.text());
        MG.util.showMouse();

        MG.missile.setAutopilot();
        MG.missile.setVelocity(getPreLevelIdleVelocity(mLevel));

        if (mLevel === 0) {mLives = Infinity;}

        mState = GameState.WAIT_START;
    }

    /**
     *
     */
    var goRun = function () {
        MG.banner.hide();
        MG.util.hideMouse();

        /* TODO should the start barrier be pushed here?
        If so, should all of the barriers for the entire level be pushed as well? */
        mRemainingBarriers = LEVEL_NUM_BARRIERS;
        MG.barrierQueue.pushBarrier(MG.BarrierType.START);

        mBarriersToPass = LEVEL_NUM_BARRIERS;

        MG.missile.setManual();

        mState = GameState.STARTING;
    }

    var goFinish = function () {
        MG.banner.show(Messages.FINISH.title(), Messages.FINISH.text());
        MG.util.showMouse();

        MG.missile.setAutopilot();
        MG.missile.setVelocity(getPostLevelIdleVelocity(mLevel));

        mState = GameState.FINISHED;
    }

    var goCrash = function () {
        MG.util.showMouse();

        if (mLives === 0) {
            MG.banner.show(Messages.GAME_OVER.title(), Messages.GAME_OVER.text());
        } else {
            MG.banner.show(Messages.CRASH.title(), Messages.CRASH.text());
        }

        playCrashAnimation()

        mState = GameState.CRASHED;

    }


    //==========================================================================

    return {
        init: function () {
            var rootNode = document.getElementById('tunnel');

            MG.missile.init();

            //

            var wallNode;

            wallNode = document.createElementNS(NAMESPACE_SVG, 'g');
            wallNode.setAttribute('transform', 'scale(1,-1)');

            MG.tunnelWall.init(wallNode);

            rootNode.appendChild(wallNode);

            //

            var barrierQueueNode;

            barrierQueueNode = document.createElementNS(NAMESPACE_SVG, 'g');
            barrierQueueNode.setAttribute('transform', 'scale(1,-1)');

            MG.barrierQueue.init(barrierQueueNode);

            rootNode.appendChild(barrierQueueNode);

            //

            goWaitStartLevel();

            rootNode.setAttribute('visibility', 'visible');
        },


        update: function (dt) {
            MG.missile.update(dt);    
            MG.tunnelWall.update(dt);
            MG.barrierQueue.update(dt);    

            /* check whether the nearest barrier has been reached and whether the missile collides with it. */
            if (!MG.barrierQueue.isEmpty()) {
                if (MG.missile.getOffset() < MG.MISSILE_LENGTH && !MG.missile.isCrashed()){
                    var barrier = MG.barrierQueue.nextBarrier();

                    if (barrier.collides(MG.missile.getPosition().x, MG.missile.getPosition().y)) {
                        // CRASH
                        MG.missile.onCrash();
                        goCrash();
                    } else {

                        // BARRIER PASSED
                        MG.barrierQueue.popBarrier();
                        MG.missile.onBarrierPassed();

                        // TODO this block makes loads of assumptions about state
                        if (mState === GameState.RUNNING
                         || mState === GameState.STARTING) {
                            switch(barrier.getType()) {
                              case MG.BarrierType.FINISH:
                                goFinish();
                                break;
                              case MG.BarrierType.BLANK:
                                break;
                              case MG.BarrierType.START:
                                mState = GameState.RUNNING;
                                // FALLTHROUGH
                              default:
                                mBarriersToPass--;

                                var startVelocity = getLevelStartVelocity(mLevel);
                                var finishVelocity = getLevelFinishVelocity(mLevel);

                                MG.missile.setVelocity(startVelocity
                                                         + (startVelocity - finishVelocity)
                                                           * (mBarriersToPass - LEVEL_NUM_BARRIERS)
                                                             / LEVEL_NUM_BARRIERS);
                                break;
                            }
                        }
                    }
                }    
            }

        
            /* Pad the barrier queue with blank barriers so that there are barriers
            as far as can be seen. */
            while (MG.barrierQueue.numBarriers() < MG.LINE_OF_SIGHT/MG.BARRIER_SPACING) {
                var type = MG.BarrierType.BLANK;
    
                if (mState === GameState.RUNNING
                 || mState === GameState.STARTING) {
                    mRemainingBarriers--;
                    if (mRemainingBarriers > 0) {
                        type = MG.BarrierType.RANDOM;
                    } else if (mRemainingBarriers === 0) {
                        type = MG.BarrierType.FINISH;
                    } else {
                        type = MG.BarrierType.BLANK;
                    }
                }
    
                MG.barrierQueue.pushBarrier(type);
            }

            /* Update progress */
            switch (mState) {
              case GameState.RUNNING:
                mProgress = 1 - (mBarriersToPass*MG.BARRIER_SPACING + MG.missile.getOffset())/(LEVEL_NUM_BARRIERS * MG.BARRIER_SPACING);
                mBestProgress = Math.max(mProgress, mBestProgress);
                break;
              case GameState.FINISHED:
                mProgress = 1;
                mBestProgress = 1;
                break;
              case GameState.STARTING:
                mProgress = 0;
                break;
              default:
                break;
            }

        },

        updateDOM: function () {
            var position = MG.missile.getPosition();
            var offset = MG.missile.getOffset();

            MG.barrierQueue.updateDOM(-position.x, -position.y, offset);
            MG.tunnelWall.updateDOM(-position.x, -position.y, offset);
        },

        onMouseMove: function (x, y) {
            var windowWidth = window.innerWidth;
            var windowHeight = window.innerHeight;

            MG.missile.setTarget(x - 0.5*windowWidth, -(y - 0.5*windowHeight));

        },

        onMouseClick: function () {
            if (MG.banner.isFullyVisible()) {
                switch (mState) {
                  case GameState.WAIT_START:
                    goRun();
                    break;
                  case GameState.FINISHED:
                    /* The player is given an infinite number of lives
                    during the qualifying level but these should be
                    removed before continuing. */
                    if (mLevel === 0) {mLives = STARTING_LIVES;}

                    mLevel++;

                    mBestProgress = 0.0;

                    goWaitStartLevel();
                    break;
                  case GameState.CRASHED:
                    MG.banner.hide();
                    MG.fog.fadeIn(function() {
                            if (mLives === 0) {
                                mLevel = 0;
                                mLives = STARTING_LIVES;
                                mBestProgress = 0.0;
                            } else {
                                mLives--;
                            }


                            MG.missile.reset();
                            MG.barrierQueue.reset();

                            MG.fog.fadeOut();
                            goWaitStartLevel();
                        });
                    break;
                }
            }
        },

        /* Returns an integer representing the current level */
        getLevel: function () {
            return mLevel;
        },

        /* Returns a human readable string describing the current level */
        getLevelString: getLevelString,

        /* Returns the number of times the player can crash before game over. */
        /* If the player crashes with zero lives remaining the game ends */
        getNumLives: function () {
            return mLives;
        },

        /* Returns the progress through the level as a value between 0 and 1,
        where 0 is not yet started and 1 is completed. */
        getProgress: function () {
            return mProgress;       
        },

        getBestProgress: function () {
            return mBestProgress;
        }
    };

}());

//--><!]]></script>
<script data-src="src/hud.js" type="application/javascript"><!--//--><![CDATA[//><!--
MG.hud = (function () {
    var mRootNode;

    var mRadar;
    var mSpeedometer;
    var mLevelIndicator;
    var mProgressIndicator;
    var mLifeCounter;

    return {

        init: function () {
            mRootNode = document.getElementById('hud');

            // ----------------------------------------------------------- Radar

            mRadar = (function () {
                var mMissilePositionDot = document.getElementById('hud-radar-scope-missile');
                var mMissileTargetDot = document.getElementById('hud-radar-scope-missile-target');

                var mMissileTarget = {x: 0.0, y: 0.0};
                var mMissilePosition = {x: 0.0, y: 0.0};

                return {
                    update: function (dt) {
                        mMissileTarget = MG.missile.getTarget();
                        mMissilePosition = MG.missile.getPosition();
                        // PASS
                    },
                    updateDOM: function () {
                        var x,y;
                        var scopeRadius = 0.5;

                        /* Set the position of the dot indicating the intended target of the missile */
                        x = scopeRadius + 0.95 * scopeRadius * mMissileTarget.x
                                               / MG.TUNNEL_RADIUS;
                        y = scopeRadius + 0.95 * scopeRadius * mMissileTarget.y
                                               / MG.TUNNEL_RADIUS;

                        mMissileTargetDot.setAttribute('cx', String(x));
                        mMissileTargetDot.setAttribute('cy', String(y));

                        /* Set the position of the dot indicating the actual position of the missile */
                        x = scopeRadius + 0.95 * scopeRadius * mMissilePosition.x
                                               / MG.TUNNEL_RADIUS;
                        y = scopeRadius + 0.95 * scopeRadius * mMissilePosition.y
                                               / MG.TUNNEL_RADIUS;

                        mMissilePositionDot.setAttribute('cx', String(x));
                        mMissilePositionDot.setAttribute('cy', String(y));
                    }
                };
            }());



            // ----------------------------------------------------- Speedometer

            mSpeedometer = (function () {
                var mBarNode = document.getElementById('hud-speedometer-bar');

                var mTextNode = document.createTextNode('');
                document.getElementById('hud-speedometer-speed-text').appendChild(mTextNode);
            
                var mSpeed = 0.0;

                return {
                    update: function (dt) {
                        mSpeed = MG.missile.getVelocity();
                    },
                    updateDOM: function () {
                        mTextNode.data = mSpeed.toFixed(0);
                        
                        // TODO (possibly) work out the maximum speed properly and put a cap on the level with a nice victory screen
                        mBarNode.setAttribute('x', mSpeed/2000 - 1);
                    }
                };
            } ());

            // ------------------------------------------------- Level Indicator
            mLevelIndicator = (function () {
                var mTextNode = document.createTextNode('');
                document.getElementById('hud-level-indicator').appendChild(mTextNode);

                return {
                    update: function (dt) {
                    // PASS
                    },

                    updateDOM: function () {
                        mTextNode.data = MG.game.getLevelString();
                    }
                };
            } ());

            // ---------------------------------------------- Progress Indicator
            mProgressIndicator = (function () {
                var mProgressMarkNode = document.getElementById('hud-progress-indicator-progress');
                var mBestProgressMarkNode = document.getElementById('hud-progress-indicator-best-progress');

                var mProgress = 0.0;
                var mBestProgress = 0.0;

                return {
                    update: function (dt) {
                        mProgress = MG.game.getProgress();
                        mBestProgress = MG.game.getBestProgress();
                    },

                    updateDOM: function () {
                        mProgressMarkNode.setAttribute('transform', 'translate(0,'+mProgress+')');
                        mBestProgressMarkNode.setAttribute('transform', 'translate(0,'+mBestProgress+')');
                    }
                };
            } ());
            // ---------------------------------------------------- Life Counter

            mLifeCounter = (function () {
                var i;

                var mInfiniteLivesNode = document.getElementById('hud-lives-indicator-infinite');
                var mZeroLivesNode = document.getElementById('hud-lives-indicator-none');

                var mLivesNodes = [];
                for (i=0; i<5; i++) {
                    mLivesNodes[i] = document.getElementById('hud-lives-indicator-missile-' + (i+1));
                }

                var mLives = -1;

                return {
                    update: function (dt) {
                        mLives = MG.game.getNumLives();
                    },

                    updateDOM: function () {
                        var i;

                        switch (mLives) {
                          case Infinity:
                            mInfiniteLivesNode.setAttribute('visibility', 'visible');
                            mZeroLivesNode.setAttribute('visibility', 'hidden');

                            for (i=0; i<5; i++) {
                                mLivesNodes[i].setAttribute('visibility', 'hidden');
                            }
                            break;
                          case 0:
                            mInfiniteLivesNode.setAttribute('visibility', 'hidden');
                            mZeroLivesNode.setAttribute('visibility', 'visible');

                            for (i=0; i<5; i++) {
                                mLivesNodes[i].setAttribute('visibility', 'hidden');
                            }
                            break;
                          default:
                            mInfiniteLivesNode.setAttribute('visibility', 'hidden');
                            mZeroLivesNode.setAttribute('visibility', 'hidden');

                            for (i=0; i<5; i++) {
                                mLivesNodes[i].setAttribute('visibility', i<mLives ? 'visible' : 'hidden');
                            }
                            break;
                        }
                    }
                };
            } ());

            // --------------------------------------------- Framerate Indicator
            mFrameRateIndicator = (function () {
                var mTextNode = document.createTextNode('');
                document.getElementById('hud-frame-rate-indicator').appendChild(mTextNode);

                var mFrameRate = 0

                return {
                    update: function (dt) {
                        if (dt === 0) {
                            return;
                        }

                        if (mFrameRate <= 0) {
                            /* Assume game has just started and use first time
                            step as an initial guess for the frame rate */
                            mFrameRate = 1/dt ;
                        } else {
                            /* Smooth out the frame rate readings over a number of frames */
                            mFrameRate = 0.99*mFrameRate + 0.01/dt;
                        }
                    },

                    updateDOM: function () {
                        mTextNode.data = mFrameRate.toPrecision(3) + 'FPS' ;
                    }
                };
            } ());



            mRootNode.setAttribute('visibility', 'visible');
        },

        update: function (dt) {
            mRadar.update(dt);
            mSpeedometer.update(dt);
            mLevelIndicator.update(dt);
            mProgressIndicator.update(dt);
            mLifeCounter.update(dt);
            mFrameRateIndicator.update(dt);
        },

        updateDOM: function () {
            mRadar.updateDOM();
            mSpeedometer.updateDOM();
            mLevelIndicator.updateDOM();
            mProgressIndicator.updateDOM();
            mLifeCounter.updateDOM();
            mFrameRateIndicator.updateDOM();
        }
    };
}());

//--><!]]></script>
<script data-src="src/banner.js" type="application/javascript"><!--//--><![CDATA[//><!--
MG.banner = (function () {
    var SHOW_TIME = 1.1;
    var HIDE_TIME = 0.8;

    var BannerState = {
        HIDDEN: 'hidden',
        VISIBLE: 'visible',
        MESSAGE_QUEUED: 'message-queued'
    };

    var mTitle = '';
    var mText = '';

    var mRootNode;
    var mTitleNode;
    var mTextNode;
    var mVisibility;
    var mState;
  
    return {
        init: function () {
            mVisibility = 0.0;
            mState = BannerState.HIDDEN;

            mRootNode = document.getElementById('banner');

            var titleBoxNode = document.getElementById('banner-title');
            mTitleNode = document.createTextNode('');
            titleBoxNode.appendChild(mTitleNode);

            var textBoxNode = document.getElementById('banner-text');
            mTextNode = document.createTextNode('');
            textBoxNode.appendChild(mTextNode);

            mRootNode.setAttribute('visibility', 'visible');

        },

        update: function (dt) {
            switch (mState) {
              case BannerState.VISIBLE:
                mVisibility += dt/SHOW_TIME;
                break;
              case BannerState.MESSAGE_QUEUED:
                if (mVisibility === 0) {
                    mState = BannerState.VISIBLE;

                    mTitleNode.data = mTitle;
                    mTextNode.data  = mText;
                }
                // FALLTHROUGH
              case BannerState.HIDDEN:
                mVisibility -= dt/HIDE_TIME;
                break;
            }
            mVisibility = Math.max(0,Math.min(1, mVisibility));
        },

        updateDOM: function () {
            if (mVisibility === 0) {
                mRootNode.setAttribute('visibility', 'hidden');
            } else {
                mRootNode.setAttribute('width', (30 + 80*(0.5 + 0.5*Math.cos(Math.PI*mVisibility))) + '%');
                mRootNode.setAttribute('visibility', 'visible');
            }
        },

        hide: function () {
            mState = BannerState.HIDDEN;
        },

        show: function (newTitle, newText) {

            mTitle = String(newTitle);
            mText = String(newText);

            mState = BannerState.MESSAGE_QUEUED;
        },

        isFullyVisible: function () {
            return mVisibility === 1;
        }
        
    };
}());

//--><!]]></script>
<script data-src="src/fog.js" type="application/javascript"><!--//--><![CDATA[//><!--



MG.fog = (function (){
    var SHOW_TIME = 2.0;
    var HIDE_TIME = 4.0;

    var FogState = {
        FADING_IN:  'fading-in',
        FADING_OUT: 'fading-out'
    };

    var mState = FogState.FADING_OUT;

    var mCallback = null;

    var mRootNode;
    var mVisibility = 1.0;

    return {
        init: function () {
            mRootNode = document.getElementById('fog');
        },

        fadeIn: function (newCallback) {
            mState = FogState.FADING_IN;
            mRootNode.setAttribute('visibility', 'visible');
            mCallback = newCallback;
        },

        fadeOut: function (callback) {
            mState = FogState.FADING_OUT;
            mCallback = callback;
        },

        update: function (dt) {
            if (mState === FogState.FADING_OUT) {
                mVisibility -= dt/HIDE_TIME;

                if (mVisibility < 0) {
                    mVisibility = 0;
                    if (mCallback) {
                        mCallback();
                        mCallback = undefined;
                    }
                }
            } else {
                mVisibility += dt/SHOW_TIME;

                if (mVisibility > 1) {
                    mVisibility = 1;
                    if (mCallback) {
                        mCallback();
                        mCallback = undefined;
                    }
                }
            }
        },

        updateDOM: function () {
            if (mVisibility < 0) {
                mRootNode.setAttribute('visibility', 'hidden');
            } else {
                mRootNode.setAttribute('visibility', 'visible');
                mRootNode.setAttribute('opacity', String((0.5 - 0.5*Math.cos(Math.PI*mVisibility))));
            }
        }
    };
}());

//--><!]]></script>
<script data-src="src/main.js" type="application/javascript"><!--//--><![CDATA[//><!--
MG.init = function () {
    MG.fog.init();
    MG.banner.init();
    MG.game.init();
    MG.hud.init();

    document.addEventListener('mousemove', function(evt){
            MG.game.onMouseMove(evt.clientX, evt.clientY);
        }, false);
    document.addEventListener('touchmove', function(evt){
            MG.game.onMouseMove(evt.clientX || evt.touches[0].clientX, evt.clientY || evt.touches[0].clientY);
        }, false);

    window.addEventListener('click', MG.game.onMouseClick, false);

    var update = function (dt) {
        MG.fog.update(dt);
        MG.game.update(dt);
        MG.hud.update(dt);
        MG.banner.update(dt);
        MG.fog.updateDOM();
        MG.game.updateDOM();
        MG.hud.updateDOM();
        MG.banner.updateDOM();
    }

    var lastTick = 0;
    var zeroCounter = 0;
    var useFallback = false;

    if (!window.requestAnimationFrame) {
        useFallback = true;
    }

    var mainLoop = function(thisTick) {
        var dt;

        // Some browsers don't pass in a time.  If `thisTick` isn't set for
        //  more than a few frames fall back to `setTimeout`
        if (!thisTick) {
            zeroCounter += 1;
        } else {
            zeroCounter = 0;
        }
        if (zeroCounter > 10) {
            useFallback = true;
        }

        thisTick = thisTick || 0;
        if (useFallback) {
            dt = 1/30;
        } else {
            var dt = (thisTick - lastTick)/1000;
        }
        // pretend that the frame rate is actually higher if it drops below
        // 10fps in order to avoid wierdness
        if (dt > 1/10) {
            dt = 1/10;
        }

        lastTick = thisTick;

        update(dt);

        if (useFallback) {
            window.setTimeout(mainLoop, 1000 / 30);
        } else {
            window.requestAnimationFrame(mainLoop);
        }
    }

    mainLoop();
}

MG.init();

//--><!]]></script>
</body>
</html>
